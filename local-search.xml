<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å‰ç«¯é¡¹ç›®è§„èŒƒçº¦æŸ</title>
    <link href="/2023/10/06/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83%E7%BA%A6%E6%9D%9F/"/>
    <url>/2023/10/06/%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE%E8%A7%84%E8%8C%83%E7%BA%A6%E6%9D%9F/</url>
    
    <content type="html"><![CDATA[<h3 id="è§„èŒƒçº¦å®š"><a href="#è§„èŒƒçº¦å®š" class="headerlink" title="è§„èŒƒçº¦å®š"></a>è§„èŒƒçº¦å®š</h3><p>é€šå¸¸çš„è§„èŒƒçº¦æŸåŒ…å«:</p><ul><li>ä»£ç ç›¸å…³ï¼šjs&#x2F;ts&#x2F;style ç¼–ç è§„èŒƒ</li><li>å‘½åä¸å•è¯æ‹¼å†™è§„èŒƒ</li><li>git æäº¤è§„èŒƒç­‰</li></ul><h4 id="è§„èŒƒçº¦æŸ"><a href="#è§„èŒƒçº¦æŸ" class="headerlink" title="è§„èŒƒçº¦æŸ"></a>è§„èŒƒçº¦æŸ</h4><p>ä»£ç ç›¸å…³æ£€æŸ¥æˆ‘ä»¬ä½¿ç”¨ eslint çº¦æŸ ts ç¼–ç ï¼Œstylelint çº¦æŸæ ·å¼ç›¸å…³ã€‚</p><h5 id="å®‰è£…-stylelint"><a href="#å®‰è£…-stylelint" class="headerlink" title="å®‰è£… stylelint"></a><strong>å®‰è£… stylelint</strong></h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;script&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;lint:style&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stylelint **/*.&#123;vue,css&#125;&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;devDependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;stylelint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;15.10.2&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;stylelint-config-standard&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;34.0.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;stylelint-config-prettier&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;9.0.5&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;stylelint-config-html&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.1.0&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;stylelint-config-vue&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1.0.0&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h5 id="å®‰è£…-cspell"><a href="#å®‰è£…-cspell" class="headerlink" title="å®‰è£… cspell"></a><strong>å®‰è£… cspell</strong></h5><pre><code class="hljs">&quot;script&quot;: &#123;    &quot;spellcheck&quot;: &quot;cspell lint --dot --gitignore --color --cache --show-suggestions \&quot;src/**/*.@(html|js|cjs|mjs|ts|tsx|css|scss|md|vue)\&quot;&quot;,&#125;,&quot;devDependencies&quot;: &#123;    &quot;cspell&quot;: &quot;6.31.2&quot;,&#125;</code></pre><p>é…ç½® cspellï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º <code>cspell.json</code></p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&#123;<br>  <span class="hljs-string">&quot;import&quot;</span>: [<span class="hljs-string">&quot;@cspell/dict-lorem-ipsum/cspell-ext.json&quot;</span>],<br>  <span class="hljs-string">&quot;caseSensitive&quot;</span>: false,<br>  <span class="hljs-string">&quot;dictionaries&quot;</span>: [<span class="hljs-string">&quot;custom-words&quot;</span>],<br>  <span class="hljs-string">&quot;dictionaryDefinitions&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;custom-words&quot;</span>,<br>      <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;./.cspell/custom-words.txt&quot;</span>,<br>      <span class="hljs-string">&quot;addWords&quot;</span>: true<br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;ignorePaths&quot;</span>: [<span class="hljs-string">&quot;**/node_modules/**&quot;</span>, <span class="hljs-string">&quot;**/dist/**&quot;</span>, <span class="hljs-string">&quot;**/lib/**&quot;</span>, <span class="hljs-string">&quot;**/docs/**&quot;</span>, <span class="hljs-string">&quot;**/stats.html&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure><p>å¹¶åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º .cspell&#x2F;custom-words.txtï¼ŒæŠŠé‚£äº›ä½ ä¸»è§‚è®¤ä¸ºæ˜¯å¯¹çš„çš„å•è¯æ”¾è¿›å»ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">behaviour</span><br><span class="hljs-attribute">commitlint</span><br><span class="hljs-attribute">conventionalcommits</span><br><span class="hljs-attribute">optimizelegibility</span><br><span class="hljs-attribute">pinia</span><br><span class="hljs-attribute">tiptap</span><br><span class="hljs-attribute">vuedraggable</span><br><span class="hljs-attribute">vuejs</span><br></code></pre></td></tr></table></figure><h4 id="commit-æ£€æµ‹"><a href="#commit-æ£€æµ‹" class="headerlink" title="commit æ£€æµ‹"></a>commit æ£€æµ‹</h4><h5 id="huscky-ç›¸å…³"><a href="#huscky-ç›¸å…³" class="headerlink" title="huscky ç›¸å…³"></a>huscky ç›¸å…³</h5><p>ä¸ºäº†åœ¨æäº¤æ—¶è¿›è¡Œä»£ç æ£€æµ‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨ git æäº¤é’©å­è¿›è¡Œå¤„ç†ï¼Œæ–¹ä¾¿èµ·è§æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ <code>husky</code>ï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>commitlint</code> ä»¥åŠ <code>lint-stage</code> ç›¸å…³æ¥é…ç½®å¦‚ä½•æ£€æµ‹ã€‚</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<br>    <span class="hljs-string">&quot;script&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;prepare&quot;</span>: <span class="hljs-string">&quot;husky install&quot;</span>,<br>        <span class="hljs-string">&quot;lint:stage&quot;</span>: <span class="hljs-string">&quot;lint-staged&quot;</span>,<br>        <span class="hljs-string">&quot;commit&quot;</span>: <span class="hljs-string">&quot;git-cz&quot;</span>,<br>        <span class="hljs-string">&quot;commitlint&quot;</span>: <span class="hljs-string">&quot;commitlint --edit&quot;</span><br>    &#125;,  <br>    <span class="hljs-string">&quot;lint-staged&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;*&quot;</span>: <span class="hljs-string">&quot;prettier --write&quot;</span>,<br>        <span class="hljs-string">&quot;*.&#123;vue,ts&#125;&quot;</span>: <span class="hljs-string">&quot;eslint --fix&quot;</span>,<br>        <span class="hljs-string">&quot;*.&#123;html,vue,css,sass,scss&#125;&quot;</span>: <span class="hljs-string">&quot;stylelint --fix&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;config&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;commitizen&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;path&quot;</span>: <span class="hljs-string">&quot;node_modules/cz-git&quot;</span><br>        &#125;<br>    &#125;,<br>    <span class="hljs-string">&quot;devDependencies&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;@commitlint/cli&quot;</span>: <span class="hljs-string">&quot;17.6.7&quot;</span>,<br>        <span class="hljs-string">&quot;@commitlint/config-conventional&quot;</span>: <span class="hljs-string">&quot;17.6.7&quot;</span>,<br>        <span class="hljs-string">&quot;@commitlint/cz-commitlint&quot;</span>: <span class="hljs-string">&quot;17.6.7&quot;</span>,<br>        <span class="hljs-string">&quot;husky&quot;</span>: <span class="hljs-string">&quot;8.0.3&quot;</span>,<br>        <span class="hljs-string">&quot;lint-staged&quot;</span>: <span class="hljs-string">&quot;13.2.3&quot;</span>,<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>pnpm prepare</code> å°±ä¼šåœ¨æ ¹ç›®å½•ç”Ÿæˆ <code>.huscky</code>ï¼Œé’©å­ç›¸å…³çš„å†…å®¹å†™åœ¨è¿™é‡Œã€‚</p><p> <img src="C:\Users\ASUS\Desktop\é‡è¦æ–‡ä»¶\SharedScreenshot.jpg" alt="SharedScreenshot"></p><p>pre-commité’©å­ã€‚ä½¿ç”¨ <code>zx</code> å®ƒèƒ½è®©æˆ‘ä»¬å†™ js ä»£ç ä»¥æ‰§è¡Œè„šæœ¬ç›¸å…³ã€‚</p><p>å®‰è£…zxå’Œtsno</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/usr/bin/env sh</span><br>. <span class="hljs-string">&quot;<span class="hljs-subst">$(dirname <span class="hljs-string">&quot;<span class="hljs-variable">$0</span>&quot;</span>)</span>/_/husky.sh&quot;</span><br><br>pnpm <span class="hljs-built_in">exec</span> tsno run ./scripts/pre-commit.ts<br></code></pre></td></tr></table></figure><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º <code>scripts/xxx</code> å…·ä½“è„šæœ¬çš„å†…å®¹æˆ‘ä»¬åœ¨ <code>scripts/pre-commit.ts</code> ä¸­ç¼–å†™ã€‚</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-comment">#!/usr/bin/env zx</span><br><br><span class="hljs-keyword">import</span> &#123; $ &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zx&#x27;</span><br><br>console.log(<span class="hljs-string">&#x27;å¼€å§‹æ‰§è¡Œä»£ç è´¨é‡è¯„ä¼°...\n&#x27;</span>)<br><br><span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&#x27;./check&#x27;</span>).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">(out)</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;ä»£ç è´¨é‡è¯„ä¼°å¤±è´¥, è¯·æ£€æŸ¥ä»£ç &#x27;</span>)<br>&#125;)<br><br>console.log(<span class="hljs-string">&#x27;printf &quot;æ£€æµ‹é€šè¿‡, åˆ›å»º commit ä¸­...\n&#x27;</span>)<br><br><span class="hljs-keyword">await</span> $`<span class="language-javascript">git add .</span>`<br><br></code></pre></td></tr></table></figure><p>.&#x2F;check.ts</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-meta">#!/usr/bin/env zx</span><br><br><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> &#123; <span class="hljs-title class_">ProcessOutput</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zx&#x27;</span><br><span class="hljs-keyword">import</span> &#123; $ &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zx&#x27;</span><br><span class="hljs-keyword">import</span> &#123; printObject &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./utils&#x27;</span><br><br><span class="hljs-keyword">await</span> $<span class="hljs-string">`pnpm spellcheck`</span>.<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">out: ProcessOutput</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(out)<br><br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(out.<span class="hljs-property">stdout</span>)<br>&#125;)<br><br><span class="hljs-comment">// check type and stage</span><br><span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([$<span class="hljs-string">`pnpm type-check`</span>, $<span class="hljs-string">`pnpm lint:stage`</span>]).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">out: ProcessOutput</span>) =&gt;</span> &#123;<br>  <span class="hljs-title function_">printObject</span>(out)<br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(out.<span class="hljs-property">stdout</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><p>.&#x2F;utils</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ProcessOutput</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;zx/core&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">printObject</span>(<span class="hljs-params"></span><br><span class="hljs-params">  <span class="hljs-built_in">object</span>: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">unknown</span>&gt; | ProcessOutput,</span><br><span class="hljs-params">  method: <span class="hljs-string">&#x27;log&#x27;</span> | <span class="hljs-string">&#x27;warn&#x27;</span> | <span class="hljs-string">&#x27;error&#x27;</span> = <span class="hljs-string">&#x27;log&#x27;</span></span><br><span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-built_in">object</span>)) &#123;<br>    <span class="hljs-comment">// eslint-disable-next-line no-console</span><br>    <span class="hljs-variable language_">console</span>[method](<span class="hljs-string">`<span class="hljs-subst">$&#123;key&#125;</span>:\n<span class="hljs-subst">$&#123;value&#125;</span>\n`</span>)<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="commitlint-ç›¸å…³"><a href="#commitlint-ç›¸å…³" class="headerlink" title="commitlint ç›¸å…³"></a>commitlint ç›¸å…³</h5><p>å¦å¤–ï¼Œcommitlint åŠ git-cz ç›¸å…³çš„é…ç½®æˆ‘ä»¬éœ€è¦åœ¨æ ¹ç›®å½•åˆ›å»º <code>commitlint.config.js</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">module.exports</span> <span class="hljs-string">=</span> &#123;<br>  <span class="hljs-attr">extends:</span> [<span class="hljs-string">&#x27;@commitlint/config-conventional&#x27;</span>], <span class="hljs-string">//</span> <span class="hljs-string">extends</span> <span class="hljs-string">can</span> <span class="hljs-string">be</span> <span class="hljs-string">nested</span><br>  <span class="hljs-attr">parserPreset:</span> <span class="hljs-string">&#x27;conventional-changelog-conventionalcommits&#x27;</span>,<br>  <span class="hljs-attr">prompt:</span> &#123;<br>    <span class="hljs-attr">settings:</span> &#123;&#125;,<br>    <span class="hljs-attr">messages:</span> &#123;<br>      <span class="hljs-attr">skip:</span> <span class="hljs-string">&#x27;:skip&#x27;</span>,<br>      <span class="hljs-attr">max:</span> <span class="hljs-string">&#x27;upper %d chars&#x27;</span>,<br>      <span class="hljs-attr">min:</span> <span class="hljs-string">&#x27;%d chars at least&#x27;</span>,<br>      <span class="hljs-attr">emptyWarning:</span> <span class="hljs-string">&#x27;can not be empty&#x27;</span>,<br>      <span class="hljs-attr">upperLimitWarning:</span> <span class="hljs-string">&#x27;over limit&#x27;</span>,<br>      <span class="hljs-attr">lowerLimitWarning:</span> <span class="hljs-string">&#x27;below limit&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">types:</span> [<br>      &#123; <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;feat&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;feat:     âœ¨  A new feature&#x27;</span>, <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;âœ¨ &#x27;</span> &#125;,<br>      &#123; <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;fix&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;fix:      ğŸ›  A bug fix&#x27;</span>, <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸ› &#x27;</span> &#125;,<br>      &#123; <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;docs&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;docs:     ğŸ“  Documentation only changes&#x27;</span>, <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸ“ &#x27;</span> &#125;,<br>      &#123;<br>        <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;style&#x27;</span>,<br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;style:    ğŸ’„  Changes that do not affect the meaning of the code&#x27;</span>,<br>        <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸ’„ &#x27;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;refactor&#x27;</span>,<br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;refactor: ğŸ“¦ï¸   A code change that neither fixes a bug nor adds a feature&#x27;</span>,<br>        <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸ“¦ï¸ &#x27;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;perf&#x27;</span>,<br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;perf:     ğŸš€  A code change that improves performance&#x27;</span>,<br>        <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸš€ &#x27;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;test&#x27;</span>,<br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;test:     ğŸš¨  Adding missing tests or correcting existing tests&#x27;</span>,<br>        <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸš¨ &#x27;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;build&#x27;</span>,<br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;build:    ğŸ›    Changes that affect the build system or external dependencies&#x27;</span>,<br>        <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸ›  &#x27;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;ci&#x27;</span>,<br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;ci:       ğŸ¡  Changes to our CI configuration files and scripts&#x27;</span>,<br>        <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸ¡ &#x27;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;chore&#x27;</span>,<br>        <span class="hljs-attr">name:</span> <span class="hljs-string">&quot;chore:    ğŸ”¨  Other changes that don&#x27;t modify src or test files&quot;</span>,<br>        <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;ğŸ”¨ &#x27;</span><br>      &#125;,<br>      &#123; <span class="hljs-attr">value:</span> <span class="hljs-string">&#x27;revert&#x27;</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;revert:   âªï¸  Reverts a previous commit&#x27;</span>, <span class="hljs-attr">emoji:</span> <span class="hljs-string">&#x27;:rewind:&#x27;</span> &#125;<br>    ],<br>    <span class="hljs-attr">useEmoji:</span> <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">confirmColorize:</span> <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">emojiAlign:</span> <span class="hljs-string">&#x27;center&#x27;</span>,<br>    <span class="hljs-attr">questions:</span> &#123;<br>      <span class="hljs-attr">scope:</span> &#123;<br>        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;What is the scope of this change (e.g. component or file name)&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">subject:</span> &#123;<br>        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Write a short, imperative tense description of the change&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">body:</span> &#123;<br>        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Provide a longer description of the change&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">isBreaking:</span> &#123;<br>        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Are there any breaking changes?&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">breakingBody:</span> &#123;<br>        <span class="hljs-attr">description:</span><br>          <span class="hljs-string">&#x27;A BREAKING CHANGE commit requires a body. Please enter a longer description of the commit itself&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">breaking:</span> &#123;<br>        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Describe the breaking changes&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">isIssueAffected:</span> &#123;<br>        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Does this change affect any open issues?&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">issuesBody:</span> &#123;<br>        <span class="hljs-attr">description:</span><br>          <span class="hljs-string">&#x27;If issues are closed, the commit requires a body. Please enter a longer description of the commit itself&#x27;</span><br>      &#125;,<br>      <span class="hljs-attr">issues:</span> &#123;<br>        <span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;Add issue references (e.g. &quot;fix #123&quot;, &quot;re #123&quot;.)&#x27;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®ç±»å‹åˆ¤æ–­Â </title>
    <link href="/2023/07/25/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/"/>
    <url>/2023/07/25/%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®ç±»å‹åˆ¤æ–­"><a href="#æ•°æ®ç±»å‹åˆ¤æ–­" class="headerlink" title="æ•°æ®ç±»å‹åˆ¤æ–­"></a>æ•°æ®ç±»å‹åˆ¤æ–­</h1><p>ç±»å‹åˆ¤æ–­åœ¨ web å¼€å‘ä¸­æœ‰éå¸¸å¹¿æ³›çš„åº”ç”¨ï¼š</p><ol><li>åˆ¤æ–­æ•°å­—è¿˜æ˜¯å­—ç¬¦ä¸²ï¼›</li><li>åˆ¤æ–­æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼›</li><li>åˆ¤æ–­æ—¥æœŸã€æ­£åˆ™ã€é”™è¯¯ç±»å‹ï¼›</li><li>åˆ¤æ–­ plainObjectã€ç©ºå¯¹è±¡ã€Window å¯¹è±¡ï¼›</li></ol><h1 id="1-typeof"><a href="#1-typeof" class="headerlink" title="1.typeof"></a>1.typeof</h1><p>es6å‰æœ‰å…­ç§æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯Undefind,Null,String,Boolean,Number,Object,ä½¿ç”¨typeofåˆ¤æ–­åˆ†åˆ«è¿”å›undefind,object,string,boolean,number,objectã€‚å…¶ä¸­typeofåˆ¤æ–­nullè¿”å›objectã€‚</p><p>typeofåœ¨è°·æ­Œæµè§ˆå™¨ä¸­åˆ¤æ–­å‡½æ•°è¿”å›function, åˆ¤æ–­Â Arrayã€Dateã€RegExpã€Errorç­‰è¿”å›objectã€‚å› æ­¤typeofç»†åˆ†ä¸äº†å¼•ç”¨ç±»å‹ã€‚</p><h2 id="2-Object-prototype-toString"><a href="#2-Object-prototype-toString" class="headerlink" title="2. Object.prototype.toString"></a>2. Object.prototype.toString</h2><p>å½“ toString æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¸‹é¢çš„æ­¥éª¤ä¼šè¢«æ‰§è¡Œ,å¦‚æœ this å€¼æ˜¯ undefinedï¼Œå°±è¿”å› [object Undefined],å¦‚æœ this çš„å€¼æ˜¯ nullï¼Œå°±è¿”å› [object Null],</p><p>è®© O æˆä¸º ToObject(this) çš„ç»“æœ</p><p>è®© class æˆä¸º O çš„å†…éƒ¨å±æ€§ [[Class]] çš„å€¼</p><p>è®© O æˆä¸º ToObject(this) çš„ç»“æœ<br>è®© class æˆä¸º O çš„å†…éƒ¨å±æ€§ [[Class]] çš„å€¼<br>æœ€åè¿”å›ç”± â€œ[object â€œ å’Œ class å’Œ â€œ]â€ ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„å­—ç¬¦ä¸²</p><p>æ¯”å¦‚:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>) <span class="hljs-comment">//[object Null]</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">undefined</span>) <span class="hljs-comment">//[object Undefined]</span><br><span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(date) <span class="hljs-comment">//[object Date]</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-title class_">Math</span>)); <span class="hljs-comment">// [object Math]</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-title class_">JSON</span>)); <span class="hljs-comment">// [object JSON]</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">a</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>)); <span class="hljs-comment">// [object Arguments]</span><br>&#125;<br><span class="hljs-title function_">a</span>();<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>äº‹ä»¶å§”æ‰˜Â </title>
    <link href="/2023/07/21/%E4%BA%8B%E4%BB%B6%E5%A7%94%E6%89%98/"/>
    <url>/2023/07/21/%E4%BA%8B%E4%BB%B6%E5%A7%94%E6%89%98/</url>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜"><a href="#ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜"></a>ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜</h1><p>é€šä¿—çš„è®²ï¼Œäº‹ä»¶å§”æ‰˜æ˜¯æŠŠä¸€ä¸ªå…ƒç´ å“åº”äº‹ä»¶ï¼ˆclick,keydownâ€¦ï¼‰çš„å‡½æ•°å§”æ‰˜ç»™åˆ«çš„å…ƒç´ ï¼Œä»–æ˜¯åˆ©ç”¨äº‹ä»¶å†’æ³¡åŸç†çš„æŠ€æœ¯ã€‚å®ƒå…è®¸æˆ‘ä»¬å°†äº‹ä»¶å¤„ç†ç¨‹åºç»‘å®šåœ¨çˆ¶å…ƒç´ ä¸Šï¼Œç„¶åé€šè¿‡äº‹ä»¶å†’æ³¡çš„æ–¹å¼åœ¨å­å…ƒç´ ä¸Šè§¦å‘ã€‚è¿™æ ·å¯ä»¥å‡å°‘äº‹ä»¶å¤„ç†ç¨‹åºçš„æ•°é‡ï¼Œæé«˜æ€§èƒ½å’Œä»£ç çš„ç®€æ´æ€§ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨äº‹ä»¶å§”æ‰˜æ˜¯ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªçˆ¶å…ƒç´ åŒ…å«äº†å¤šä¸ªå­å…ƒç´ ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è¿™äº›å­å…ƒç´ ä¸­çš„ç‚¹å‡»äº‹ä»¶è¿›è¡Œå¤„ç†:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>æŒ‰é’®1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>æŒ‰é’®2<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>æŒ‰é’®3<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœç»™æ¯ä¸ªåˆ—è¡¨é¡¹ä¸€ä¸€éƒ½ç»‘å®šä¸€ä¸ªå‡½æ•°ï¼Œé‚£å¯¹äºå†…å­˜æ¶ˆè€—æ˜¯éå¸¸å¤§çš„</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByTagName</span>(<span class="hljs-string">&#x27;button&#x27;</span>)<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>; i &lt; btn.<span class="hljs-property">length</span>; i++)&#123;<br>    btn[i].<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">target</span>.<span class="hljs-property">innerHTML</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼Œé€šè¿‡<code>addEventListener</code>æ–¹æ³•å°†ç‚¹å‡»äº‹ä»¶ç»‘å®šåœ¨çˆ¶å…ƒç´ ä¸Šã€‚åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œé€šè¿‡<code>event.target</code>æ¥è·å–è§¦å‘äº‹ä»¶çš„å…·ä½“å…ƒç´ ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ä¸ºæŒ‰é’®å…ƒç´ ï¼Œå¦‚æœæ˜¯åˆ™æ‰§è¡Œç›¸åº”çš„å¤„ç†é€»è¾‘ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> parent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;parent&#x27;</span>);<br><br>parent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">tagName</span> === <span class="hljs-string">&#x27;BUTTON&#x27;</span>) &#123;<br>    <span class="hljs-comment">// åœ¨è¿™é‡Œå¤„ç†æŒ‰é’®ç‚¹å‡»äº‹ä»¶</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æŒ‰é’®è¢«ç‚¹å‡»äº†&#x27;</span>);<br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h1 id="JavaScriptäº‹ä»¶æµ"><a href="#JavaScriptäº‹ä»¶æµ" class="headerlink" title="JavaScriptäº‹ä»¶æµ"></a>JavaScriptäº‹ä»¶æµ</h1><p>JavaScriptäº‹ä»¶æµæ˜¯æŒ‡äº‹ä»¶æ‰§è¡Œçš„å®Œæ•´è·¯å¾„ï¼Œå®ƒæ¶‰åŠä¸‰ä¸ªé˜¶æ®µï¼šäº‹ä»¶æ•è·é˜¶æ®µã€ç›®æ ‡é˜¶æ®µå’Œäº‹ä»¶å†’æ³¡é˜¶æ®µã€‚</p><p>äº‹ä»¶æ•è·é˜¶æ®µ</p><ul><li>äº‹ä»¶ä»æœ€å¤–å±‚çš„ç¥–å…ˆå…ƒç´ ï¼ˆé€šå¸¸æ˜¯windowæˆ–documentå¯¹è±¡ï¼‰å¼€å§‹ï¼Œé€çº§å‘ä¸‹ä¼ æ’­ã€‚</li><li>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œäº‹ä»¶ä¼šç»è¿‡DOMæ ‘ä¸­çš„æ¯ä¸ªç¥–å…ˆå…ƒç´ ï¼Œç›´åˆ°è¾¾åˆ°äº‹ä»¶çš„ç›®æ ‡å…ƒç´ ã€‚</li><li>åœ¨äº‹ä»¶æ•è·é˜¶æ®µï¼Œå¯ä»¥ä½¿ç”¨<code>addEventListener</code>æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå…ƒç´ ç»‘å®šäº‹ä»¶ç›‘å¬ï¼Œè¯¥å‚æ•°è®¾ç½®ä¸º<code>true</code>ã€‚</li></ul><p>ç›®æ ‡é˜¶æ®µ</p><ul><li>äº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ ï¼Œå³äº‹ä»¶çš„è§¦å‘å…ƒç´ ã€‚</li><li>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œäº‹ä»¶ä¼šåœ¨ç›®æ ‡å…ƒç´ ä¸Šè§¦å‘æ‰§è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚</li></ul><p>äº‹ä»¶å†’æ³¡é˜¶æ®µ</p><ul><li>äº‹ä»¶ä»ç›®æ ‡å…ƒç´ å¼€å§‹ï¼Œå‘ä¸Šå†’æ³¡ä¼ æ’­ã€‚</li><li>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œäº‹ä»¶ä¼šç»è¿‡ç›®æ ‡å…ƒç´ çš„çˆ¶å…ƒç´ ã€æ›´é«˜çº§åˆ«çš„ç¥–å…ˆå…ƒç´ ï¼Œç›´åˆ°è¾¾åˆ°æ–‡æ¡£æ ¹å…ƒç´ ï¼ˆé€šå¸¸æ˜¯windowæˆ–documentå¯¹è±¡ï¼‰ã€‚</li><li>åœ¨äº‹ä»¶å†’æ³¡é˜¶æ®µï¼Œå¯ä»¥ä½¿ç”¨<code>addEventListener</code>æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå…ƒç´ ç»‘å®šäº‹ä»¶ç›‘å¬ï¼Œè¯¥å‚æ•°è®¾ç½®ä¸º<code>false</code>ï¼ˆé»˜è®¤å€¼ï¼‰æˆ–çœç•¥ã€‚</li></ul><h1 id="äº‹ä»¶å†’æ³¡å¼•å‘çš„é—®é¢˜"><a href="#äº‹ä»¶å†’æ³¡å¼•å‘çš„é—®é¢˜" class="headerlink" title="äº‹ä»¶å†’æ³¡å¼•å‘çš„é—®é¢˜"></a>äº‹ä»¶å†’æ³¡å¼•å‘çš„é—®é¢˜</h1><p>äº‹ä»¶å†’æ³¡ä¼šå¼•å‘æ„æ–™ä¹‹å¤–çš„é—®é¢˜ã€‚æœ¬æ¥åªæƒ³è§¦å‘<span>å…ƒç´ çš„ click äº‹ä»¶ï¼Œç„¶è€Œ<div>å…ƒç´ å’Œ<body>å…ƒç´ çš„ click äº‹ä»¶ä¹ŸåŒæ—¶è¢«è§¦å‘äº†ã€‚å› æ­¤ï¼Œæœ‰å¿…è¦å¯¹äº‹ä»¶çš„ä½œç”¨èŒƒå›´è¿›è¡Œé™åˆ¶ã€‚</p><p>event.stopPropagation:è¿™æ˜¯é˜»æ­¢äº‹ä»¶çš„å†’æ³¡æ–¹æ³•ï¼Œä¸æ­¢äº‹ä»¶å‘documentä¸Šè”“å»¶ï¼Œä½†æ˜¯é»˜è®¤äº‹ä»¶ä»»ç„¶ä¼šæ‰§è¡Œï¼Œå½“ä½ è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœç‚¹å‡»ä¸€ä¸ªè¿æ¥ï¼Œè¿™ä¸ªè¿æ¥ä»ç„¶ä¼šè¢«æ‰“å¼€</p><p>event.preventDefault:è¿™æ˜¯é˜»æ­¢é»˜è®¤äº‹ä»¶çš„æ–¹æ³•ï¼Œè°ƒç”¨æ­¤æ–¹æ³•æ—¶ï¼Œé“¾æ¥ä¸ä¼šè¢«æ‰“å¼€ï¼Œä½†æ˜¯ä¼šå‘ç”Ÿå†’æ³¡ï¼Œå†’æ³¡ä¼šä¼ é€’åˆ°ä¸Šä¸€å±‚çš„çˆ¶å…ƒç´ </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®ç±»å‹åˆ¤æ–­Â </title>
    <link href="/2023/07/17/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%88%A4%E6%96%AD/"/>
    <url>/2023/07/17/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%88%A4%E6%96%AD/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®ç±»å‹åˆ¤æ–­"><a href="#æ•°æ®ç±»å‹åˆ¤æ–­" class="headerlink" title="æ•°æ®ç±»å‹åˆ¤æ–­"></a>æ•°æ®ç±»å‹åˆ¤æ–­</h1><p>ç±»å‹åˆ¤æ–­åœ¨ web å¼€å‘ä¸­æœ‰éå¸¸å¹¿æ³›çš„åº”ç”¨ï¼š</p><ol><li>åˆ¤æ–­æ•°å­—è¿˜æ˜¯å­—ç¬¦ä¸²ï¼›</li><li>åˆ¤æ–­æ•°ç»„è¿˜æ˜¯å¯¹è±¡ï¼›</li><li>åˆ¤æ–­æ—¥æœŸã€æ­£åˆ™ã€é”™è¯¯ç±»å‹ï¼›</li><li>åˆ¤æ–­ plainObjectã€ç©ºå¯¹è±¡ã€Window å¯¹è±¡ï¼›</li></ol><h1 id="1-typeof"><a href="#1-typeof" class="headerlink" title="1.typeof"></a>1.typeof</h1><p>es6å‰æœ‰å…­ç§æ•°æ®ç±»å‹ï¼Œåˆ†åˆ«æ˜¯Undefind,Null,String,Boolean,Number,Object,ä½¿ç”¨typeofåˆ¤æ–­åˆ†åˆ«è¿”å›undefind,object,string,boolean,number,objectã€‚å…¶ä¸­typeofåˆ¤æ–­nullè¿”å›objectã€‚</p><p>typeofåœ¨è°·æ­Œæµè§ˆå™¨ä¸­åˆ¤æ–­å‡½æ•°è¿”å›function, åˆ¤æ–­Â Arrayã€Dateã€RegExpã€Errorç­‰è¿”å›objectã€‚å› æ­¤typeofç»†åˆ†ä¸äº†å¼•ç”¨ç±»å‹ã€‚</p><h2 id="2-Object-prototype-toString"><a href="#2-Object-prototype-toString" class="headerlink" title="2. Object.prototype.toString"></a>2. Object.prototype.toString</h2><p>å½“ toString æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¸‹é¢çš„æ­¥éª¤ä¼šè¢«æ‰§è¡Œ,å¦‚æœ this å€¼æ˜¯ undefinedï¼Œå°±è¿”å› [object Undefined],å¦‚æœ this çš„å€¼æ˜¯ nullï¼Œå°±è¿”å› [object Null],</p><p>è®© O æˆä¸º ToObject(this) çš„ç»“æœ</p><p>è®© class æˆä¸º O çš„å†…éƒ¨å±æ€§ [[Class]] çš„å€¼</p><p>è®© O æˆä¸º ToObject(this) çš„ç»“æœ<br>è®© class æˆä¸º O çš„å†…éƒ¨å±æ€§ [[Class]] çš„å€¼<br>æœ€åè¿”å›ç”± â€œ[object â€œ å’Œ class å’Œ â€œ]â€ ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„å­—ç¬¦ä¸²</p><p>æ¯”å¦‚:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>) <span class="hljs-comment">//[object Null]</span><br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-literal">undefined</span>) <span class="hljs-comment">//[object Undefined]</span><br><span class="hljs-keyword">var</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(date) <span class="hljs-comment">//[object Date]</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-title class_">Math</span>)); <span class="hljs-comment">// [object Math]</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-title class_">JSON</span>)); <span class="hljs-comment">// [object JSON]</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">a</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>)); <span class="hljs-comment">// [object Arguments]</span><br>&#125;<br><span class="hljs-title function_">a</span>();<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æµè§ˆå™¨äº‹ä»¶æ¨¡å‹</title>
    <link href="/2023/07/17/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%9E%8B&amp;%E8%AF%B7%E6%B1%82/"/>
    <url>/2023/07/17/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BA%8B%E4%BB%B6%E6%A8%A1%E5%9E%8B&amp;%E8%AF%B7%E6%B1%82/</url>
    
    <content type="html"><![CDATA[<h1 id="1-æµè§ˆå™¨äº‹ä»¶æ¨¡å‹"><a href="#1-æµè§ˆå™¨äº‹ä»¶æ¨¡å‹" class="headerlink" title="1. æµè§ˆå™¨äº‹ä»¶æ¨¡å‹"></a>1. æµè§ˆå™¨äº‹ä»¶æ¨¡å‹</h1><h2 id="1-1-DOMäº‹ä»¶"><a href="#1-1-DOMäº‹ä»¶" class="headerlink" title="1.1. DOMäº‹ä»¶"></a>1.1. DOMäº‹ä»¶</h2><p>DOM<code>(Document Object Model</code>ï¼Œæ–‡æ¡£å¯¹è±¡æ¨¡å‹)æ˜¯é’ˆå¯¹HTMLæ–‡æ¡£å’ŒXMLæ–‡æ¡£çš„ä¸€ä¸ªAPIã€‚DOMæç»˜äº†ä¸€ä¸ªå±‚æ¬¡åŒ–çš„èŠ‚ç‚¹æ ‘ï¼Œå…è®¸å¼€å‘äººå‘˜æ·»åŠ ã€ç§»å‡ºå’Œä¿®æ”¹é¡µé¢çš„æŸä¸€éƒ¨åˆ†ï¼ŒDOM è„±èƒäºNetscape åŠå¾®è½¯å…¬å¸åˆ›å§‹çš„ DHTMLï¼ˆåŠ¨æ€HTMLï¼‰ã€‚ä½†ç°åœ¨å®ƒå·²ç»æˆä¸ºè¡¨ç°å’Œæ“ä½œé¡µé¢æ ‡è®°çš„çœŸæ­£è·¨å¹³å°ã€è¯­è¨€ä¸­ç«‹çš„æ–¹å¼ã€‚<br><code>Netscape Navigator 4</code> å’Œ <code>IE4</code> åˆ†åˆ«å‘å¸ƒäº 1997 å¹´çš„ 6 æœˆå’Œ 10 æœˆå‘å¸ƒçš„ DHTMLï¼Œç”±äº <code>IE4</code> å’Œ <code>Netscape Navigator4</code> åˆ†åˆ«æ”¯æŒä¸åŒçš„ DHTMLï¼Œä¸ºäº†ç»Ÿä¸€æ ‡å‡†ï¼ŒW3Cå¼€å§‹åˆ¶å®š DOMã€‚1998 å¹´10 æœˆ W3C æ€»ç»“äº† IE å’Œ Navigator4 çš„è§„èŒƒï¼Œåˆ¶å®šäº† DOMLevel 1å³ DOM1ï¼Œä¹‹å‰ IE ä¸ Netscape çš„è§„èŒƒåˆ™è¢«ç§°ä¸º DOMLevel 0 å³ DOM0 ã€‚</p><h3 id="1-1-1-DOM0çº§äº‹ä»¶"><a href="#1-1-1-DOM0çº§äº‹ä»¶" class="headerlink" title="1.1.1. DOM0çº§äº‹ä»¶"></a>1.1.1. DOM0çº§äº‹ä»¶</h3><p>å‡è®¾é¡µé¢ä¸­å­˜åœ¨ä¸€ä¸ª btn çš„æŒ‰é’®ï¼Œå¹¶ä¸”ç»™ btn æ·»åŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">btn.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this is a click event&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>äº‹ä»¶å°±æ˜¯ç”¨æˆ·æˆ–æµè§ˆå™¨è‡ªèº«æ‰§è¡Œçš„æŸç§æ“ä½œï¼Œå¦‚clickã€loadã€mouseoverç­‰ï¼Œéƒ½æ˜¯äº‹ä»¶çš„åå­—ï¼Œè€Œå“åº”æŸä¸ªäº‹ä»¶çš„å‡½æ•°å°±è¢«ç§°ä¸ºäº‹ä»¶å¤„ç†ç¨‹åºã€‚</p><h4 id="1-1-1-1-clickäº‹ä»¶è¿‡ç¨‹"><a href="#1-1-1-1-clickäº‹ä»¶è¿‡ç¨‹" class="headerlink" title="1.1.1.1. clickäº‹ä»¶è¿‡ç¨‹"></a>1.1.1.1. clickäº‹ä»¶è¿‡ç¨‹</h4><p>åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œclick äº‹ä»¶å¹¶æ²¡æœ‰åƒå…¶ä»–å‡½æ•°ä¸€æ ·ï¼Œå¿…é¡»è¦è°ƒç”¨æ‰å¯ä»¥æ‰§è¡Œï¼Œclick äº‹ä»¶å¹¶ä¸ç¡®å®šä»€ä¹ˆæ—¶å€™å‘ç”Ÿï¼Œè€Œå½“æµè§ˆå™¨å‘ç°ç”¨æˆ·ç‚¹å‡»è¯¥æŒ‰é’®æ—¶ï¼Œæµè§ˆå™¨å°±æ£€æµ‹<code>btn.onclick</code>æ˜¯å¦æœ‰å€¼ï¼Œå¦‚æœæœ‰ï¼Œå°±ä¼šæ‰§è¡Œ<code>btn.onclick.call(btn,event)</code>ï¼Œæ­¤æ—¶å‡½æ•°æ‰§è¡Œï¼Œcall() æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæŒ‡å‘è°ƒç”¨å½“å‰æ–¹æ³•çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯thisã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŒ‡å®šçš„ this å€¼å¹¶ä¸ä¸€å®šæ˜¯è¯¥å‡½æ•°æ‰§è¡Œæ—¶çœŸæ­£çš„thiså€¼ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°å¤„äº<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Strict_mode">éä¸¥æ ¼æ¨¡å¼</a>ä¸‹ï¼Œåˆ™æŒ‡å®šä¸º null å’Œ undefined çš„ this å€¼ä¼šè‡ªåŠ¨æŒ‡å‘å…¨å±€å¯¹è±¡(æµè§ˆå™¨ä¸­å°±æ˜¯windowå¯¹è±¡)ï¼ŒåŒæ—¶å€¼ä¸ºåŸå§‹å€¼(æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼)çš„ this ä¼šæŒ‡å‘è¯¥åŸå§‹å€¼çš„è‡ªåŠ¨åŒ…è£…å¯¹è±¡ã€‚<br>å¦ä¸€ä¸ªå‚æ•°åˆ™æ˜¯äº‹ä»¶å¯¹è±¡ eventï¼Œè¯¥å¯¹è±¡ä¹Ÿå¯ä»¥é€šè¿‡ arguments[0] æ¥è®¿é—®ï¼Œå®ƒåŒ…å«äº†äº‹ä»¶ç›¸å…³çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚æœ¬ä¾‹å­ä¸­ï¼Œåˆ™åŒ…å«äº†ç‚¹å‡»äº‹ä»¶çš„å…¨éƒ¨ä¿¡æ¯ã€‚å¯ä»¥é€šè¿‡ç»™å‡½æ•°ä¼ å‚æ¥è·å–äº‹ä»¶ä¿¡æ¯ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">btn.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)&#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;this is a click event&#x27;</span>);<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);  <span class="hljs-comment">//  äº‹ä»¶å¯¹è±¡</span><br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ IE ä¸­ï¼Œåœ¨ä½¿ç”¨ DOM0 çº§æ–¹æ³•æ·»åŠ äº‹ä»¶å¤„ç†ç¨‹åºæ—¶ï¼Œevent æ˜¯ä½œ window å¯¹è±¡çš„ä¸€ä¸ªå±æ€§è€Œå­˜åœ¨çš„ã€‚æ­¤æ—¶è®¿é—®äº‹ä»¶å¯¹è±¡éœ€è¦é€šè¿‡ <code>window.event</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">btn.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">event</span>);  <span class="hljs-comment">//  IEä¸­äº‹ä»¶å¯¹è±¡    </span><br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ DOM0çº§ä¸­ï¼Œå¦‚æœæƒ³è¦å®ç°ä¸€ä¸ªå¯¹è±¡ç»‘å®šå¤šä¸ªå‡½æ•°ï¼Œå¯ä»¥è¿™æ ·å®ç°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">// do something</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn2</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">// do something</span><br>&#125;<br>btn.<span class="hljs-property">onclick</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)&#123;<br>  fn1.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">xxx</span>);<br>  fn2.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">yyy</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-1-2-DOM1çº§äº‹ä»¶"><a href="#1-1-2-DOM1çº§äº‹ä»¶" class="headerlink" title="1.1.2. DOM1çº§äº‹ä»¶"></a>1.1.2. DOM1çº§äº‹ä»¶</h3><p>DOMçº§åˆ«1äº1998å¹´10æœˆ1æ—¥æˆä¸ºW3Cæ¨èæ ‡å‡†ã€‚1çº§DOMæ ‡å‡†ä¸­å¹¶æ²¡æœ‰å®šä¹‰äº‹ä»¶ç›¸å…³çš„å†…å®¹ï¼Œæ‰€ä»¥æ²¡æœ‰æ‰€è°“çš„1çº§DOMäº‹ä»¶æ¨¡å‹ã€‚åœ¨2çº§DOMä¸­é™¤äº†å®šä¹‰äº†ä¸€äº›DOMç›¸å…³çš„æ“ä½œä¹‹å¤–è¿˜å®šä¹‰äº†ä¸€ä¸ªäº‹ä»¶æ¨¡å‹ ï¼Œè¿™ä¸ªæ ‡å‡†ä¸‹çš„äº‹ä»¶æ¨¡å‹å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„2çº§DOMäº‹ä»¶æ¨¡å‹ã€‚</p><h3 id="1-1-3-DOM2çº§äº‹ä»¶"><a href="#1-1-3-DOM2çº§äº‹ä»¶" class="headerlink" title="1.1.3. DOM2çº§äº‹ä»¶"></a>1.1.3. DOM2çº§äº‹ä»¶</h3><p>W3C åæ¥å°† DOM1 å‡çº§ä¸º DOM2ï¼ŒDOM2çº§è§„èŒƒå¼€å§‹å°è¯•ä»¥ä¸€ç§ç¬¦åˆé€»è¾‘çš„æ–¹å¼æ¥æ ‡å‡†åŒ– DOMäº‹ä»¶ã€‚DOM0çº§ å¯ä»¥è®¤ä¸º onclick æ˜¯ btn çš„ä¸€ä¸ªå±æ€§ï¼ŒDOM2çº§ åˆ™å°†å±æ€§å‡çº§ä¸ºé˜Ÿåˆ—ã€‚<br>DOM2çº§ äº‹ä»¶å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨äºå¤„ç†æŒ‡å®šå’Œåˆ é™¤äº‹ä»¶å¤„ç†ç¨‹åºçš„æ“ä½œï¼Œ<code>addEventListener()</code>å’Œ<code>removeEventListener()</code>ï¼Œæ‰€æœ‰çš„ DOM èŠ‚ç‚¹ä¸­éƒ½åŒ…å«è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬éƒ½æ¥æ”¶ 3 ä¸ªå‚æ•°ã€‚</p><ol><li>è¦å¤„ç†çš„äº‹ä»¶åï¼›</li><li>ä½œä¸ºäº‹ä»¶å¤„ç†ç¨‹åºçš„å‡½æ•°ï¼›</li><li>å¸ƒå°”å€¼ï¼Œtrue ä»£è¡¨åœ¨æ•è·é˜¶æ®µè°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºï¼Œfalse è¡¨ç¤ºåœ¨å†’æ³¡é˜¶æ®µè°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºï¼Œé»˜è®¤ä¸º falseï¼›<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript">btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">//  do something</span><br>&#125;)<br>btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">//  do something else</span><br>&#125;)<br></code></pre></td></tr></table></figure><code>addEventListener()</code>å°†äº‹ä»¶åŠ å…¥åˆ°ç›‘å¬é˜Ÿåˆ—ä¸­ï¼Œå½“æµè§ˆå™¨å‘ç°ç”¨æˆ·ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œclick é˜Ÿåˆ—ä¸­ä¾æ¬¡æ‰§è¡ŒåŒ¿åå‡½æ•°1ã€åŒ¿åå‡½æ•°2ã€‚<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">//  do something</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">fn1</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">//  do something else</span><br>&#125;<br>btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>,fn1)<br>btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>,fn2)<br></code></pre></td></tr></table></figure>å¦‚æœè¿™æ ·å†™ï¼Œclick é˜Ÿåˆ—ä¸­ä¾æ¬¡<code>fn1.call(btn,event)</code>ï¼Œ<code>fn2.call(btn,event)</code>ã€‚<br>é€šè¿‡<code>addEventListener()</code>æ·»åŠ çš„äº‹ä»¶åªèƒ½ç”±<code>removeEventListener()</code>æ¥ç§»é™¤ï¼Œå¹¶ä¸”<code>removeEventListener()</code>åªèƒ½ç§»é™¤å…·åå‡½æ•°ï¼Œä¸èƒ½ç§»é™¤åŒ¿åå‡½æ•°ã€‚<blockquote><p>è¯¾åä½œä¸šï¼šå¿…é¡»é€šè¯»<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model">MDN</a>ä¸Šå…³äºDOMçš„å†…å®¹ï¼›</p></blockquote></li></ol><h3 id="1-1-4-IE-ä¸­-DOM2çº§äº‹ä»¶"><a href="#1-1-4-IE-ä¸­-DOM2çº§äº‹ä»¶" class="headerlink" title="1.1.4. IE ä¸­ DOM2çº§äº‹ä»¶"></a>1.1.4. IE ä¸­ DOM2çº§äº‹ä»¶</h3><p>IE8 åŠä¹‹å‰ï¼Œå®ç°ç±»ä¼¼<code>addEventListener()</code>å’Œ<code>removeEventListener()</code>çš„ä¸¤ä¸ªæ–¹æ³•æ˜¯<code>attachEvent()</code>å’Œ<code>detachEvent()</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ¥å—ç›¸åŒçš„ä¸¤ä¸ªå‚æ•°ã€‚</p><ol><li>è¦å¤„ç†çš„äº‹ä»¶åï¼›</li><li>ä½œä¸ºäº‹ä»¶å¤„ç†ç¨‹åºçš„å‡½æ•°ï¼›</li></ol><p>IE8 ä¹‹å‰çš„åªæ”¯æŒäº‹ä»¶å†’æ³¡ï¼Œæ‰€ä»¥é€šè¿‡<code>attachEvent()</code>æ·»åŠ çš„äº‹ä»¶å¤„ç†ç¨‹åºåªèƒ½æ·»åŠ åˆ°å†’æ³¡é˜¶æ®µã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript">btn.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">&#x27;click&#x27;</span>,fn1)<br>btn.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">&#x27;click&#x27;</span>,fn2)<br></code></pre></td></tr></table></figure><p>å½“ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œclick é˜Ÿåˆ—ä¾æ¬¡<code>fn1.call(undefined,undefined)</code>ï¼Œ<code>fn2.call(undefined,undefined)</code>ã€‚<br>ç±»ä¼¼çš„<code>detachEvent()</code>ä¹Ÿåªèƒ½ç§»é™¤å…·åå‡½æ•°ï¼Œä¸èƒ½ç§»é™¤åŒ¿åå‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">eventHandler</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;xianzao);</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string"></span><br><span class="hljs-string">btn.attachEvent(&#x27;</span>onClick<span class="hljs-string">&#x27;, eventHandler);</span><br><span class="hljs-string">btn.detachEvent(&#x27;</span>onClick, eventHandler);<br></code></pre></td></tr></table></figure><h3 id="1-1-5-å…¼å®¹å¤„ç†"><a href="#1-1-5-å…¼å®¹å¤„ç†" class="headerlink" title="1.1.5. å…¼å®¹å¤„ç†"></a>1.1.5. å…¼å®¹å¤„ç†</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> btn.<span class="hljs-property">addEventListener</span> === <span class="hljs-string">&#x27;function&#x27;</span>)&#123;<br>  btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>,fn);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> btn.<span class="hljs-property">attachEvent</span> === <span class="hljs-string">&#x27;function&#x27;</span>)&#123;<br>  btn.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">&#x27;onclick&#x27;</span>,fn)<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>  btn.<span class="hljs-property">onclick</span>=<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-comment">// do something</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-1-6-æ€»ç»“"><a href="#1-1-6-æ€»ç»“" class="headerlink" title="1.1.6. æ€»ç»“"></a>1.1.6. æ€»ç»“</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;btn&#x27;</span>);<br><br>btn.<span class="hljs-property">onClick</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æˆ‘æ˜¯DOM0çº§äº‹ä»¶å¤„ç†ç¨‹åº&#x27;</span>);<br>&#125;<br>btn.<span class="hljs-property">onClick</span> = <span class="hljs-literal">null</span>;<br><br>btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æˆ‘æ˜¯DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åº&#x27;</span>);<br>&#125;, <span class="hljs-literal">false</span>);<br>btn.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, handler, <span class="hljs-literal">false</span>)<br><br>btn.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">&#x27;onclick&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æˆ‘æ˜¯IEäº‹ä»¶å¤„ç†ç¨‹åº&#x27;</span>)<br>&#125;)<br>btn.<span class="hljs-title function_">detachEvent</span>(<span class="hljs-string">&#x27;onclicn&#x27;</span>, handler);<br></code></pre></td></tr></table></figure><ol><li>DOM2çº§çš„å¥½å¤„æ˜¯å¯ä»¥æ·»åŠ å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼›DOM0å¯¹æ¯ä¸ªäº‹ä»¶åªæ”¯æŒä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼›</li><li>é€šè¿‡DOM2æ·»åŠ çš„åŒ¿åå‡½æ•°æ— æ³•ç§»é™¤ï¼Œä¸Šé¢å†™çš„ä¾‹å­å°±ç§»é™¤ä¸äº†ï¼Œ<code>addEventListener</code>å’Œ<code>removeEventListener</code>çš„handlerå¿…é¡»åŒåï¼›</li><li>ä½œç”¨åŸŸï¼šDOM0çš„handlerä¼šåœ¨æ‰€å±å…ƒç´ çš„ä½œç”¨åŸŸå†…è¿è¡Œï¼ŒIEçš„handlerä¼šåœ¨å…¨å±€ä½œç”¨åŸŸè¿è¡Œï¼Œ<code>this === window</code>ï¼›</li><li>è§¦å‘é¡ºåºï¼šæ·»åŠ å¤šä¸ªäº‹ä»¶æ—¶ï¼ŒDOM2ä¼šæŒ‰ç…§æ·»åŠ é¡ºåºæ‰§è¡Œï¼ŒIEä¼šä»¥ç›¸åçš„é¡ºåºæ‰§è¡Œï¼›</li><li>è·¨æµè§ˆå™¨çš„äº‹ä»¶å¤„ç†ç¨‹åº<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">EventUtil</span> = &#123;<br>  <span class="hljs-comment">// elementæ˜¯å½“å‰å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡getElementById(id)è·å–</span><br>  <span class="hljs-comment">// type æ˜¯äº‹ä»¶ç±»å‹ï¼Œä¸€èˆ¬æ˜¯click ,ä¹Ÿæœ‰å¯èƒ½æ˜¯é¼ æ ‡ã€ç„¦ç‚¹ã€æ»šè½®äº‹ä»¶ç­‰ç­‰</span><br>  <span class="hljs-comment">// handle äº‹ä»¶å¤„ç†å‡½æ•°</span><br>  <span class="hljs-attr">addHandler</span>: <span class="hljs-function">(<span class="hljs-params">element, type, handler</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// å…ˆæ£€æµ‹æ˜¯å¦å­˜åœ¨DOM2çº§æ–¹æ³•,å†æ£€æµ‹IEçš„æ–¹æ³•ï¼Œæœ€åæ˜¯DOM0çº§æ–¹æ³•ï¼ˆä¸€èˆ¬ä¸ä¼šåˆ°è¿™ï¼‰</span><br>    <span class="hljs-keyword">if</span> (element.<span class="hljs-property">addEventListener</span>) &#123;<br>      <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°falseè¡¨ç¤ºå†’æ³¡é˜¶æ®µ</span><br>      element.<span class="hljs-title function_">addEventListener</span>(type, handler, <span class="hljs-literal">false</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">attachEvent</span>) &#123;<br>      element.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">`on<span class="hljs-subst">$&#123;type&#125;</span>`</span>, handler)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      element[<span class="hljs-string">`on<span class="hljs-subst">$&#123;type&#125;</span>`</span>] = handler;<br>    &#125;<br>  &#125;,<br><br>  <span class="hljs-attr">removeHandler</span>: <span class="hljs-function">(<span class="hljs-params">element, type, handler</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (element.<span class="hljs-property">removeEventListener</span>) &#123;<br>      <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°falseè¡¨ç¤ºå†’æ³¡é˜¶æ®µ</span><br>      element.<span class="hljs-title function_">removeEventListener</span>(type, handler, <span class="hljs-literal">false</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">detachEvent</span>) &#123;<br>      element.<span class="hljs-title function_">detachEvent</span>(<span class="hljs-string">`on<span class="hljs-subst">$&#123;type&#125;</span>`</span>, handler)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      element[<span class="hljs-string">`on<span class="hljs-subst">$&#123;type&#125;</span>`</span>] = <span class="hljs-literal">null</span>;<br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">// è·å–å…ƒç´ </span><br><span class="hljs-keyword">var</span> btn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;btn&#x27;</span>);<br><span class="hljs-comment">// å®šä¹‰handler</span><br><span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æˆ‘è¢«ç‚¹å‡»äº†&#x27;</span>);<br>&#125;<br><span class="hljs-comment">// ç›‘å¬äº‹ä»¶</span><br><span class="hljs-title class_">EventUtil</span>.<span class="hljs-title function_">addHandler</span>(btn, <span class="hljs-string">&#x27;click&#x27;</span>, handler);<br><span class="hljs-comment">// ç§»é™¤äº‹ä»¶ç›‘å¬</span><br><span class="hljs-comment">// EventUtil.removeHandler(button1, &#x27;click&#x27;, clickEvent);</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="1-2-äº‹ä»¶æ•è·-amp-äº‹ä»¶å†’æ³¡"><a href="#1-2-äº‹ä»¶æ•è·-amp-äº‹ä»¶å†’æ³¡" class="headerlink" title="1.2. äº‹ä»¶æ•è·&amp;äº‹ä»¶å†’æ³¡"></a>1.2. äº‹ä»¶æ•è·&amp;äº‹ä»¶å†’æ³¡</h2><p>äº‹ä»¶æµæè¿°çš„æ˜¯ä»é¡µé¢ä¸­æ¥æ”¶äº‹ä»¶çš„é¡ºåº<br>IE çš„äº‹ä»¶æµæ˜¯äº‹ä»¶å†’æ³¡æµ<br>è€Œ <code>Netscape Communicator</code> çš„äº‹ä»¶æµæ˜¯äº‹ä»¶æ•è·æµ<br>DOM2çº§äº‹ä»¶è§„å®šçš„äº‹ä»¶æµåŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>äº‹ä»¶æ•è·é˜¶æ®µï¼›</li><li>å¤„äºç›®æ ‡é˜¶æ®µï¼›</li><li>äº‹ä»¶å†’æ³¡é˜¶æ®µï¼›</li></ul><p>é¦–å…ˆå‘ç”Ÿçš„æ˜¯äº‹ä»¶æ•è·ï¼Œä¸ºæˆªè·äº‹ä»¶æä¾›äº†æœºä¼šã€‚<br>ç„¶åæ˜¯å®é™…çš„ç›®æ ‡æ¥æ”¶åˆ°äº‹ä»¶ã€‚<br>æœ€åä¸€ä¸ªé˜¶æ®µæ˜¯å†’æ³¡é˜¶æ®µï¼Œå¯ä»¥åœ¨è¿™ä¸ªé˜¶æ®µå¯¹äº‹ä»¶åšå‡ºå“åº”<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2340337/1671033844027-574f28ec-feaa-47d5-9d06-cce699bd2bc2.png#averageHue=%23eeeeed&clientId=uadbfb728-c9f3-4&from=drop&id=uf0cc6ef4&originHeight=384&originWidth=684&originalType=binary&ratio=1&rotation=0&showTitle=false&size=76672&status=done&style=none&taskId=uf9318c84-6071-4f59-b387-80ae5e62cc5&title=" alt="38007715-4cc457d0-327d-11e8-9fb3-667fa75fc38c.png"><br>1ã€å½“å¤„äºç›®æ ‡é˜¶æ®µï¼Œæ²¡æœ‰æ•è·ä¸å†’æ³¡ä¹‹åˆ†ï¼Œæ‰§è¡Œé¡ºåºä¼šæŒ‰ç…§<code>addEventListener</code>çš„æ·»åŠ é¡ºåºå†³å®šï¼Œå…ˆæ·»åŠ å…ˆæ‰§è¡Œï¼›<br>2ã€ä½¿ç”¨<code>stopPropagation()</code>å–æ¶ˆäº‹ä»¶ä¼ æ’­æ—¶ï¼Œäº‹ä»¶ä¸ä¼šè¢«ä¼ æ’­ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯ï¼ŒåŒä¸€èŠ‚ç‚¹ä¸Šçš„å…¶ä»–listenerè¿˜æ˜¯ä¼šè¢«æ‰§è¡Œï¼›å¦‚æœæƒ³è¦åŒä¸€å±‚çº§çš„listenerä¹Ÿä¸æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨<code>stopImmediatePropagation()</code>ï¼›</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// list çš„æ•è·</span><br>$list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;list capturing&#x27;</span>);<br>  e.<span class="hljs-title function_">stopPropagation</span>();<br>&#125;, <span class="hljs-literal">true</span>)<br>  <br><span class="hljs-comment">// list æ•è· 2</span><br>$list.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;list capturing2&#x27;</span>);<br>&#125;, <span class="hljs-literal">true</span>)<br><br><span class="hljs-comment">// list capturing</span><br><span class="hljs-comment">// list capturing2</span><br></code></pre></td></tr></table></figure><p>3ã€<code>preventDefault()</code>åªæ˜¯é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œè·ŸJSçš„äº‹ä»¶ä¼ æ’­ä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ï¼›<br>4ã€ä¸€æ—¦å‘èµ·äº†<code>preventDefault()</code>ï¼Œåœ¨ä¹‹åä¼ é€’ä¸‹å»çš„äº‹ä»¶é‡Œé¢ä¹Ÿä¼šæœ‰æ•ˆæœï¼›</p><h3 id="1-2-1-æµ‹è¯•"><a href="#1-2-1-æµ‹è¯•" class="headerlink" title="1.2.1. æµ‹è¯•"></a>1.2.1. æµ‹è¯•</h3><p>å¦‚æœæœ‰ä»¥ä¸‹ä¾‹å­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;!<span class="hljs-variable constant_">DOCTYPE</span> html&gt; <br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span> </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span> </span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Event Bubbling Example<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span> </span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span> </span><br><span class="language-xml"> <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myDiv&quot;</span>&gt;</span>Click Me<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span> </span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><ol><li>äº‹ä»¶æ•è·</li></ol><p>æœ€ä¸å…·ä½“çš„èŠ‚ç‚¹æœ€å…ˆæ”¶åˆ°äº‹ä»¶ï¼Œè€Œæœ€å…·ä½“çš„èŠ‚ç‚¹æœ€åæ”¶åˆ°äº‹ä»¶ã€‚äº‹ä»¶æ•è·å®é™…ä¸Šæ˜¯ä¸ºäº†åœ¨äº‹ä»¶åˆ°è¾¾æœ€ç»ˆç›®æ ‡<br>å‰æ‹¦æˆªäº‹ä»¶ã€‚<br>å¦‚æœå‰é¢çš„ä¾‹å­ä½¿ç”¨äº‹ä»¶æ•è·ï¼Œåˆ™ç‚¹å‡»<div>å…ƒç´ ä¼šä»¥ä¸‹åˆ—é¡ºåºè§¦å‘ click äº‹ä»¶ï¼š</p><ul><li>documentï¼› </li><li><html>ï¼›</li><li><body>ï¼›</li><li><div>ï¼›</li></ul><ol><li>äº‹ä»¶å†’æ³¡</li></ol><p>åœ¨ç‚¹å‡»é¡µé¢ä¸­çš„<div>å…ƒç´ åï¼Œclick äº‹ä»¶ä¼šä»¥å¦‚ä¸‹é¡ºåºå‘ç”Ÿï¼š</p><ul><li><div>ï¼›</li><li><body>ï¼›</li><li><html>ï¼›</li><li>documentï¼›</li></ul><div>å…ƒç´ ï¼Œå³è¢«ç‚¹å‡»çš„å…ƒç´ ï¼Œæœ€å…ˆè§¦å‘ click äº‹ä»¶ã€‚ç„¶åï¼Œclick äº‹ä»¶æ²¿ DOM æ ‘ä¸€è·¯å‘ä¸Šï¼Œåœ¨ç»è¿‡çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šä¾æ¬¡è§¦å‘ï¼Œç›´è‡³åˆ°è¾¾ `document` å¯¹è±¡ã€‚## 1.3. äº‹ä»¶å¯¹è±¡DOM0å’ŒDOM2çš„äº‹ä»¶å¤„ç†ç¨‹åºéƒ½ä¼šè‡ªåŠ¨ä¼ å…¥eventå¯¹è±¡IEä¸­çš„eventå¯¹è±¡å–å†³äºæŒ‡å®šçš„äº‹ä»¶å¤„ç†ç¨‹åºçš„æ–¹æ³•ã€‚IEçš„handlerä¼šåœ¨å…¨å±€ä½œç”¨åŸŸè¿è¡Œï¼Œ`this === window`ï¼Œæ‰€ä»¥åœ¨IEä¸­ä¼šæœ‰`window.event`ã€`event`ä¸¤ç§æƒ…å†µï¼Œåªæœ‰åœ¨äº‹ä»¶å¤„ç†ç¨‹åºæœŸé—´ï¼Œeventå¯¹è±¡æ‰ä¼šå­˜åœ¨ï¼Œä¸€æ—¦äº‹ä»¶å¤„ç†ç¨‹åºæ‰§è¡Œå®Œæˆï¼Œeventå¯¹è±¡å°±ä¼šè¢«é”€æ¯eventå¯¹è±¡é‡Œéœ€è¦å…³å¿ƒçš„ä¸¤ä¸ªå±æ€§ï¼š<ol><li>targetï¼štargetæ°¸è¿œæ˜¯è¢«æ·»åŠ äº†äº‹ä»¶çš„é‚£ä¸ªå…ƒç´ ï¼›</li><li>eventPhaseï¼šè°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºçš„é˜¶æ®µï¼Œæœ‰ä¸‰ä¸ªå€¼<br>1ï¼šæ•è·é˜¶æ®µï¼›<br>2ï¼šå¤„äºç›®æ ‡ï¼›<br>3ï¼šå†’æ³¡é˜¶æ®µï¼›</li></ol><h3 id="1-3-1-preventDefaultä¸stopPropagation"><a href="#1-3-1-preventDefaultä¸stopPropagation" class="headerlink" title="1.3.1. preventDefaultä¸stopPropagation"></a>1.3.1. preventDefaultä¸stopPropagation</h3><p>preventDefaultï¼šæ¯”å¦‚é“¾æ¥è¢«ç‚¹å‡»ä¼šå¯¼èˆªåˆ°å…¶hrefæŒ‡å®šçš„URLï¼Œè¿™ä¸ªå°±æ˜¯é»˜è®¤è¡Œä¸ºï¼›<br>stopPropagationï¼šç«‹å³åœæ­¢äº‹ä»¶åœ¨DOMå±‚æ¬¡ä¸­çš„ä¼ æ’­ï¼ŒåŒ…æ‹¬æ•è·å’Œå†’æ³¡äº‹ä»¶ï¼›<br>IEä¸­å¯¹åº”çš„å±æ€§ï¼š</p><ul><li>srcElement &#x3D;&gt; target</li><li>returnValue &#x3D;&gt; preventDefaukt()</li><li>cancelBubble &#x3D;&gt; stopPropagation()</li></ul><p>IE ä¸æ”¯æŒäº‹ä»¶æ•è·ï¼Œå› è€Œåªèƒ½å–æ¶ˆäº‹ä»¶å†’æ³¡ï¼Œä½†<code>stopPropagation</code>å¯ä»¥åŒæ—¶å–æ¶ˆäº‹ä»¶æ•è·å’Œå†’æ³¡ã€‚<br>å†é’ˆå¯¹ä¸Šé¢ä¸åŒç±»å‹çš„äº‹ä»¶åŠå±æ€§è¿›è¡ŒåŒºåˆ†ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> <span class="hljs-title class_">EventUtil</span> = &#123;<br>  <span class="hljs-comment">// elementæ˜¯å½“å‰å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡getElementById(id)è·å–</span><br>  <span class="hljs-comment">// type æ˜¯äº‹ä»¶ç±»å‹ï¼Œä¸€èˆ¬æ˜¯click ,ä¹Ÿæœ‰å¯èƒ½æ˜¯é¼ æ ‡ã€ç„¦ç‚¹ã€æ»šè½®äº‹ä»¶ç­‰ç­‰</span><br>  <span class="hljs-comment">// handle äº‹ä»¶å¤„ç†å‡½æ•°</span><br>  <span class="hljs-attr">addHandler</span>: <span class="hljs-function">(<span class="hljs-params">element, type, handler</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// å…ˆæ£€æµ‹æ˜¯å¦å­˜åœ¨DOM2çº§æ–¹æ³•,å†æ£€æµ‹IEçš„æ–¹æ³•ï¼Œæœ€åæ˜¯DOM0çº§æ–¹æ³•ï¼ˆä¸€èˆ¬ä¸ä¼šåˆ°è¿™ï¼‰</span><br>    <span class="hljs-keyword">if</span> (element.<span class="hljs-property">addEventListener</span>) &#123;<br>      <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°falseè¡¨ç¤ºå†’æ³¡é˜¶æ®µ</span><br>      element.<span class="hljs-title function_">addEventListener</span>(type, handler, <span class="hljs-literal">false</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">attachEvent</span>) &#123;<br>      element.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">`on<span class="hljs-subst">$&#123;type&#125;</span>`</span>, handler)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      element[<span class="hljs-string">`on<span class="hljs-subst">$&#123;type&#125;</span>`</span>] = handler;<br>    &#125;<br>  &#125;,<br><br>  <span class="hljs-attr">removeHandler</span>: <span class="hljs-function">(<span class="hljs-params">element, type, handler</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (element.<span class="hljs-property">removeEventListener</span>) &#123;<br>      <span class="hljs-comment">// ç¬¬ä¸‰ä¸ªå‚æ•°falseè¡¨ç¤ºå†’æ³¡é˜¶æ®µ</span><br>      element.<span class="hljs-title function_">removeEventListener</span>(type, handler, <span class="hljs-literal">false</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (element.<span class="hljs-property">detachEvent</span>) &#123;<br>      element.<span class="hljs-title function_">detachEvent</span>(<span class="hljs-string">`on<span class="hljs-subst">$&#123;type&#125;</span>`</span>, handler)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      element[<span class="hljs-string">`on<span class="hljs-subst">$&#123;type&#125;</span>`</span>] = <span class="hljs-literal">null</span>;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-comment">// è·å–eventå¯¹è±¡</span><br>  <span class="hljs-attr">getEvent</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> event ? event : <span class="hljs-variable language_">window</span>.<span class="hljs-property">event</span><br>  &#125;,<br>  <span class="hljs-comment">// è·å–å½“å‰ç›®æ ‡</span><br>  <span class="hljs-attr">getTarget</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> event.<span class="hljs-property">target</span> ? event.<span class="hljs-property">target</span> : event.<span class="hljs-property">srcElement</span><br>  &#125;,<br>  <span class="hljs-comment">// é˜»æ­¢é»˜è®¤è¡Œä¸º</span><br>  <span class="hljs-attr">preventDefault</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">preventDefault</span>) &#123;<br>      event.<span class="hljs-title function_">preventDefault</span>()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      event.<span class="hljs-property">returnValue</span> = <span class="hljs-literal">false</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-comment">// åœæ­¢ä¼ æ’­äº‹ä»¶</span><br>  <span class="hljs-attr">stopPropagation</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (event,stopPropagation) &#123;<br>      event.<span class="hljs-title function_">stopPropagation</span>()<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      event.<span class="hljs-property">cancelBubble</span> = <span class="hljs-literal">true</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-4-äº‹ä»¶å§”æ‰˜"><a href="#1-4-äº‹ä»¶å§”æ‰˜" class="headerlink" title="1.4. äº‹ä»¶å§”æ‰˜"></a>1.4. äº‹ä»¶å§”æ‰˜</h2><p>äº‹ä»¶å§”æ‰˜ï¼šç”¨æ¥è§£å†³äº‹ä»¶å¤„ç†ç¨‹åºè¿‡å¤šçš„é—®é¢˜<br>é¡µé¢ç»“æ„å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;ul id=<span class="hljs-string">&quot;myLinks&quot;</span>&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;goSomewhere&quot;</span>&gt;</span>Go somewhere<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;doSomething&quot;</span>&gt;</span>Do something<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sayHi&quot;</span>&gt;</span>Say hi<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br>&lt;/ul&gt;<br></code></pre></td></tr></table></figure><p>æŒ‰ç…§ä¼ ç»Ÿçš„åšæ³•ï¼Œéœ€è¦åƒä¸‹é¢è¿™æ ·ä¸ºå®ƒä»¬æ·»åŠ  3 ä¸ªäº‹ ä»¶å¤„ç†ç¨‹åºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> item1 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;goSomewhere&quot;</span>);<br><span class="hljs-keyword">var</span> item2 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;doSomething&quot;</span>);<br><span class="hljs-keyword">var</span> item3 = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;sayHi&quot;</span>);<br><span class="hljs-title class_">EventUtil</span>.<span class="hljs-title function_">addHandler</span>(item1, <span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)&#123;<br>    location.<span class="hljs-property">href</span> = <span class="hljs-string">&quot;http://www.xianzao.com&quot;</span>;<br>&#125;);<br><span class="hljs-title class_">EventUtil</span>.<span class="hljs-title function_">addHandler</span>(item2, <span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)&#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">&quot;I changed the document&#x27;s title&quot;</span>;<br>&#125;);<br><span class="hljs-title class_">EventUtil</span>.<span class="hljs-title function_">addHandler</span>(item3, <span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)&#123;<br>    <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;hi&quot;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨ä¸€ä¸ªå¤æ‚çš„ Web åº”ç”¨ç¨‹åºä¸­ï¼Œå¯¹æ‰€æœ‰å¯å•å‡»çš„å…ƒç´ éƒ½é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œé‚£ä¹ˆç»“æœå°±ä¼šæœ‰æ•°ä¸ æ¸…çš„ä»£ç ç”¨äºæ·»åŠ äº‹ä»¶å¤„ç†ç¨‹åºã€‚æ­¤æ—¶ï¼Œå¯ä»¥åˆ©ç”¨äº‹ä»¶å§”æ‰˜æŠ€æœ¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼Œåªéœ€åœ¨ DOM æ ‘ä¸­å°½é‡æœ€é«˜çš„å±‚æ¬¡ä¸Šæ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> list = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;myLinks&quot;</span>);<br><span class="hljs-title class_">EventUtil</span>.<span class="hljs-title function_">addHandler</span>(list, <span class="hljs-string">&quot;click&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  event = <span class="hljs-title class_">EventUtil</span>.<span class="hljs-title function_">getEvent</span>(event);<br>  <span class="hljs-keyword">var</span> target = <span class="hljs-title class_">EventUtil</span>.<span class="hljs-title function_">getTarget</span>(event);<br>  <span class="hljs-keyword">switch</span>(target.<span class="hljs-property">id</span>) &#123;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;doSomething&quot;</span>:<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">&quot;I changed the document&#x27;s title&quot;</span>;<br>      <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;goSomewhere&quot;</span>:<br>      location.<span class="hljs-property">href</span> = <span class="hljs-string">&quot;http://www.wrox.com&quot;</span>;<br>      <span class="hljs-keyword">break</span>;<br>  <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;sayHi&quot;</span>: <span class="hljs-number">9</span> <span class="hljs-title function_">alert</span>(<span class="hljs-string">&quot;hi&quot;</span>);<br>    <span class="hljs-keyword">break</span>; <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å­èŠ‚ç‚¹çš„ç‚¹å‡»äº‹ä»¶ä¼šå†’æ³¡åˆ°çˆ¶èŠ‚ç‚¹ï¼Œå¹¶è¢«è¿™ä¸ªæ³¨å†Œäº‹ä»¶å¤„ç†<br>æœ€é€‚åˆé‡‡ç”¨äº‹ä»¶å§”æ‰˜æŠ€æœ¯çš„äº‹ä»¶åŒ…æ‹¬ <code>click</code>ã€<code>mousedown</code>ã€<code>mouseup</code>ã€<code>keydown</code>ã€<code>keyup</code> å’Œ <code>keypress</code>ã€‚ è™½ç„¶ <code>mouseover</code> å’Œ <code>mouseout</code> äº‹ä»¶ä¹Ÿå†’æ³¡ï¼Œä½†è¦é€‚å½“å¤„ç†å®ƒä»¬å¹¶ä¸å®¹æ˜“ï¼Œè€Œä¸”ç»å¸¸éœ€è¦è®¡ç®—å…ƒç´ çš„ä½ç½®ã€‚<br>å¯ä»¥è€ƒè™‘ä¸º document å¯¹è±¡æ·»åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œç”¨ä»¥å¤„ç†é¡µé¢ä¸Šå‘ç”Ÿçš„æŸç§ç‰¹å®šç±»å‹çš„äº‹ä»¶ï¼Œéœ€è¦è·Ÿè¸ªçš„äº‹ä»¶å¤„ç†ç¨‹åºè¶Šå°‘ï¼Œç§»é™¤å®ƒä»¬å°±è¶Šå®¹æ˜“ï¼ˆç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åºå…³ä¹å†…å­˜å’Œæ€§èƒ½ï¼‰ã€‚<br>åªè¦æ˜¯é€šè¿‡ <code>onload</code> äº‹ä»¶å¤„ç†ç¨‹åºæ·»åŠ çš„ä¸œè¥¿ï¼Œæœ€åéƒ½è¦é€šè¿‡ <code>onunload</code> äº‹ä»¶å¤„ç†ç¨‹åºå°†å®ƒä»¬ç§»é™¤ã€‚</p><h1 id="2-æµè§ˆå™¨è¯·æ±‚"><a href="#2-æµè§ˆå™¨è¯·æ±‚" class="headerlink" title="2. æµè§ˆå™¨è¯·æ±‚"></a>2. æµè§ˆå™¨è¯·æ±‚</h1><p>åœ¨æµè§ˆå™¨ç«¯å‘é€ç½‘ç»œè¯·æ±‚çš„å¸¸è§æ–¹å¼ï¼š</p><ol><li>ajaxï¼›</li><li>fetchï¼›</li><li>axiosï¼›</li></ol><h2 id="2-1-ajax"><a href="#2-1-ajax" class="headerlink" title="2.1. ajax"></a>2.1. ajax</h2><blockquote><p>Asynchronous JavaScript And XMLï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯â€œå¼‚æ­¥çš„ Javascript å’Œ XMLâ€ã€‚<br>ajaxæ˜¯jså¼‚æ­¥æŠ€æœ¯çš„æœ¯è¯­ï¼Œæ—©èµ·ç›¸å…³çš„apiæ˜¯XHRã€‚</p></blockquote><p>Ajax æ˜¯ä¸€ä¸ªæŠ€æœ¯ç»Ÿç§°ï¼Œæ˜¯ä¸€ä¸ªæ¦‚å¿µæ¨¡å‹ï¼Œå®ƒå›Šæ‹¬äº†å¾ˆå¤šæŠ€æœ¯ï¼Œå¹¶ä¸ç‰¹æŒ‡æŸä¸€æŠ€æœ¯ï¼Œå®ƒå¾ˆé‡è¦çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯è®©é¡µé¢å®ç°å±€éƒ¨åˆ·æ–°ã€‚<br>ç‰¹ç‚¹ï¼š</p><ul><li>å±€éƒ¨åˆ·æ–°é¡µé¢ï¼Œæ— éœ€é‡è½½æ•´ä¸ªé¡µé¢ã€‚</li></ul><p>ç®€å•æ¥è¯´ï¼ŒAjax æ˜¯ä¸€ç§æ€æƒ³ï¼Œ<code>XMLHttpRequest</code> åªæ˜¯å®ç° Ajax çš„ä¸€ç§æ–¹å¼ã€‚å…¶ä¸­ <code>XMLHttpRequest</code> æ¨¡å—å°±æ˜¯å®ç° Ajax çš„ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ã€‚</p><h3 id="2-1-1-æ‰‹å†™ajax"><a href="#2-1-1-æ‰‹å†™ajax" class="headerlink" title="2.1.1. æ‰‹å†™ajax"></a>2.1.1. æ‰‹å†™ajax</h3><blockquote><p>å»ºè®®å…ˆé˜…è¯»<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest">MDN</a></p></blockquote><p>åˆ©ç”¨ <code>XMLHttpRequest</code> æ¨¡å—å®ç° Ajaxã€‚</p><h4 id="2-1-1-1-åˆ›å»ºå¼‚æ­¥å¯¹è±¡"><a href="#2-1-1-1-åˆ›å»ºå¼‚æ­¥å¯¹è±¡" class="headerlink" title="2.1.1.1. åˆ›å»ºå¼‚æ­¥å¯¹è±¡"></a>2.1.1.1. åˆ›å»ºå¼‚æ­¥å¯¹è±¡</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> xmlHttp;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">XMLHttpRequest</span>) &#123;<br>  <span class="hljs-comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span><br>  xmlHttp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// code for IE6, IE5</span><br>  xmlHttp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&#x27;Microsoft.XMLHTTP&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡<code>XMLHttpRequest</code>æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å¯¹è±¡<code>xmlhttp</code>, IE6, IE5 ä½¿ç”¨ActiveXObjectåˆ›å»ºï¼Œåˆ›å»ºçš„è¿™ä¸ªå¼‚æ­¥å¯¹è±¡ä¸Šæœ‰å¾ˆå¤šå±æ€§å’Œæ–¹æ³•ï¼Œå¸¸ç”¨çš„æœ‰ï¼š</p><ol><li><code>onreadystatechange</code>ï¼šç›‘å¬å¼‚æ­¥å¯¹è±¡è¯·æ±‚çŠ¶æ€ç <code>readyState</code>çš„æ”¹å˜ï¼Œæ¯å½“<code>readyState</code>æ”¹å˜æ—¶ï¼Œå°±ä¼šè§¦å‘<code>onreadystatechange</code>äº‹ä»¶ï¼›</li><li><code>readyState</code>ï¼šè¯·æ±‚çŠ¶æ€ç </li></ol><p><code>readyState</code>è¡¨ç¤ºå¼‚æ­¥å¯¹è±¡ç›®å‰çš„çŠ¶æ€ï¼ŒçŠ¶æ€ç ä»0åˆ°4ï¼š<br>0: è¡¨ç¤ºè¯·æ±‚æœªåˆå§‹åŒ–ï¼Œè¿˜æ²¡æœ‰è°ƒç”¨ <code>open()</code>ï¼›<br>1: æœåŠ¡å™¨è¿æ¥å·²å»ºç«‹ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ <code>send()</code>ï¼›<br>2: è¯·æ±‚å·²æ¥æ”¶ï¼Œæ­£åœ¨å¤„ç†ä¸­ï¼ˆé€šå¸¸ç°åœ¨å¯ä»¥ä»å“åº”ä¸­è·å–å†…å®¹å¤´ï¼‰ï¼›<br>3: è¯·æ±‚å¤„ç†ä¸­ï¼Œé€šå¸¸å“åº”ä¸­å·²æœ‰éƒ¨åˆ†æ•°æ®å¯ç”¨äº†ï¼Œæ²¡æœ‰å…¨éƒ¨å®Œæˆï¼›<br>4: å½“<code>readyState</code>çŠ¶æ€ç ä¸º4æ—¶ï¼Œè¡¨ç¤ºè¯·æ±‚å·²å®Œæˆï¼›æ­¤é˜¶æ®µç¡®è®¤å…¨éƒ¨æ•°æ®éƒ½å·²ç»è§£æå®Œæ¯•ï¼Œå¯ä»¥é€šè¿‡å¼‚æ­¥å¯¹è±¡çš„å±æ€§è·å–å¯¹åº”æ•°æ®ï¼›</p><ol><li>statusï¼šhttpçŠ¶æ€ç </li></ol><p>httpçŠ¶æ€ç è¡¨ç¤ºæˆåŠŸçš„httpçŠ¶æ€ç æœ‰<br><code>xmlHttp.status &gt;= 200 &amp;&amp; xmlHttp.status &lt; 300 || xmlHttp.status == 304</code></p><ol><li>responseTextï¼šåå°è¿”å›çš„å­—ç¬¦ä¸²å½¢å¼çš„å“åº”æ•°æ®ï¼›</li><li>responseXMLï¼šåå°è¿”å›çš„XMLå½¢å¼çš„å“åº”æ•°æ®ï¼›</li></ol><h4 id="2-1-1-2-è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€"><a href="#2-1-1-2-è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€" class="headerlink" title="2.1.1.2. è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€"></a>2.1.1.2. è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€</h4><p>åˆ›å»ºå¼‚æ­¥å¯¹è±¡ä¹‹åï¼Œé€šè¿‡<code>open()</code>æ–¹æ³•è®¾ç½®ajaxè¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€ æ ¼å¼ï¼š<br><code>xmlHttp.open(&quot;GET/POST&quot;,&quot;ajax-get.txt&quot;,true)</code><br>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šè¯·æ±‚çš„ç±»å‹ï¼›GET è¿˜æ˜¯ POSTï¼›<br>ç¬¬äºŒä¸ªå‚æ•°ï¼šè¡¨ç¤ºè¯·æ±‚çš„æ–‡ä»¶çš„åœ°å€urlï¼›<br>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šè®¾ç½®è¯·æ±‚æ–¹æ³•æ˜¯ä¸æ˜¯å¼‚æ­¥asyncï¼Œtrueä¸ºå¼‚æ­¥ï¼Œ falseä¸ºåŒæ­¥ã€‚AJAXå­˜åœ¨çš„æ„ä¹‰å°±æ˜¯å‘å¼‚æ­¥è¯·æ±‚ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªå‚æ•°æ°¸è¿œä¼ trueï¼›</p><p>æ³¨æ„ï¼šæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯IEä¸­çš„ç¼“å­˜é—®é¢˜<br>åœ¨IEæµè§ˆå™¨ä¸­ï¼Œå¦‚æœé€šè¿‡Ajaxå‘é€GETè¯·æ±‚ï¼Œé‚£ä¹ˆIEæµè§ˆå™¨è®¤ä¸ºï¼ŒåŒä¸€ä¸ªURLåªæœ‰ä¸€ä¸ªç»“æœï¼Œå¦‚æœåœ°å€æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå®ƒå°±ä¼šæŠŠä¸Šä¸€æ¬¡è¿”å›çš„ç»“æœï¼Œç›´æ¥è¿”å›ã€‚è¿™æ ·æˆ‘ä»¬ä¸èƒ½å®æ—¶çš„æ‹¿åˆ°å˜åŒ–åçš„æ•°æ®ã€‚å¦‚æœè¦æƒ³æˆ‘ä»¬æ‹¿åˆ°å®æ—¶æ•°æ®ï¼Œå¿…é¡»ä¿è¯æ¯æ¬¡çš„URLéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol><li>Math.random()ï¼›</li><li>new Date().getTime()ï¼›</li></ol><p>å³åœ¨è¯·æ±‚åœ°å€åé¢æ‹¼æ¥ä¸Š?t&#x3D;éšæœºæ•°æˆ–è€…1970.01.01è‡³å½“å‰çš„æ¯«ç§’æ•° æ‰€ä»¥åœ¨IEä¸­é€šè¿‡ajaxå‘é€getè¯·æ±‚æ—¶ï¼Œå¯ä»¥è®¾ç½®è¯·æ±‚åœ°å€ä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">xmlHttp.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;ajax-get.txt?t=&quot;</span> + (<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()),<span class="hljs-literal">true</span>);<br><span class="hljs-comment">//æˆ–</span><br>xmlHttp.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;GET&quot;</span>,<span class="hljs-string">&quot;ajax-get.txt?t=&quot;</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(),<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><h4 id="2-1-1-3-å‘é€è¯·æ±‚"><a href="#2-1-1-3-å‘é€è¯·æ±‚" class="headerlink" title="2.1.1.3. å‘é€è¯·æ±‚"></a>2.1.1.3. å‘é€è¯·æ±‚</h4><p>ç›´æ¥é€šè¿‡å¼‚æ­¥å¯¹è±¡çš„send()å‘é€è¯·æ±‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">xmlHttp.<span class="hljs-title function_">send</span>();<br></code></pre></td></tr></table></figure><p>ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼š å¦‚æœå‘é€POSTè¯·æ±‚ï¼Œä½¿ç”¨<code>setRequestHeader()</code>æ¥æ·»åŠ  HTTPè¯·æ±‚å¤´ï¼Œå¹¶åœ¨send()æ–¹æ³•ä¸­ä¼ é€’è¦å‘é€çš„æ•°æ®ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">xmlHttp.<span class="hljs-title function_">open</span>(<span class="hljs-string">&quot;POST&quot;</span>,<span class="hljs-string">&quot;ajax_test.html&quot;</span>,<span class="hljs-literal">true</span>); <br>xmlHttp.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&quot;Content-type&quot;</span>,<span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>); <br>xmlHttp.<span class="hljs-title function_">send</span>(<span class="hljs-string">&quot;fname=Henry&amp;lname=Ford&quot;</span>);<br></code></pre></td></tr></table></figure><h4 id="2-1-1-4-é€šè¿‡onreadystatechangeç›‘å¬çŠ¶æ€å˜åŒ–"><a href="#2-1-1-4-é€šè¿‡onreadystatechangeç›‘å¬çŠ¶æ€å˜åŒ–" class="headerlink" title="2.1.1.4. é€šè¿‡onreadystatechangeç›‘å¬çŠ¶æ€å˜åŒ–"></a>2.1.1.4. é€šè¿‡onreadystatechangeç›‘å¬çŠ¶æ€å˜åŒ–</h4><p>å½“å¼‚æ­¥å¯¹è±¡çš„readyStateå‘ç”Ÿæ”¹å˜ï¼Œä¼šè§¦å‘<code>onreadystatechange</code>å‡½æ•°ï¼Œå½“readyStateå˜æˆä¸º4æ—¶ï¼Œè¡¨ç¤ºå½“å‰çŠ¶æ€æ˜¯è¯·æ±‚å®Œæ¯•çš„çŠ¶æ€ï¼ŒåŒæ—¶å½“httpçš„å“åº”ç statusä¸º200åˆ°300ä¹‹é—´ï¼ˆåŒ…æ‹¬200å’Œ300ï¼‰æˆ–ä¸º304æ—¶ï¼Œè¡¨ç¤ºajaxè¯·æ±‚æˆåŠŸ;å½“httpçŠ¶æ€ç ä¸æ˜¯200åˆ°300ä¹‹é—´çš„æ•°ä¹Ÿä¸æ˜¯304æ—¶ï¼Œè¡¨ç¤ºè¯·æ±‚ä¸æˆåŠŸ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//4.ç›‘å¬çŠ¶æ€å˜åŒ–</span><br>xmlHttp.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-function">() =&gt;</span> &#123;<br> <span class="hljs-comment">// åˆ¤æ–­å½“å‰çŠ¶æ€æ”¹å˜æ˜¯è¯·æ±‚å®Œæ¯•çš„çŠ¶æ€å—</span><br> <span class="hljs-keyword">if</span> (xmlHttp.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span>) &#123;<br>    <span class="hljs-keyword">if</span> (xmlHttp.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; xmlHttp.<span class="hljs-property">status</span> &lt; <span class="hljs-number">300</span> || xmlHttp.<span class="hljs-property">status</span> == <span class="hljs-number">304</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;æˆåŠŸçš„æ¥æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„æ•°æ®&quot;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;ä¸æˆåŠŸï¼&quot;</span>);<br>    &#125;   <br> &#125;<br>&#125;  <br></code></pre></td></tr></table></figure><h4 id="2-1-1-5-å¤„ç†è¿”å›çš„ç»“æœ"><a href="#2-1-1-5-å¤„ç†è¿”å›çš„ç»“æœ" class="headerlink" title="2.1.1.5. å¤„ç†è¿”å›çš„ç»“æœ"></a>2.1.1.5. å¤„ç†è¿”å›çš„ç»“æœ</h4><p>å¦‚æœæˆåŠŸï¼Œå¯é€šè¿‡å¼‚æ­¥å¯¹è±¡çš„<code>responseText</code>å±æ€§æ¥è·å–æœåŠ¡å™¨è¿”å›çš„å­—ç¬¦ä¸²<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å°è£…ä¸€ä¸ªæ–¹æ³•ajax()ç”¨äºå‘é€è¯·æ±‚<br>å°è£…çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ï¼š</p><ol><li>URLå½“ä¸­åªèƒ½å‡ºç°å­—æ¯ æ•°å­— ä¸‹åˆ’çº¿å’ŒASCIIç ï¼Œä¸èƒ½å‡ºç°ä¸­æ–‡ï¼Œå¯ä»¥ä½¿ç”¨encodeURIComponent()è½¬ç ï¼›</li><li>å½“æˆ‘ä»¬åˆ©ç”¨æˆ‘ä»¬çš„ajaxæ”¾çš„å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°è¿œå¤„æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç­‰å¾…è¿œç¨‹æœåŠ¡å™¨å»å“åº”æˆ‘ä»¬çš„è¯·æ±‚ï¼Œç­‰å¾…è¿œç¨‹æœåŠ¡å™¨å°†å“åº”çš„ç»“æœè¿”å›ç»™æˆ‘ä»¬ï¼Œä½†æ˜¯è¿™ä¸ªå“åº”çš„é€Ÿåº¦æ˜¯ä¸ç¡®å®šçš„ï¼Œå› ä¸ºå“åº”çš„é€Ÿåº¦æ˜¯ç”±æœ¬åœ°ç½‘ç»œå’Œè¿œç¨‹æœåŠ¡å™¨çš„ç½‘é€Ÿç­‰å…±åŒå†³å®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¯èƒ½ä¸€ç›´ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ã€‚è¿™é‡Œéœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼›<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">ajax</span>(&#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,<br>  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;http://localhost:3000/posts&#x27;</span>,<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span>,<br>  <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;success&#x27;</span>, data);<br>  &#125;,<br>  <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;error&#x27;</span>, err);<br>  &#125;,<br>&#125;);<br><br></code></pre></td></tr></table></figure></li></ol><h4 id="2-1-1-6-å…¶ä»–"><a href="#2-1-1-6-å…¶ä»–" class="headerlink" title="2.1.1.6. å…¶ä»–"></a>2.1.1.6. å…¶ä»–</h4><p>è‡³æ­¤ï¼ŒjQueryå®˜æ–¹çš„ajaxè¿˜æ˜¯æœ‰ä¸€å®šçš„å·®å¼‚ï¼Œæ‰€ä»¥è¿˜éœ€è¦è¿›ä¸€æ­¥å®Œå–„</p><ol><li>ä¼ é€’å¤šä¸ªå‚æ•°ï¼Œéœ€è¦ä¿æŒä¼ é€’é¡ºåºã€‚è§£å†³æ–¹æ¡ˆæ˜¯å¯ä»¥æ”¹å†™æˆä¼ é€’çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼›å› ä¸ºå¯¹è±¡é‡Œé¢çš„å€¼ï¼Œä¼ é€’çš„æ˜¯ä¸€ä¸ªå¯¹è±¡å°±ä¸ç”¨è€ƒè™‘å…ˆåé¡ºåºï¼Œé‡Œé¢ç”¨çš„å‚æ•°é€šè¿‡å¯¹è±¡å.å±æ€§åçš„å½¢å¼è·å–ï¼›</li><li>ä¼ é€’è¯·æ±‚ç±»å‹çš„åŒºåˆ†å¤§å°å†™ï¼ŒjQueryå®˜æ–¹çš„æ˜¯å¤§å°å†™éƒ½å¯ä»¥ï¼›è§£å†³æ–¹æ¡ˆæ˜¯å¯ä»¥ä½¿ç”¨<code>toLowerCase</code>()æˆ–è€…<code>toUpperCase</code>()å°†ç±»å‹è½¬æˆå¤§å†™æˆ–å°å†™å†å¯¹æ¯”ï¼›</li><li>æˆ‘ä»¬ä¼ é€’çš„æ•°æ®ç”¨çš„åå­—æ˜¯objï¼ŒjQueryå®˜æ–¹ç”¨çš„æ˜¯dataï¼›<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">ajax</span> = option =&gt; &#123;<br>  <span class="hljs-comment">//type, url, data, timeout, success, errorå°†æ‰€æœ‰å‚æ•°æ¢æˆä¸€ä¸ªå¯¹è±¡&#123;&#125;</span><br><br>  <span class="hljs-comment">//  0.å°†å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²</span><br><br>  <span class="hljs-comment">//å¤„ç†obj</span><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">objToString</span> = data =&gt; &#123;<br>    data.<span class="hljs-property">t</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>();<br>    <span class="hljs-keyword">let</span> res = [];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> key <span class="hljs-keyword">in</span> data) &#123;<br>      <span class="hljs-comment">//éœ€è¦å°†keyå’Œvalueè½¬æˆéä¸­æ–‡çš„å½¢å¼ï¼Œå› ä¸ºurlä¸èƒ½æœ‰ä¸­æ–‡ã€‚ä½¿ç”¨encodeURIComponent();</span><br>      res.<span class="hljs-title function_">push</span>(<span class="hljs-built_in">encodeURIComponent</span>(key) + <span class="hljs-string">&#x27; = &#x27;</span> + <span class="hljs-built_in">encodeURIComponent</span>(data[key]));<br>    &#125;<br>    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&amp;&#x27;</span>);<br>  &#125;;<br><br>  <span class="hljs-keyword">let</span> str = <span class="hljs-title function_">objToString</span>(option.<span class="hljs-property">data</span> || &#123;&#125;);<br><br>  <span class="hljs-comment">//  1.åˆ›å»ºä¸€ä¸ªå¼‚æ­¥å¯¹è±¡xmlHttpï¼›</span><br>  <span class="hljs-keyword">var</span> xmlHttp, timer;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">XMLHttpRequest</span>) &#123;<br>    xmlHttp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (xmlHttp) &#123;<br>    <span class="hljs-comment">// code for IE6, IE5</span><br>    xmlHttp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActiveXObject</span>(<span class="hljs-string">&#x27;Microsoft.xmlHttp&#x27;</span>);<br>  &#125;<br><br>  <span class="hljs-comment">//  2.è®¾ç½®è¯·æ±‚æ–¹å¼å’Œè¯·æ±‚åœ°å€ï¼›</span><br>  <span class="hljs-comment">// åˆ¤æ–­è¯·æ±‚çš„ç±»å‹æ˜¯POSTè¿˜æ˜¯GET</span><br>  <span class="hljs-keyword">if</span> (option.<span class="hljs-property">type</span>.<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">&#x27;get&#x27;</span>) &#123;<br>    xmlHttp.<span class="hljs-title function_">open</span>(option.<span class="hljs-property">type</span>, option.<span class="hljs-property">url</span> + <span class="hljs-string">&#x27;?t=&#x27;</span> + str, <span class="hljs-literal">true</span>);<br>    <span class="hljs-comment">//  3.å‘é€è¯·æ±‚ï¼›</span><br>    xmlHttp.<span class="hljs-title function_">send</span>();<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    xmlHttp.<span class="hljs-title function_">open</span>(option.<span class="hljs-property">type</span>, option.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>);<br>    <span class="hljs-comment">// æ³¨æ„ï¼šåœ¨postè¯·æ±‚ä¸­ï¼Œå¿…é¡»åœ¨openå’Œsendä¹‹é—´æ·»åŠ HTTPè¯·æ±‚å¤´ï¼šsetRequestHeader(header,value);</span><br>    xmlHttp.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;Content-type&#x27;</span>, <span class="hljs-string">&#x27;application/x-www-form-urlencoded&#x27;</span>);<br>    <span class="hljs-comment">//  3.å‘é€è¯·æ±‚ï¼›</span><br>    xmlHttp.<span class="hljs-title function_">send</span>(str);<br>  &#125;<br><br>  <span class="hljs-comment">//  4.ç›‘å¬çŠ¶æ€çš„å˜åŒ–ï¼›</span><br>  xmlHttp.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-built_in">clearInterval</span>(timer);<br>    <span class="hljs-keyword">debugger</span>;<br>    <span class="hljs-keyword">if</span> (xmlHttp.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span>) &#123;<br>      <span class="hljs-keyword">if</span> ((xmlHttp.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; xmlHttp.<span class="hljs-property">status</span> &lt; <span class="hljs-number">300</span>) || xmlHttp.<span class="hljs-property">status</span> == <span class="hljs-number">304</span>) &#123;<br>        <span class="hljs-comment">//  5.å¤„ç†è¿”å›çš„ç»“æœï¼›</span><br>        option.<span class="hljs-title function_">success</span>(xmlHttp.<span class="hljs-property">responseText</span>); <span class="hljs-comment">//æˆåŠŸåå›è°ƒï¼›</span><br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        option.<span class="hljs-title function_">error</span>(xmlHttp.<span class="hljs-property">responseText</span>); <span class="hljs-comment">//å¤±è´¥åå›è°ƒï¼›</span><br>      &#125;<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-comment">//åˆ¤æ–­å¤–ç•Œæ˜¯å¦ä¼ å…¥äº†è¶…æ—¶æ—¶é—´</span><br>  <span class="hljs-keyword">if</span> (option.<span class="hljs-property">timeout</span>) &#123;<br>    timer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>      xmlHttp.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">//ä¸­æ–­è¯·æ±‚</span><br>      <span class="hljs-built_in">clearInterval</span>(timer);<br>    &#125;, option.<span class="hljs-property">timeout</span>);<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure></li></ol><h3 id="2-1-2-æµ‹è¯•"><a href="#2-1-2-æµ‹è¯•" class="headerlink" title="2.1.2. æµ‹è¯•"></a>2.1.2. æµ‹è¯•</h3><p>é€‰æ‹©<code>json-server</code>å¯åŠ¨æœ¬åœ°æœåŠ¡ï¼Œmockæ•°æ®ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  <span class="hljs-string">&quot;posts&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;json-server&quot;</span>,<br>      <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;xianzao&quot;</span><br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;comments&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,<br>      <span class="hljs-string">&quot;body&quot;</span>: <span class="hljs-string">&quot;some comment&quot;</span>,<br>      <span class="hljs-string">&quot;postId&quot;</span>: <span class="hljs-number">1</span><br>    &#125;<br>  ],<br>  <span class="hljs-string">&quot;profile&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;xianzao&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">ajax</span>(&#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,<br>  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;http://localhost:3000/posts&#x27;</span>,<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span>,<br>  <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;success&#x27;</span>, data);<br>  &#125;,<br>  <span class="hljs-attr">error</span>: <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;error&#x27;</span>, err);<br>  &#125;,<br>&#125;);<br><br></code></pre></td></tr></table></figure><h3 id="2-1-3-å®ç°Uploadçš„requestå°è£…"><a href="#2-1-3-å®ç°Uploadçš„requestå°è£…" class="headerlink" title="2.1.3. å®ç°Uploadçš„requestå°è£…"></a>2.1.3. å®ç°Uploadçš„requestå°è£…</h3><p>é’ˆå¯¹<code>fusion</code>ä¸­ <code>[Upload](https://fusion.design/pc/component/upload)</code>ç»„ä»¶ï¼Œå®ç°è‡ªå®šä¹‰è¯·æ±‚çš„å°è£…ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">customRequest</span>(<span class="hljs-params">option</span>) &#123;<br>    <span class="hljs-comment">/* coding here */</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-title function_">abort</span>(<span class="hljs-params"></span>) &#123;<span class="hljs-comment">/* coding here */</span>&#125;&#125;;<br>&#125;<br><br>&lt;<span class="hljs-title class_">Upload</span> request=&#123;customRequest&#125;/&gt;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>customRequest</code>çš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * clone from https://github.com/react-component/upload/blob/master/src/request.js</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getError</span>(<span class="hljs-params">option, xhr, msg</span>) &#123;<br>    msg = msg || <span class="hljs-string">`cannot post <span class="hljs-subst">$&#123;option.action&#125;</span> <span class="hljs-subst">$&#123;xhr.status&#125;</span>&#x27;`</span>;<br>    <span class="hljs-keyword">const</span> err = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(msg);<br>    err.<span class="hljs-property">status</span> = xhr.<span class="hljs-property">status</span>;<br>    err.<span class="hljs-property">method</span> = option.<span class="hljs-property">method</span>;<br>    err.<span class="hljs-property">url</span> = option.<span class="hljs-property">action</span>;<br>    <span class="hljs-keyword">return</span> err;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">getBody</span>(<span class="hljs-params">xhr</span>) &#123;<br>    <span class="hljs-keyword">const</span> text = xhr.<span class="hljs-property">responseText</span> || xhr.<span class="hljs-property">response</span>;<br>    <span class="hljs-keyword">if</span> (!text) &#123;<br>        <span class="hljs-keyword">return</span> text;<br>    &#125;<br><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(text);<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>        <span class="hljs-keyword">return</span> text;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// option &#123;</span><br><span class="hljs-comment">//  onProgress: (event: &#123; percent: number &#125;): void,</span><br><span class="hljs-comment">//  onError: (event: Error, body?: Object): void,</span><br><span class="hljs-comment">//  onSuccess: (body: Object): void,</span><br><span class="hljs-comment">//  data: Object,</span><br><span class="hljs-comment">//  filename: String,</span><br><span class="hljs-comment">//  file: File,</span><br><span class="hljs-comment">//  withCredentials: Boolean,</span><br><span class="hljs-comment">//  action: String,</span><br><span class="hljs-comment">//  headers: Object,</span><br><span class="hljs-comment">//  method: String</span><br><span class="hljs-comment">//  timeout: Number</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">upload</span>(<span class="hljs-params">option</span>) &#123;<br>    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();<br><br>    <span class="hljs-keyword">if</span> (option.<span class="hljs-property">onProgress</span> &amp;&amp; xhr.<span class="hljs-property">upload</span>) &#123;<br>        xhr.<span class="hljs-property">upload</span>.<span class="hljs-property">onprogress</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">progress</span>(<span class="hljs-params">e</span>) &#123;<br>            <span class="hljs-keyword">if</span> (e.<span class="hljs-property">total</span> &gt; <span class="hljs-number">0</span>) &#123;<br>                e.<span class="hljs-property">percent</span> = (e.<span class="hljs-property">loaded</span> / e.<span class="hljs-property">total</span>) * <span class="hljs-number">100</span>;<br>            &#125;<br>            option.<span class="hljs-title function_">onProgress</span>(e);<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();<br><br>    <span class="hljs-keyword">if</span> (option.<span class="hljs-property">data</span>) &#123;<br>        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(option.<span class="hljs-property">data</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;<br>            formData.<span class="hljs-title function_">append</span>(key, option.<span class="hljs-property">data</span>[key]);<br>        &#125;);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (option.<span class="hljs-property">file</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Blob</span>) &#123;<br>        formData.<span class="hljs-title function_">append</span>(option.<span class="hljs-property">filename</span>, option.<span class="hljs-property">file</span>, option.<span class="hljs-property">file</span>.<span class="hljs-property">name</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        formData.<span class="hljs-title function_">append</span>(option.<span class="hljs-property">filename</span>, option.<span class="hljs-property">file</span>);<br>    &#125;<br><br>    xhr.<span class="hljs-property">onerror</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">error</span>(<span class="hljs-params">e</span>) &#123;<br>        option.<span class="hljs-title function_">onError</span>(e);<br>    &#125;;<br><br>    xhr.<span class="hljs-property">onload</span> = <span class="hljs-keyword">function</span> <span class="hljs-title function_">onload</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// allow success when 2xx status</span><br>        <span class="hljs-comment">// see https://github.com/react-component/upload/issues/34</span><br>        <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> &lt; <span class="hljs-number">200</span> || xhr.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">300</span>) &#123;<br>            <span class="hljs-keyword">return</span> option.<span class="hljs-title function_">onError</span>(<span class="hljs-title function_">getError</span>(option, xhr), <span class="hljs-title function_">getBody</span>(xhr));<br>        &#125;<br><br>        option.<span class="hljs-title function_">onSuccess</span>(<span class="hljs-title function_">getBody</span>(xhr), xhr);<br>    &#125;;<br><br>    option.<span class="hljs-property">method</span> = option.<span class="hljs-property">method</span> || <span class="hljs-string">&#x27;POST&#x27;</span>;<br>    xhr.<span class="hljs-title function_">open</span>(option.<span class="hljs-property">method</span>, option.<span class="hljs-property">action</span>, <span class="hljs-literal">true</span>);<br><br>    <span class="hljs-comment">// In Internet Explorer, the timeout property may be set only after calling the open() method and before calling the send() method.</span><br>    <span class="hljs-comment">// see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/timeout</span><br>    <span class="hljs-keyword">const</span> &#123; timeout &#125; = option;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> timeout === <span class="hljs-string">&#x27;number&#x27;</span> &amp;&amp; timeout &gt; <span class="hljs-number">0</span>) &#123;<br>        xhr.<span class="hljs-property">timeout</span> = timeout;<br>        xhr.<span class="hljs-property">ontimeout</span> = <span class="hljs-function">() =&gt;</span> &#123;<br>            <span class="hljs-keyword">const</span> msg = <span class="hljs-string">`Upload abort for exceeding time (timeout: <span class="hljs-subst">$&#123;timeout&#125;</span>ms)`</span>;<br>            option.<span class="hljs-title function_">onError</span>(<span class="hljs-title function_">getError</span>(option, xhr, msg), <span class="hljs-title function_">getBody</span>(xhr));<br>        &#125;;<br>    &#125;<br><br>    <span class="hljs-comment">// Has to be after `.open()`. See https://github.com/enyo/dropzone/issues/179</span><br>    <span class="hljs-keyword">if</span> (option.<span class="hljs-property">withCredentials</span> &amp;&amp; <span class="hljs-string">&#x27;withCredentials&#x27;</span> <span class="hljs-keyword">in</span> xhr) &#123;<br>        xhr.<span class="hljs-property">withCredentials</span> = <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> headers = option.<span class="hljs-property">headers</span> || &#123;&#125;;<br><br>    <span class="hljs-comment">// when set headers[&#x27;X-Requested-With&#x27;] = null , can close default XHR header</span><br>    <span class="hljs-comment">// see https://github.com/react-component/upload/issues/33</span><br>    <span class="hljs-keyword">if</span> (headers[<span class="hljs-string">&#x27;X-Requested-With&#x27;</span>] !== <span class="hljs-literal">null</span>) &#123;<br>        xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">&#x27;X-Requested-With&#x27;</span>, <span class="hljs-string">&#x27;XMLHttpRequest&#x27;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> h <span class="hljs-keyword">in</span> headers) &#123;<br>        <span class="hljs-keyword">if</span> (headers.<span class="hljs-title function_">hasOwnProperty</span>(h) &amp;&amp; headers[h] !== <span class="hljs-literal">null</span>) &#123;<br>            xhr.<span class="hljs-title function_">setRequestHeader</span>(h, headers[h]);<br>        &#125;<br>    &#125;<br>    xhr.<span class="hljs-title function_">send</span>(formData);<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-title function_">abort</span>(<span class="hljs-params"></span>) &#123;<br>            xhr.<span class="hljs-title function_">abort</span>();<br>        &#125;,<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-1-4-æ€»ç»“"><a href="#2-1-4-æ€»ç»“" class="headerlink" title="2.1.4. æ€»ç»“"></a>2.1.4. æ€»ç»“</h3><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œajaxåªæ˜¯ä¸€ç§å¼‚æ­¥è¯·æ±‚çš„æ–¹å¼ï¼Œå¹¶ä¸ç‰¹æŒ‡æŸä¸€ç§å…·ä½“çš„å®ç°æ–¹å¼ï¼Œä½†éšç€ä½¿ç”¨è¿™ç§æ–¹å¼å®ç°ç½‘ç»œè¯·æ±‚æ—¶å†…éƒ¨åˆåŒ…å«è¯·æ±‚çš„æƒ…å†µï¼Œå°±ä¼šå‡ºç°å›è°ƒåœ°ç‹±ï¼Œè¿™ä¹Ÿæ˜¯XHRçš„è¯Ÿç—…ä¹‹ä¸€ï¼Œå› æ­¤ï¼Œåæ¥æ‰å‚¬ç”Ÿäº†æ›´åŠ ä¼˜é›…çš„è¯·æ±‚æ–¹å¼ã€‚</p><h2 id="2-2-fetch"><a href="#2-2-fetch" class="headerlink" title="2.2. fetch"></a>2.2. fetch</h2><p>Fetch æ˜¯åœ¨ ES6 å‡ºç°çš„ï¼Œå®ƒä½¿ç”¨äº† ES6 æå‡ºçš„ Promise å¯¹è±¡ã€‚å®ƒæ˜¯ <code>XMLHttpRequest</code> çš„æ›¿ä»£å“ã€‚<br>æœ‰äººæŠŠå®ƒä¸ Ajax ä½œæ¯”è¾ƒï¼Œå…¶å®è¿™æ˜¯ä¸å¯¹çš„ï¼Œæˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ Ajax æ˜¯æŒ‡ä½¿ç”¨ <code>XMLHttpRequest</code> å®ç°çš„ Ajaxï¼Œæ‰€ä»¥çœŸæ­£åº”è¯¥å’Œ <code>XMLHttpRequest</code> ä½œæ¯”è¾ƒã€‚</p><blockquote><p>Fetch æ˜¯ä¸€ä¸ª APIï¼Œå®ƒæ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå®ƒæ˜¯åŸºäº Promise çš„ã€‚<br>å»ºè®®é˜…è¯»ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">MDN</a><br>ä»¥ä¸‹å†…å®¹æ‘˜é€‰è‡ªï¼š<a href="https://www.ruanyifeng.com/blog/2020/12/fetch-tutorial.html">fetchæ•™å­¦</a></p></blockquote><p>fetch()çš„åŠŸèƒ½ä¸ XMLHttpRequest åŸºæœ¬ç›¸åŒï¼Œä½†æœ‰ä¸‰ä¸ªå·®å¼‚ï¼š</p><ol><li>fetchä½¿ç”¨ Promiseï¼Œä¸ä½¿ç”¨å›è°ƒå‡½æ•°ï¼Œå› æ­¤å¤§å¤§ç®€åŒ–äº†å†™æ³•ï¼Œå†™èµ·æ¥æ›´ç®€æ´ï¼›</li><li>fetché‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒAPI åˆ†æ•£åœ¨å¤šä¸ªå¯¹è±¡ä¸Šï¼ˆResponse å¯¹è±¡ã€Request å¯¹è±¡ã€Headers å¯¹è±¡ï¼‰ï¼Œæ›´åˆç†ä¸€äº›ï¼›ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>XMLHttpRequest</code> çš„ API è®¾è®¡å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œè¾“å…¥ã€è¾“å‡ºã€çŠ¶æ€éƒ½åœ¨åŒä¸€ä¸ªæ¥å£ç®¡ç†ï¼Œå®¹æ˜“å†™å‡ºéå¸¸æ··ä¹±çš„ä»£ç ï¼›</li><li>fetché€šè¿‡æ•°æ®æµï¼ˆStream å¯¹è±¡ï¼‰å¤„ç†æ•°æ®ï¼Œå¯ä»¥åˆ†å—è¯»å–ï¼Œæœ‰åˆ©äºæé«˜ç½‘ç«™æ€§èƒ½è¡¨ç°ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œå¯¹äºè¯·æ±‚å¤§æ–‡ä»¶æˆ–è€…ç½‘é€Ÿæ…¢çš„åœºæ™¯ç›¸å½“æœ‰ç”¨ã€‚<code>XMLHTTPRequest</code> å¯¹è±¡ä¸æ”¯æŒæ•°æ®æµï¼Œæ‰€æœ‰çš„æ•°æ®å¿…é¡»æ”¾åœ¨ç¼“å­˜é‡Œï¼Œä¸æ”¯æŒåˆ†å—è¯»å–ï¼Œå¿…é¡»ç­‰å¾…å…¨éƒ¨æ‹¿åˆ°åï¼Œå†ä¸€æ¬¡æ€§åå‡ºæ¥ï¼›</li></ol><p>åœ¨ç”¨æ³•ä¸Šï¼Œfetch()æ¥å—ä¸€ä¸ª URL å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œé»˜è®¤å‘è¯¥ç½‘å€å‘å‡º GET è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚å®ƒçš„åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(url)<br>  .<span class="hljs-title function_">then</span>(...)<br>  .<span class="hljs-title function_">catch</span>(...)<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªdemoï¼Œä»æœåŠ¡å™¨è·å– JSON æ•°æ®ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://api.github.com/users/ruanyf&#x27;</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">json</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(json))<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Request Failed&#x27;</span>, err)); <br></code></pre></td></tr></table></figure><p>fetch()æ¥æ”¶åˆ°çš„responseæ˜¯ä¸€ä¸ª <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API">Stream å¯¹è±¡</a>ï¼Œ<code>response.json()</code>æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå–å‡ºæ‰€æœ‰å†…å®¹ï¼Œå¹¶å°†å…¶è½¬ä¸º JSON å¯¹è±¡ã€‚<br>Promise å¯ä»¥ä½¿ç”¨ await è¯­æ³•æ”¹å†™ï¼Œä½¿å¾—è¯­ä¹‰æ›´æ¸…æ™°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getJSON</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> url = <span class="hljs-string">&#x27;https://api.github.com/users/ruanyf&#x27;</span>;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Request Failed&#x27;</span>, error);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œawaitè¯­å¥å¿…é¡»æ”¾åœ¨<code>try...catch</code>é‡Œé¢ï¼Œè¿™æ ·æ‰èƒ½æ•æ‰å¼‚æ­¥æ“ä½œä¸­å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ã€‚</p><h3 id="2-2-1-Response"><a href="#2-2-1-Response" class="headerlink" title="2.2.1. Response"></a>2.2.1. Response</h3><ol><li>Response å¯¹è±¡çš„åŒæ­¥å±æ€§</li></ol><p>fetch()è¯·æ±‚æˆåŠŸä»¥åï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ª <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response å¯¹è±¡</a>ã€‚å®ƒå¯¹åº”æœåŠ¡å™¨çš„ HTTP å›åº”ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);<br></code></pre></td></tr></table></figure><p>Response åŒ…å«çš„æ•°æ®é€šè¿‡ Stream æ¥å£å¼‚æ­¥è¯»å–ï¼Œä½†æ˜¯å®ƒè¿˜åŒ…å«ä¸€äº›åŒæ­¥å±æ€§ï¼Œå¯¹åº” HTTP å›åº”çš„æ ‡å¤´ä¿¡æ¯ï¼ˆHeadersï¼‰ï¼Œå¯ä»¥ç«‹å³è¯»å–ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchText</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/readme.txt&#x27;</span>);<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">status</span>); <br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">statusText</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>response.status</code>å’Œ<code>response.statusText</code>å°±æ˜¯ Response çš„åŒæ­¥å±æ€§ï¼Œå¯ä»¥ç«‹å³è¯»å–ã€‚</p><h4 id="2-2-1-1-æ ‡å¤´ä¿¡æ¯"><a href="#2-2-1-1-æ ‡å¤´ä¿¡æ¯" class="headerlink" title="2.2.1.1. æ ‡å¤´ä¿¡æ¯"></a>2.2.1.1. æ ‡å¤´ä¿¡æ¯</h4><ol><li><code>Response.ok</code></li></ol><p><code>Response.ok</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œtrueå¯¹åº” HTTP è¯·æ±‚çš„çŠ¶æ€ç  200 åˆ° 299ï¼Œfalseå¯¹åº”å…¶ä»–çš„çŠ¶æ€ç ï¼›</p><ol><li><code>Response.status</code></li></ol><p><code>Response.status</code>å±æ€§è¿”å›ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤º HTTP å›åº”çš„çŠ¶æ€ç ï¼ˆä¾‹å¦‚200ï¼Œè¡¨ç¤ºæˆåŠŸè¯·æ±‚ï¼‰ï¼›</p><ol><li><code>Response.statusText</code></li></ol><p><code>Response.statusText</code>å±æ€§è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤º HTTP å›åº”çš„çŠ¶æ€ä¿¡æ¯ï¼ˆä¾‹å¦‚è¯·æ±‚æˆåŠŸä»¥åï¼ŒæœåŠ¡å™¨è¿”å›â€OKâ€ï¼‰ï¼›</p><ol><li><code>Response.url</code></li></ol><p><code>Response.url</code>å±æ€§è¿”å›è¯·æ±‚çš„ URLã€‚å¦‚æœ URL å­˜åœ¨è·³è½¬ï¼Œè¯¥å±æ€§è¿”å›çš„æ˜¯æœ€ç»ˆ URLï¼›</p><ol><li><code>Response.type</code></li></ol><p><code>Response.type</code>å±æ€§è¿”å›è¯·æ±‚çš„ç±»å‹ã€‚å¯èƒ½çš„å€¼å¦‚ä¸‹ï¼š</p><ul><li>basicï¼šæ™®é€šè¯·æ±‚ï¼Œå³åŒæºè¯·æ±‚ï¼›</li><li>corsï¼šè·¨åŸŸè¯·æ±‚ï¼›</li><li>errorï¼šç½‘ç»œé”™è¯¯ï¼Œä¸»è¦ç”¨äº Service Workerï¼›</li><li>opaqueï¼šå¦‚æœfetch()è¯·æ±‚çš„typeå±æ€§è®¾ä¸ºno-corsï¼Œå°±ä¼šè¿”å›è¿™ä¸ªå€¼ã€‚è¡¨ç¤ºå‘å‡ºçš„æ˜¯ç®€å•çš„è·¨åŸŸè¯·æ±‚ï¼Œç±»ä¼¼<form>è¡¨å•çš„é‚£ç§è·¨åŸŸè¯·æ±‚ï¼›</li><li>opaqueredirectï¼šå¦‚æœfetch()è¯·æ±‚çš„redirectå±æ€§è®¾ä¸ºmanualï¼Œå°±ä¼šè¿”å›è¿™ä¸ªå€¼ï¼›</li></ul><ol><li><code>Response.redirected</code></li></ol><p><code>Response.redirected</code>å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯·æ±‚æ˜¯å¦å‘ç”Ÿè¿‡è·³è½¬ã€‚</p><h4 id="2-2-1-2-åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ"><a href="#2-2-1-2-åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ" class="headerlink" title="2.2.1.2. åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ"></a>2.2.1.2. åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸ</h4><p>fetch()å‘å‡ºè¯·æ±‚ä»¥åï¼Œæœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„æ³¨æ„ç‚¹ï¼šåªæœ‰ç½‘ç»œé”™è¯¯ï¼Œæˆ–è€…æ— æ³•è¿æ¥æ—¶ï¼Œfetch()æ‰ä¼šæŠ¥é”™ï¼Œå…¶ä»–æƒ…å†µéƒ½ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯è®¤ä¸ºè¯·æ±‚æˆåŠŸã€‚<br>è¿™å°±æ˜¯è¯´ï¼Œå³ä½¿æœåŠ¡å™¨è¿”å›çš„çŠ¶æ€ç æ˜¯ 4xx æˆ– 5xxï¼Œfetch()ä¹Ÿä¸ä¼šæŠ¥é”™ï¼ˆå³ Promise ä¸ä¼šå˜ä¸º rejectedçŠ¶æ€ï¼‰ã€‚</p><ol><li>Response.status</li></ol><p><code>Response.status</code>å±æ€§ï¼Œå¾—åˆ° HTTP å›åº”çš„çœŸå®çŠ¶æ€ç ï¼Œæ‰èƒ½åˆ¤æ–­è¯·æ±‚æ˜¯å¦æˆåŠŸã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchText</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/readme.txt&#x27;</span>);<br>  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; response.<span class="hljs-property">status</span> &lt; <span class="hljs-number">300</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>();<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(response.<span class="hljs-property">statusText</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>response.status</code>å±æ€§åªæœ‰ç­‰äº 2xx ï¼ˆ200~299ï¼‰ï¼Œæ‰èƒ½è®¤å®šè¯·æ±‚æˆåŠŸã€‚è¿™é‡Œä¸ç”¨è€ƒè™‘ç½‘å€è·³è½¬ï¼ˆçŠ¶æ€ç ä¸º 3xxï¼‰ï¼Œå› ä¸ºfetch()ä¼šå°†è·³è½¬çš„çŠ¶æ€ç è‡ªåŠ¨è½¬ä¸º 200ã€‚</p><ol><li>response.okæ˜¯å¦ä¸ºtrue<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">if</span> (response.<span class="hljs-property">ok</span>) &#123;<br>  <span class="hljs-comment">// è¯·æ±‚æˆåŠŸ</span><br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-comment">// è¯·æ±‚å¤±è´¥</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h4 id="2-2-1-3-Response-headers"><a href="#2-2-1-3-Response-headers" class="headerlink" title="2.2.1.3. Response.headers"></a>2.2.1.3. Response.headers</h4><p>Response å¯¹è±¡è¿˜æœ‰ä¸€ä¸ªResponse.headerså±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ª <a href="https://developer.mozilla.org/en-US/docs/Web/API/Headers">Headers å¯¹è±¡</a>ï¼Œå¯¹åº” HTTP å›åº”çš„æ‰€æœ‰æ ‡å¤´ã€‚<br>Headers å¯¹è±¡å¯ä»¥ä½¿ç”¨forâ€¦ofå¾ªç¯è¿›è¡Œéå†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> [key, value] <span class="hljs-keyword">of</span> response.<span class="hljs-property">headers</span>) &#123; <br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;key&#125;</span> : <span class="hljs-subst">$&#123;value&#125;</span>`</span>);  <br>&#125;<br><br><span class="hljs-comment">// æˆ–è€…</span><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> [key, value] <span class="hljs-keyword">of</span> response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">entries</span>()) &#123; <br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;key&#125;</span> : <span class="hljs-subst">$&#123;value&#125;</span>`</span>);  <br>&#125;<br></code></pre></td></tr></table></figure><p>Headers å¯¹è±¡æä¾›äº†ä»¥ä¸‹æ–¹æ³•ï¼Œç”¨æ¥æ“ä½œæ ‡å¤´ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">get</span>()ï¼šæ ¹æ®æŒ‡å®šçš„é”®åï¼Œè¿”å›é”®å€¼ã€‚<br><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">has</span>()ï¼š è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦åŒ…å«æŸä¸ªæ ‡å¤´ã€‚<br><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">set</span>()ï¼šå°†æŒ‡å®šçš„é”®åè®¾ç½®ä¸ºæ–°çš„é”®å€¼ï¼Œå¦‚æœè¯¥é”®åä¸å­˜åœ¨åˆ™ä¼šæ·»åŠ ã€‚<br><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">append</span>()ï¼šæ·»åŠ æ ‡å¤´ã€‚<br><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">delete</span>()ï¼šåˆ é™¤æ ‡å¤´ã€‚<br><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">keys</span>()ï¼šè¿”å›ä¸€ä¸ªéå†å™¨ï¼Œå¯ä»¥ä¾æ¬¡éå†æ‰€æœ‰é”®åã€‚<br><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">values</span>()ï¼šè¿”å›ä¸€ä¸ªéå†å™¨ï¼Œå¯ä»¥ä¾æ¬¡éå†æ‰€æœ‰é”®å€¼ã€‚<br><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">entries</span>()ï¼šè¿”å›ä¸€ä¸ªéå†å™¨ï¼Œå¯ä»¥ä¾æ¬¡éå†æ‰€æœ‰é”®å€¼å¯¹ï¼ˆ[key, value]ï¼‰ã€‚<br><span class="hljs-title class_">Headers</span>.<span class="hljs-title function_">forEach</span>()ï¼šä¾æ¬¡éå†æ ‡å¤´ï¼Œæ¯ä¸ªæ ‡å¤´éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡å‚æ•°å‡½æ•°ã€‚<br></code></pre></td></tr></table></figure><p>è¿™äº›æ–¹æ³•ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯<code>response.headers.get()</code>ï¼Œç”¨äºè¯»å–æŸä¸ªæ ‡å¤´çš„å€¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> response =  <span class="hljs-keyword">await</span>  <span class="hljs-title function_">fetch</span>(url);  <br>response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>)<br><span class="hljs-comment">// application/json; charset=utf-8</span><br></code></pre></td></tr></table></figure><p><code>Headers.keys()</code>å’Œ<code>Headers.values()</code>æ–¹æ³•ç”¨æ¥åˆ†åˆ«éå†æ ‡å¤´çš„é”®åå’Œé”®å€¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// é”®å</span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> key <span class="hljs-keyword">of</span> myHeaders.<span class="hljs-title function_">keys</span>()) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key);<br>&#125;<br><br><span class="hljs-comment">// é”®å€¼</span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> value <span class="hljs-keyword">of</span> myHeaders.<span class="hljs-title function_">values</span>()) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);<br>&#125;<br></code></pre></td></tr></table></figure><p>Headers.forEach()æ–¹æ³•ä¹Ÿå¯ä»¥éå†æ‰€æœ‰çš„é”®å€¼å’Œé”®åã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);<br>response.<span class="hljs-property">headers</span>.<span class="hljs-title function_">forEach</span>(<br>  <span class="hljs-function">(<span class="hljs-params">value, key</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key, <span class="hljs-string">&#x27;:&#x27;</span>, value)<br>);<br></code></pre></td></tr></table></figure><h4 id="2-2-1-4-è¯»å–å†…å®¹çš„æ–¹æ³•"><a href="#2-2-1-4-è¯»å–å†…å®¹çš„æ–¹æ³•" class="headerlink" title="2.2.1.4. è¯»å–å†…å®¹çš„æ–¹æ³•"></a>2.2.1.4. è¯»å–å†…å®¹çš„æ–¹æ³•</h4><p>Responseå¯¹è±¡æ ¹æ®æœåŠ¡å™¨è¿”å›çš„ä¸åŒç±»å‹çš„æ•°æ®ï¼Œæä¾›äº†ä¸åŒçš„è¯»å–æ–¹æ³•ã€‚</p><ul><li>response.text()ï¼šå¾—åˆ°æ–‡æœ¬å­—ç¬¦ä¸²ï¼›</li><li>response.json()ï¼šå¾—åˆ° JSON å¯¹è±¡ï¼›</li><li>response.blob()ï¼šå¾—åˆ°äºŒè¿›åˆ¶ Blob å¯¹è±¡ï¼›</li><li>response.formData()ï¼šå¾—åˆ° FormData è¡¨å•å¯¹è±¡ï¼›</li><li>response.arrayBuffer()ï¼šå¾—åˆ°äºŒè¿›åˆ¶ ArrayBuffer å¯¹è±¡ï¼›</li></ul><p>è¿™5ä¸ªè¯»å–æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œè¿”å›çš„éƒ½æ˜¯ Promise å¯¹è±¡ã€‚å¿…é¡»ç­‰åˆ°å¼‚æ­¥æ“ä½œç»“æŸï¼Œæ‰èƒ½å¾—åˆ°æœåŠ¡å™¨è¿”å›çš„å®Œæ•´æ•°æ®ã€‚</p><ol><li>response.text()</li></ol><p><code>response.text()</code>å¯ä»¥ç”¨äºè·å–æ–‡æœ¬æ•°æ®ï¼Œæ¯”å¦‚ HTML æ–‡ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/users.html&#x27;</span>);<br><span class="hljs-keyword">const</span> body = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>();<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span> = body<br></code></pre></td></tr></table></figure><ol><li>response.json()</li></ol><p><code>response.json()</code>ä¸»è¦ç”¨äºè·å–æœåŠ¡å™¨è¿”å›çš„ JSON æ•°æ®ã€‚</p><ol><li>response.formData()</li></ol><p><code>response.formData()</code>ä¸»è¦ç”¨åœ¨ Service Worker é‡Œé¢ï¼Œæ‹¦æˆªç”¨æˆ·æäº¤çš„è¡¨å•ï¼Œä¿®æ”¹æŸäº›æ•°æ®ä»¥åï¼Œå†æäº¤ç»™æœåŠ¡å™¨ã€‚</p><ol><li>response.blob()</li></ol><p><code>response.blob()</code>ç”¨äºè·å–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;flower.jpg&#x27;</span>);<br><span class="hljs-keyword">const</span> myBlob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();<br><span class="hljs-keyword">const</span> objectURL = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(myBlob);<br><br><span class="hljs-keyword">const</span> myImage = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;img&#x27;</span>);<br>myImage.<span class="hljs-property">src</span> = objectURL;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹è¯»å–å›¾ç‰‡æ–‡ä»¶flower.jpgï¼Œæ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šã€‚</p><ol><li>response.arrayBuffer()</li></ol><p><code>response.arrayBuffer()</code>ä¸»è¦ç”¨äºè·å–æµåª’ä½“æ–‡ä»¶ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> audioCtx = <span class="hljs-keyword">new</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title class_">AudioContext</span>();<br><span class="hljs-keyword">const</span> source = audioCtx.<span class="hljs-title function_">createBufferSource</span>();<br><br><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;song.ogg&#x27;</span>);<br><span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">arrayBuffer</span>();<br><br><span class="hljs-keyword">const</span> decodeData = <span class="hljs-keyword">await</span> audioCtx.<span class="hljs-title function_">decodeAudioData</span>(buffer);<br>source.<span class="hljs-property">buffer</span> = buffer;<br>source.<span class="hljs-title function_">connect</span>(audioCtx.<span class="hljs-property">destination</span>);<br>source.<span class="hljs-property">loop</span> = <span class="hljs-literal">true</span>;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹æ˜¯response.arrayBuffer()è·å–éŸ³é¢‘æ–‡ä»¶song.oggï¼Œç„¶ååœ¨çº¿æ’­æ”¾çš„ä¾‹å­ã€‚</p><h4 id="2-2-1-5-Response-clone"><a href="#2-2-1-5-Response-clone" class="headerlink" title="2.2.1.5. Response.clone"></a>2.2.1.5. Response.clone</h4><p>Stream å¯¹è±¡åªèƒ½è¯»å–ä¸€æ¬¡ï¼Œè¯»å–å®Œå°±æ²¡äº†ã€‚è¿™æ„å‘³ç€ï¼Œå‰ä¸€èŠ‚çš„äº”ä¸ªè¯»å–æ–¹æ³•ï¼Œåªèƒ½ä½¿ç”¨ä¸€ä¸ªï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> text =  <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>();<br><span class="hljs-keyword">let</span> json =  <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();  <span class="hljs-comment">// æŠ¥é”™</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹å…ˆä½¿ç”¨äº†<code>response.text()</code>ï¼Œå°±æŠŠ Stream è¯»å®Œäº†ã€‚åé¢å†è°ƒç”¨<code>response.json()</code>ï¼Œå°±æ²¡æœ‰å†…å®¹å¯è¯»äº†ï¼Œæ‰€ä»¥æŠ¥é”™ã€‚<br>Response å¯¹è±¡æä¾›<code>Response.clone()</code>æ–¹æ³•ï¼Œåˆ›å»ºResponseå¯¹è±¡çš„å‰¯æœ¬ï¼Œå®ç°å¤šæ¬¡è¯»å–ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> response1 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;flowers.jpg&#x27;</span>);<br><span class="hljs-keyword">const</span> response2 = response1.<span class="hljs-title function_">clone</span>();<br><br><span class="hljs-keyword">const</span> myBlob1 = <span class="hljs-keyword">await</span> response1.<span class="hljs-title function_">blob</span>();<br><span class="hljs-keyword">const</span> myBlob2 = <span class="hljs-keyword">await</span> response2.<span class="hljs-title function_">blob</span>();<br><br>image1.<span class="hljs-property">src</span> = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(myBlob1);<br>image2.<span class="hljs-property">src</span> = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(myBlob2);<br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œ<code>response.clone()</code>å¤åˆ¶äº†ä¸€ä»½ Response å¯¹è±¡ï¼Œç„¶åå°†åŒä¸€å¼ å›¾ç‰‡è¯»å–äº†ä¸¤æ¬¡ã€‚</p><h4 id="2-2-1-6-Response-body"><a href="#2-2-1-6-Response-body" class="headerlink" title="2.2.1.6. Response.body"></a>2.2.1.6. Response.body</h4><p><code>Response.body</code>å±æ€§æ˜¯ Response å¯¹è±¡æš´éœ²å‡ºçš„åº•å±‚æ¥å£ï¼Œè¿”å›ä¸€ä¸ª <code>ReadableStream</code> å¯¹è±¡ï¼Œä¾›ç”¨æˆ·æ“ä½œã€‚<br>å®ƒå¯ä»¥ç”¨æ¥åˆ†å—è¯»å–å†…å®¹ï¼Œåº”ç”¨ä¹‹ä¸€å°±æ˜¯æ˜¾ç¤ºä¸‹è½½çš„è¿›åº¦ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;flower.jpg&#x27;</span>);<br><span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();<br><br><span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123;done, value&#125; = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();<br><br>  <span class="hljs-keyword">if</span> (done) &#123;<br>    <span class="hljs-keyword">break</span>;<br>  &#125;<br><br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Received <span class="hljs-subst">$&#123;value.length&#125;</span> bytes`</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p><code>response.body.getReader()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªéå†å™¨ã€‚è¿™ä¸ªéå†å™¨çš„read()æ–¹æ³•æ¯æ¬¡è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºæœ¬æ¬¡è¯»å–çš„å†…å®¹å—ã€‚<br>è¿™ä¸ªå¯¹è±¡çš„doneå±æ€§æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨æ¥åˆ¤æ–­æœ‰æ²¡æœ‰è¯»å®Œï¼›valueå±æ€§æ˜¯ä¸€ä¸ª arrayBuffer æ•°ç»„ï¼Œè¡¨ç¤ºå†…å®¹å—çš„å†…å®¹ï¼Œè€Œvalue.lengthå±æ€§æ˜¯å½“å‰å—çš„å¤§å°ã€‚</p><h3 id="2-2-2-å®šåˆ¶-HTTP-è¯·æ±‚"><a href="#2-2-2-å®šåˆ¶-HTTP-è¯·æ±‚" class="headerlink" title="2.2.2. å®šåˆ¶ HTTP è¯·æ±‚"></a>2.2.2. å®šåˆ¶ HTTP è¯·æ±‚</h3><p>fetch()çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ URLï¼Œè¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œä½œä¸ºé…ç½®å¯¹è±¡ï¼Œå®šåˆ¶å‘å‡ºçš„ HTTP è¯·æ±‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(url, optionObj)<br></code></pre></td></tr></table></figure><p>HTTP è¯·æ±‚çš„æ–¹æ³•ã€æ ‡å¤´ã€æ•°æ®ä½“éƒ½åœ¨è¿™ä¸ªå¯¹è±¡é‡Œé¢è®¾ç½®ã€‚</p><h4 id="2-2-2-1-POST-è¯·æ±‚"><a href="#2-2-2-1-POST-è¯·æ±‚" class="headerlink" title="2.2.2.1. POST è¯·æ±‚"></a>2.2.2.1. POST è¯·æ±‚</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>  <span class="hljs-attr">headers</span>: &#123;<br>    <span class="hljs-string">&quot;Content-type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>,<br>  &#125;,<br>  <span class="hljs-attr">body</span>: <span class="hljs-string">&#x27;foo=bar&amp;lorem=ipsum&#x27;</span>,<br>&#125;);<br><br><span class="hljs-keyword">const</span> json = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();<br></code></pre></td></tr></table></figure><p>é…ç½®å¯¹è±¡ç”¨åˆ°äº†ä¸‰ä¸ªå±æ€§ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">methodï¼š<span class="hljs-variable constant_">HTTP</span> è¯·æ±‚çš„æ–¹æ³•ï¼Œ<span class="hljs-variable constant_">POST</span>ã€<span class="hljs-variable constant_">DELETE</span>ã€<span class="hljs-variable constant_">PUT</span>éƒ½åœ¨è¿™ä¸ªå±æ€§è®¾ç½®ã€‚<br>headersï¼šä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šåˆ¶ <span class="hljs-variable constant_">HTTP</span> è¯·æ±‚çš„æ ‡å¤´ã€‚<br>bodyï¼š<span class="hljs-variable constant_">POST</span> è¯·æ±‚çš„æ•°æ®ä½“ã€‚<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæœ‰äº›æ ‡å¤´ä¸èƒ½é€šè¿‡headerså±æ€§è®¾ç½®ï¼Œæ¯”å¦‚<code>Content-Length</code>ã€Cookieã€Hostç­‰ç­‰ã€‚å®ƒä»¬æ˜¯ç”±æµè§ˆå™¨è‡ªåŠ¨ç”Ÿæˆï¼Œæ— æ³•ä¿®æ”¹ã€‚</p><h4 id="2-2-2-2-æäº¤-JSON-æ•°æ®"><a href="#2-2-2-2-æäº¤-JSON-æ•°æ®" class="headerlink" title="2.2.2.2. æäº¤ JSON æ•°æ®"></a>2.2.2.2. æäº¤ JSON æ•°æ®</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> user =  &#123; <span class="hljs-attr">name</span>:  <span class="hljs-string">&#x27;John&#x27;</span>, <span class="hljs-attr">surname</span>:  <span class="hljs-string">&#x27;Smith&#x27;</span>  &#125;;<br><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/article/fetch/post/user&#x27;</span>, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>  <span class="hljs-attr">headers</span>: &#123;<br>   <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json;charset=utf-8&#x27;</span><br>  &#125;, <br>  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user) <br>&#125;);<br></code></pre></td></tr></table></figure><p>æ ‡å¤´<code>Content-Type</code>è¦è®¾æˆ<code>&#39;application/json;charset=utf-8&#39;</code>ã€‚å› ä¸ºé»˜è®¤å‘é€çš„æ˜¯çº¯æ–‡æœ¬ï¼Œ<code>Content-Type</code>çš„é»˜è®¤å€¼æ˜¯<code>&#39;text/plain;charset=UTF-8&#39;</code>ã€‚</p><h4 id="2-2-2-3-æäº¤è¡¨å•"><a href="#2-2-2-3-æäº¤è¡¨å•" class="headerlink" title="2.2.2.3. æäº¤è¡¨å•"></a>2.2.2.3. æäº¤è¡¨å•</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> form = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;form&#x27;</span>);<br><br><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/users&#x27;</span>, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>  <span class="hljs-attr">body</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(form)<br>&#125;)<br></code></pre></td></tr></table></figure><h4 id="2-2-2-4-æ–‡ä»¶ä¸Šä¼ "><a href="#2-2-2-4-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="2.2.2.4. æ–‡ä»¶ä¸Šä¼ "></a>2.2.2.4. æ–‡ä»¶ä¸Šä¼ </h4><p>å¦‚æœè¡¨å•é‡Œé¢æœ‰æ–‡ä»¶é€‰æ‹©å™¨ï¼Œå¯ä»¥ç”¨å‰ä¸€ä¸ªä¾‹å­çš„å†™æ³•ï¼Œä¸Šä¼ çš„æ–‡ä»¶åŒ…å«åœ¨æ•´ä¸ªè¡¨å•é‡Œé¢ï¼Œä¸€èµ·æäº¤ã€‚<br>å¦ä¸€ç§æ–¹æ³•æ˜¯ç”¨è„šæœ¬æ·»åŠ æ–‡ä»¶ï¼Œæ„é€ å‡ºä¸€ä¸ªè¡¨å•ï¼Œè¿›è¡Œä¸Šä¼ ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> input = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;input[type=&quot;file&quot;]&#x27;</span>);<br><br><span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();<br>data.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;file&#x27;</span>, input.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>]);<br>data.<span class="hljs-title function_">append</span>(<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;foo&#x27;</span>);<br><br><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/avatars&#x27;</span>, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>  <span class="hljs-attr">body</span>: data<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="2-2-2-5-ç›´æ¥ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®"><a href="#2-2-2-5-ç›´æ¥ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®" class="headerlink" title="2.2.2.5. ç›´æ¥ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®"></a>2.2.2.5. ç›´æ¥ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®</h4><p>fetch()ä¹Ÿå¯ä»¥ç›´æ¥ä¸Šä¼ äºŒè¿›åˆ¶æ•°æ®ï¼Œå°† Blob æˆ– arrayBuffer æ•°æ®æ”¾åœ¨bodyå±æ€§é‡Œé¢ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> blob = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span>   <br>  canvasElem.<span class="hljs-title function_">toBlob</span>(resolve,  <span class="hljs-string">&#x27;image/png&#x27;</span>)<br>);<br><br><span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/article/fetch/post/image&#x27;</span>, &#123;<br>  <span class="hljs-attr">method</span>:  <span class="hljs-string">&#x27;POST&#x27;</span>,<br>  <span class="hljs-attr">body</span>: blob<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="2-2-3-option-API"><a href="#2-2-3-option-API" class="headerlink" title="2.2.3. option API"></a>2.2.3. option API</h3><p>fetch()ç¬¬äºŒä¸ªå‚æ•°çš„å®Œæ•´ API å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> response = <span class="hljs-title function_">fetch</span>(url, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&quot;GET&quot;</span>,<br>  <span class="hljs-attr">headers</span>: &#123;<br>    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/plain;charset=UTF-8&quot;</span><br>  &#125;,<br>  <span class="hljs-attr">body</span>: <span class="hljs-literal">undefined</span>,<br>  <span class="hljs-attr">referrer</span>: <span class="hljs-string">&quot;about:client&quot;</span>,<br>  <span class="hljs-attr">referrerPolicy</span>: <span class="hljs-string">&quot;no-referrer-when-downgrade&quot;</span>,<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&quot;cors&quot;</span>, <br>  <span class="hljs-attr">credentials</span>: <span class="hljs-string">&quot;same-origin&quot;</span>,<br>  <span class="hljs-attr">cache</span>: <span class="hljs-string">&quot;default&quot;</span>,<br>  <span class="hljs-attr">redirect</span>: <span class="hljs-string">&quot;follow&quot;</span>,<br>  <span class="hljs-attr">integrity</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-attr">keepalive</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">signal</span>: <span class="hljs-literal">undefined</span><br>&#125;);<br></code></pre></td></tr></table></figure><p>fetch()è¯·æ±‚çš„åº•å±‚ç”¨çš„æ˜¯ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request/Request">Request() å¯¹è±¡</a>çš„æ¥å£ï¼Œå‚æ•°å®Œå…¨ä¸€æ ·ï¼Œå› æ­¤ä¸Šé¢çš„ API ä¹Ÿæ˜¯Request()çš„ APIã€‚</p><h4 id="2-2-3-1-cache"><a href="#2-2-3-1-cache" class="headerlink" title="2.2.3.1. cache"></a>2.2.3.1. cache</h4><p>cacheå±æ€§æŒ‡å®šå¦‚ä½•å¤„ç†ç¼“å­˜ã€‚å¯èƒ½çš„å–å€¼å¦‚ä¸‹ï¼š</p><ul><li>defaultï¼šé»˜è®¤å€¼ï¼Œå…ˆåœ¨ç¼“å­˜é‡Œé¢å¯»æ‰¾åŒ¹é…çš„è¯·æ±‚ï¼›</li><li>no-storeï¼šç›´æ¥è¯·æ±‚è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¸æ›´æ–°ç¼“å­˜ï¼›</li><li>reloadï¼šç›´æ¥è¯·æ±‚è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ›´æ–°ç¼“å­˜ï¼›</li><li>no-cacheï¼šå°†æœåŠ¡å™¨èµ„æºè·Ÿæœ¬åœ°ç¼“å­˜è¿›è¡Œæ¯”è¾ƒï¼Œæœ‰æ–°çš„ç‰ˆæœ¬æ‰ä½¿ç”¨æœåŠ¡å™¨èµ„æºï¼Œå¦åˆ™ä½¿ç”¨ç¼“å­˜ï¼›</li><li>force-cacheï¼šç¼“å­˜ä¼˜å…ˆï¼Œåªæœ‰ä¸å­˜åœ¨ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œæ‰è¯·æ±‚è¿œç¨‹æœåŠ¡å™¨ï¼›</li><li>only-if-cachedï¼šåªæ£€æŸ¥ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜é‡Œé¢ä¸å­˜åœ¨ï¼Œå°†è¿”å›504é”™è¯¯ï¼›</li></ul><h4 id="2-2-3-2-mode"><a href="#2-2-3-2-mode" class="headerlink" title="2.2.3.2. mode"></a>2.2.3.2. mode</h4><p>modeå±æ€§æŒ‡å®šè¯·æ±‚çš„æ¨¡å¼ã€‚å¯èƒ½çš„å–å€¼å¦‚ä¸‹ï¼š</p><ul><li>corsï¼šé»˜è®¤å€¼ï¼Œå…è®¸è·¨åŸŸè¯·æ±‚ï¼›</li><li>same-originï¼šåªå…è®¸åŒæºè¯·æ±‚ï¼›</li><li>no-corsï¼šè¯·æ±‚æ–¹æ³•åªé™äº GETã€POST å’Œ HEADï¼Œå¹¶ä¸”åªèƒ½ä½¿ç”¨æœ‰é™çš„å‡ ä¸ªç®€å•æ ‡å¤´ï¼Œä¸èƒ½æ·»åŠ è·¨åŸŸçš„å¤æ‚æ ‡å¤´ï¼Œç›¸å½“äºæäº¤è¡¨å•æ‰€èƒ½å‘å‡ºçš„è¯·æ±‚ï¼›</li></ul><h4 id="2-2-3-3-credentials"><a href="#2-2-3-3-credentials" class="headerlink" title="2.2.3.3. credentials"></a>2.2.3.3. credentials</h4><p>credentialså±æ€§æŒ‡å®šæ˜¯å¦å‘é€ Cookieã€‚å¯èƒ½çš„å–å€¼å¦‚ä¸‹ï¼š</p><ul><li>same-originï¼šé»˜è®¤å€¼ï¼ŒåŒæºè¯·æ±‚æ—¶å‘é€ Cookieï¼Œè·¨åŸŸè¯·æ±‚æ—¶ä¸å‘é€ï¼›</li><li>includeï¼šä¸ç®¡åŒæºè¯·æ±‚ï¼Œè¿˜æ˜¯è·¨åŸŸè¯·æ±‚ï¼Œä¸€å¾‹å‘é€ Cookieï¼›</li><li>omitï¼šä¸€å¾‹ä¸å‘é€ï¼›</li></ul><p>è·¨åŸŸè¯·æ±‚å‘é€ Cookieï¼Œéœ€è¦å°†credentialså±æ€§è®¾ä¸ºincludeã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://another.com&#x27;</span>, &#123;<br>  <span class="hljs-attr">credentials</span>: <span class="hljs-string">&quot;include&quot;</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="2-2-3-4-signal"><a href="#2-2-3-4-signal" class="headerlink" title="2.2.3.4. signal"></a>2.2.3.4. signal</h4><p>signalå±æ€§æŒ‡å®šä¸€ä¸ª <code>AbortSignal</code> å®ä¾‹ï¼Œç”¨äºå–æ¶ˆfetch()è¯·æ±‚ã€‚</p><h4 id="2-2-3-5-keepalive"><a href="#2-2-3-5-keepalive" class="headerlink" title="2.2.3.5. keepalive"></a>2.2.3.5. keepalive</h4><p>keepaliveå±æ€§ç”¨äºé¡µé¢å¸è½½æ—¶ï¼Œå‘Šè¯‰æµè§ˆå™¨åœ¨åå°ä¿æŒè¿æ¥ï¼Œç»§ç»­å‘é€æ•°æ®ã€‚<br>ä¸€ä¸ªå…¸å‹çš„åœºæ™¯å°±æ˜¯ï¼Œç”¨æˆ·ç¦»å¼€ç½‘é¡µæ—¶ï¼Œè„šæœ¬å‘æœåŠ¡å™¨æäº¤ä¸€äº›ç”¨æˆ·è¡Œä¸ºçš„ç»Ÿè®¡ä¿¡æ¯ã€‚è¿™æ—¶ï¼Œå¦‚æœä¸ç”¨keepaliveå±æ€§ï¼Œæ•°æ®å¯èƒ½æ— æ³•å‘é€ï¼Œå› ä¸ºæµè§ˆå™¨å·²ç»æŠŠé¡µé¢å¸è½½äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">window</span>.<span class="hljs-property">onunload</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/analytics&#x27;</span>, &#123;<br>    <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>    <span class="hljs-attr">body</span>: <span class="hljs-string">&quot;statistics&quot;</span>,<br>    <span class="hljs-attr">keepalive</span>: <span class="hljs-literal">true</span><br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure><h4 id="2-2-3-6-redirect"><a href="#2-2-3-6-redirect" class="headerlink" title="2.2.3.6. redirect"></a>2.2.3.6. redirect</h4><p>redirectå±æ€§æŒ‡å®š HTTP è·³è½¬çš„å¤„ç†æ–¹æ³•ã€‚å¯èƒ½çš„å–å€¼å¦‚ä¸‹ï¼š</p><ul><li>followï¼šé»˜è®¤å€¼ï¼Œfetch()è·Ÿéš HTTP è·³è½¬ï¼›</li><li>errorï¼šå¦‚æœå‘ç”Ÿè·³è½¬ï¼Œfetch()å°±æŠ¥é”™ï¼›</li><li>manualï¼šfetch()ä¸è·Ÿéš HTTP è·³è½¬ï¼Œä½†æ˜¯response.urlå±æ€§ä¼šæŒ‡å‘æ–°çš„ URLï¼Œresponse.redirectedå±æ€§ä¼šå˜ä¸ºtrueï¼Œç”±å¼€å‘è€…è‡ªå·±å†³å®šåç»­å¦‚ä½•å¤„ç†è·³è½¬ï¼›</li></ul><h4 id="2-2-3-7-integrity"><a href="#2-2-3-7-integrity" class="headerlink" title="2.2.3.7. integrity"></a>2.2.3.7. integrity</h4><p>integrityå±æ€§æŒ‡å®šä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç”¨äºæ£€æŸ¥ HTTP å›åº”ä¼ å›çš„æ•°æ®æ˜¯å¦ç­‰äºè¿™ä¸ªé¢„å…ˆè®¾å®šçš„å“ˆå¸Œå€¼ã€‚<br>æ¯”å¦‚ï¼Œä¸‹è½½æ–‡ä»¶æ—¶ï¼Œæ£€æŸ¥æ–‡ä»¶çš„ SHA-256 å“ˆå¸Œå€¼æ˜¯å¦ç›¸ç¬¦ï¼Œç¡®ä¿æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://site.com/file&#x27;</span>, &#123;<br>  <span class="hljs-attr">integrity</span>: <span class="hljs-string">&#x27;sha256-abcdef&#x27;</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="2-2-3-8-referrer"><a href="#2-2-3-8-referrer" class="headerlink" title="2.2.3.8. referrer"></a>2.2.3.8. referrer</h4><p>referrerå±æ€§ç”¨äºè®¾å®šfetch()è¯·æ±‚çš„refereræ ‡å¤´ã€‚<br>è¿™ä¸ªå±æ€§å¯ä»¥ä¸ºä»»æ„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆå³ä¸å‘é€refereræ ‡å¤´ï¼‰ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/page&#x27;</span>, &#123;<br>  <span class="hljs-attr">referrer</span>: <span class="hljs-string">&#x27;&#x27;</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="2-2-3-9-referrerPolicy"><a href="#2-2-3-9-referrerPolicy" class="headerlink" title="2.2.3.9. referrerPolicy"></a>2.2.3.9. referrerPolicy</h4><p>referrerPolicyå±æ€§ç”¨äºè®¾å®šRefereræ ‡å¤´çš„è§„åˆ™ã€‚å¯èƒ½çš„å–å€¼å¦‚ä¸‹ï¼š</p><ul><li><code>no-referrer-when-downgrade</code>ï¼šé»˜è®¤å€¼ï¼Œæ€»æ˜¯å‘é€Refereræ ‡å¤´ï¼Œé™¤éä» HTTPS é¡µé¢è¯·æ±‚ HTTP èµ„æºæ—¶ä¸å‘é€ï¼›</li><li><code>no-referrer</code>ï¼šä¸å‘é€Refereræ ‡å¤´ï¼›</li><li><code>origin</code>ï¼šRefereræ ‡å¤´åªåŒ…å«åŸŸåï¼Œä¸åŒ…å«å®Œæ•´çš„è·¯å¾„ï¼›</li><li><code>origin-when-cross-origin</code>ï¼šåŒæºè¯·æ±‚Refereræ ‡å¤´åŒ…å«å®Œæ•´çš„è·¯å¾„ï¼Œè·¨åŸŸè¯·æ±‚åªåŒ…å«åŸŸåï¼›</li><li><code>same-origin</code>ï¼šè·¨åŸŸè¯·æ±‚ä¸å‘é€Refererï¼ŒåŒæºè¯·æ±‚å‘é€ï¼›</li><li><code>strict-origin</code>ï¼šRefereræ ‡å¤´åªåŒ…å«åŸŸåï¼ŒHTTPS é¡µé¢è¯·æ±‚ HTTP èµ„æºæ—¶ä¸å‘é€Refereræ ‡å¤´ï¼›</li><li><code>strict-origin-when-cross-origin</code>ï¼šåŒæºè¯·æ±‚æ—¶Refereræ ‡å¤´åŒ…å«å®Œæ•´è·¯å¾„ï¼Œè·¨åŸŸè¯·æ±‚æ—¶åªåŒ…å«åŸŸåï¼ŒHTTPS é¡µé¢è¯·æ±‚ HTTP èµ„æºæ—¶ä¸å‘é€è¯¥æ ‡å¤´ï¼›</li><li><code>unsafe-url</code>ï¼šä¸ç®¡ä»€ä¹ˆæƒ…å†µï¼Œæ€»æ˜¯å‘é€Refereræ ‡å¤´ï¼›</li></ul><h3 id="2-2-4-fetch-cancel"><a href="#2-2-4-fetch-cancel" class="headerlink" title="2.2.4. fetch cancel"></a>2.2.4. fetch cancel</h3><p>fetch()è¯·æ±‚å‘é€ä»¥åï¼Œå¦‚æœä¸­é€”æƒ³è¦å–æ¶ˆï¼Œéœ€è¦ä½¿ç”¨<code>AbortController</code>å¯¹è±¡ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();<br><span class="hljs-keyword">let</span> signal = controller.<span class="hljs-property">signal</span>;<br><br><span class="hljs-title function_">fetch</span>(url, &#123;<br>  <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span><br>&#125;);<br><br>signal.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;abort&#x27;</span>,<br>  <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;abort!&#x27;</span>)<br>);<br><br>controller.<span class="hljs-title function_">abort</span>(); <span class="hljs-comment">// å–æ¶ˆ</span><br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(signal.<span class="hljs-property">aborted</span>); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><p>ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆæ–°å»º AbortController å®ä¾‹ï¼Œç„¶åå‘é€fetch()è¯·æ±‚ï¼Œé…ç½®å¯¹è±¡çš„signalå±æ€§å¿…é¡»æŒ‡å®šæ¥æ”¶ <code>AbortController</code> å®ä¾‹å‘é€çš„ä¿¡å·<code>controller.signal</code>ã€‚<br><code>controller.abort()</code>æ–¹æ³•ç”¨äºå‘å‡ºå–æ¶ˆä¿¡å·ã€‚è¿™æ—¶ä¼šè§¦å‘abortäº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å¯ä»¥ç›‘å¬ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>controller.signal.aborted</code>å±æ€§åˆ¤æ–­å–æ¶ˆä¿¡å·æ˜¯å¦å·²ç»å‘å‡ºã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ª1ç§’åè‡ªåŠ¨å–æ¶ˆè¯·æ±‚çš„ä¾‹å­ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbortController</span>();<br><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> controller.<span class="hljs-title function_">abort</span>(), <span class="hljs-number">1000</span>);<br><br><span class="hljs-keyword">try</span> &#123;<br>  <span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/long-operation&#x27;</span>, &#123;<br>    <span class="hljs-attr">signal</span>: controller.<span class="hljs-property">signal</span><br>  &#125;);<br>&#125; <span class="hljs-keyword">catch</span>(err) &#123;<br>  <span class="hljs-keyword">if</span> (err.<span class="hljs-property">name</span> == <span class="hljs-string">&#x27;AbortError&#x27;</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Aborted!&#x27;</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">throw</span> err;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-5-æµ‹è¯•"><a href="#2-2-5-æµ‹è¯•" class="headerlink" title="2.2.5. æµ‹è¯•"></a>2.2.5. æµ‹è¯•</h3><p>é’ˆå¯¹<code>json-server</code>æœåŠ¡ï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://localhost:3000/posts&#x27;</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);<br>  &#125;)<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);<br>  &#125;);<br></code></pre></td></tr></table></figure><blockquote><p>æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/github/fetch">fetch polyfill</a></p></blockquote><h2 id="2-3-axios"><a href="#2-3-axios" class="headerlink" title="2.3. axios"></a>2.3. axios</h2><blockquote><p><a href="https://github.com/axios/axios">githubåœ°å€</a><br><a href="https://axios-http.com/">å®˜ç½‘åœ°å€</a></p></blockquote><p>axiosæ˜¯ä¸€ä¸ªç”¨äºç½‘ç»œè¯·æ±‚çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ˜¯ä¸€ä¸ªåŸºäºPromise ç”¨äºæµè§ˆå™¨å’Œ nodejs çš„ HTTP å®¢æˆ·ç«¯ï¼Œå®ƒæœ¬èº«å…·æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p><ul><li>ä»æµè§ˆå™¨ä¸­åˆ›å»º <code>XMLHttpRequest</code>ï¼›</li><li>ä» node.js å‘å‡º http è¯·æ±‚ï¼›</li><li>æ”¯æŒ Promise APIï¼›</li><li>æ‹¦æˆªè¯·æ±‚å’Œå“åº”ï¼›</li><li>è½¬æ¢è¯·æ±‚å’Œå“åº”æ•°æ®ï¼›</li><li>å–æ¶ˆè¯·æ±‚ï¼›</li><li>è‡ªåŠ¨è½¬æ¢JSONæ•°æ®ï¼›</li><li>å®¢æˆ·ç«¯æ”¯æŒé˜²æ­¢CSRF&#x2F;XSRFï¼›</li></ul><h3 id="2-3-1-åŸºç¡€ä½¿ç”¨"><a href="#2-3-1-åŸºç¡€ä½¿ç”¨" class="headerlink" title="2.3.1. åŸºç¡€ä½¿ç”¨"></a>2.3.1. åŸºç¡€ä½¿ç”¨</h3><p>Axios æä¾›äº†ä¸¤ç§ä¸åŒçš„å½¢å¼æ¥å‘é€ HTTP è¯·æ±‚ï¼š</p><h4 id="2-3-1-1-æ–¹æ³•"><a href="#2-3-1-1-æ–¹æ³•" class="headerlink" title="2.3.1.1. æ–¹æ³•"></a>2.3.1.1. æ–¹æ³•</h4><p><code>axios(config)</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«äº†ä¸€äº›å¯¹è¯·æ±‚çš„é…ç½®ï¼Œ axios ä¼šæ ¹æ®è¿™äº›é…ç½®æ¥å‘é€å¯¹åº”çš„ HTTP è¯·æ±‚<br>æœ€åŸºæœ¬çš„é…ç½®é¡¹åº”è¯¥åŒ…æ‹¬ï¼š</p><ol><li>method è¯·æ±‚çš„æ–¹æ³•ï¼ˆå¯é€‰å€¼ï¼š get , post ç­‰ï¼‰ï¼›</li><li>url è¯·æ±‚çš„åœ°å€ ï¼ˆå¿…é¡»é¡¹ï¼‰ï¼›</li><li>data è¯·æ±‚å‘é€çš„æ•°æ®ï¼ˆpostç­‰è¯·æ±‚éœ€è¦ï¼‰ï¼›<blockquote><p>é»˜è®¤çš„è¯·æ±‚æ–¹æ³•æ˜¯getæ‰€ä»¥å¦‚æœæ˜¯getè¯·æ±‚å¯ä»¥ä¸è®¾ç½®method</p></blockquote></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// å‘é€ POST è¯·æ±‚</span><br><span class="hljs-title function_">axios</span>(&#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>,<br>  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/user/12345&#x27;</span>,<br>  <span class="hljs-attr">data</span>: &#123;<br>    <span class="hljs-attr">firstName</span>: <span class="hljs-string">&#x27;Fred&#x27;</span>,<br>    <span class="hljs-attr">lastName</span>: <span class="hljs-string">&#x27;Flintstone&#x27;</span><br>  &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>è¯·æ±‚å“åº”çš„å¤„ç†åœ¨ then å’Œ catch å›è°ƒä¸­ï¼Œè¯·æ±‚æ­£å¸¸ä¼šè¿›å…¥ then ï¼Œè¯·æ±‚å¼‚å¸¸åˆ™ä¼šè¿› catch</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// å‘é€ POST è¯·æ±‚</span><br><span class="hljs-title function_">axios</span>(&#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>,<br>  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/user/12345&#x27;</span>,<br>  <span class="hljs-attr">data</span>: &#123;<br>    <span class="hljs-attr">firstName</span>: <span class="hljs-string">&#x27;Fred&#x27;</span>,<br>    <span class="hljs-attr">lastName</span>: <span class="hljs-string">&#x27;Flintstone&#x27;</span><br>  &#125;<br>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>    consloe.<span class="hljs-title function_">log</span>(res)<br>&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br>&#125;)<br><br><span class="hljs-comment">// å‘é€ GET è¯·æ±‚ï¼ˆé»˜è®¤çš„æ–¹æ³•ï¼‰</span><br><span class="hljs-title function_">axios</span>(<span class="hljs-string">&#x27;/user/12345&#x27;</span>);<br></code></pre></td></tr></table></figure><h4 id="2-3-1-2-è¯·æ±‚åˆ«å"><a href="#2-3-1-2-è¯·æ±‚åˆ«å" class="headerlink" title="2.3.1.2. è¯·æ±‚åˆ«å"></a>2.3.1.2. è¯·æ±‚åˆ«å</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// å‘é€GETè¯·æ±‚</span><br>axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/user?ID=12345&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);<br>&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br>&#125;);<br><br><span class="hljs-comment">// å‘é€POSTè¯·æ±‚</span><br>å‘é€postè¯·æ±‚<br>axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/user&#x27;</span>, &#123;<br>  <span class="hljs-attr">firstName</span>: <span class="hljs-string">&#x27;Fred&#x27;</span>,<br>  <span class="hljs-attr">lastName</span>: <span class="hljs-string">&#x27;Flintstone&#x27;</span><br>&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);<br>&#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="2-3-2-å“åº”æ•°æ®"><a href="#2-3-2-å“åº”æ•°æ®" class="headerlink" title="2.3.2. å“åº”æ•°æ®"></a>2.3.2. å“åº”æ•°æ®</h3><p>å…¶ä¸­çš„ data æ˜¯åç«¯è¿”å›çš„æ•°æ®ï¼Œä¸€èˆ¬åªéœ€è¦å…³æ³¨ <code>response</code> ä¸­çš„ <code>data</code> å­—æ®µå°±è¡Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>  <span class="hljs-comment">// `data` ç”±æœåŠ¡å™¨æä¾›çš„å“åº”</span><br>  <span class="hljs-attr">data</span>: &#123;&#125;,<br>  <span class="hljs-comment">// `status` æ¥è‡ªæœåŠ¡å™¨å“åº”çš„ HTTP çŠ¶æ€ç </span><br>  <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,<br>  <span class="hljs-comment">// `statusText` æ¥è‡ªæœåŠ¡å™¨å“åº”çš„ HTTP çŠ¶æ€ä¿¡æ¯</span><br>  <span class="hljs-attr">statusText</span>: <span class="hljs-string">&#x27;OK&#x27;</span>,<br>  <span class="hljs-comment">// `headers` æœåŠ¡å™¨å“åº”çš„å¤´</span><br>  <span class="hljs-attr">headers</span>: &#123;&#125;,<br>   <span class="hljs-comment">// `config` æ˜¯ä¸ºè¯·æ±‚æä¾›çš„é…ç½®ä¿¡æ¯</span><br>  <span class="hljs-attr">config</span>: &#123;&#125;,<br> <span class="hljs-comment">// &#x27;request&#x27;</span><br>  <span class="hljs-comment">// `request` is the request that generated this response</span><br>  <span class="hljs-comment">// It is the last ClientRequest instance in node.js (in redirects)</span><br>  <span class="hljs-comment">// and an XMLHttpRequest instance the browser</span><br>  <span class="hljs-attr">request</span>: &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-3-åˆ›å»ºå®ä¾‹"><a href="#2-3-3-åˆ›å»ºå®ä¾‹" class="headerlink" title="2.3.3. åˆ›å»ºå®ä¾‹"></a>2.3.3. åˆ›å»ºå®ä¾‹</h3><p>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–°å»ºä¸€ä¸ª axios å®ä¾‹ <code>axios.create([config])</code>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> instance = axios.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;https://some-domain.com/api/&#x27;</span>,<br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span>,<br>  <span class="hljs-attr">headers</span>: &#123;<span class="hljs-string">&#x27;X-Custom-Header&#x27;</span>: <span class="hljs-string">&#x27;foobar&#x27;</span>&#125;<br>&#125;);<br><br></code></pre></td></tr></table></figure><p>åˆ›å»ºçš„å®ä¾‹ä¸­çš„ axios() api æ”¹ä¸ºäº† request() apiï¼Œä½¿ç”¨æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œå…¶ä»–å¦‚è¯·æ±‚åˆ«åç­‰å‡½æ•°ï¼Œéƒ½æ²¡æœ‰æ”¹å˜<br>ä»¥ä¸‹æ˜¯å®ä¾‹æ‰€æ‹¥æœ‰çš„æ–¹æ³•</p><ul><li>request(config)ï¼›</li><li>get(url[, config])ï¼›</li><li>delete(url[, config])ï¼›</li><li>head(url[, config])ï¼›</li><li>options(url[, config])ï¼›</li><li>post(url[, data[, config]])ï¼›</li><li>put(url[, data[, config]])ï¼›</li><li>patch(url[, data[, config]])ï¼›</li></ul><p>axiosä¼šæŠŠè¿™äº› æ–¹æ³•ä¸­çš„config ä¼šå’Œåˆ›å»ºå®ä¾‹æ—¶æŒ‡å®šçš„ config åˆå¹¶åˆ°ä¸€èµ·ä½¿ç”¨</p><h3 id="2-3-4-æ‹¦æˆªå™¨"><a href="#2-3-4-æ‹¦æˆªå™¨" class="headerlink" title="2.3.4. æ‹¦æˆªå™¨"></a>2.3.4. æ‹¦æˆªå™¨</h3><ul><li><code>axios.interceptors.request</code> è¯·æ±‚æ‹¦æˆªå™¨</li><li><code>axios.interceptors.response</code> å“åº”æ‹¦æˆªå™¨<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><br><span class="hljs-comment">// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨</span><br>axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">config</span>) &#123;<br>  <span class="hljs-comment">// åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ</span><br>  config.<span class="hljs-property">header</span>[<span class="hljs-string">&quot;Token&quot;</span>] = <span class="hljs-string">&quot;xxxx&quot;</span><br>  <span class="hljs-keyword">return</span> config;<br>&#125;, <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) &#123;<br>  <span class="hljs-comment">// å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>&#125;);<br><br><span class="hljs-comment">// æ·»åŠ å“åº”æ‹¦æˆªå™¨</span><br>axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) &#123;<br>  <span class="hljs-comment">// å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆ</span><br>  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>)&#123;<br>    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span><br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;error&#x27;</span>))<br>  &#125;<br>&#125;, <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) &#123;<br>  <span class="hljs-comment">// å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ</span><br>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);<br>&#125;);<br></code></pre></td></tr></table></figure>å¦‚æœæƒ³è¦å–æ¶ˆæ‹¦æˆªå™¨ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥æ¥æ”¶è®¾ç½®æ‹¦æˆªå™¨æ—¶è¿”å›çš„å®ä¾‹ï¼Œç„¶åä½¿ç”¨ eject æ¥å–æ¶ˆæ‹¦æˆªå™¨<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> myInterceptor = axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<span class="hljs-comment">/*...*/</span>&#125;);<br>axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">eject</span>(myInterceptor);<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-3-5-å®Œæ•´çš„è¯·æ±‚é…ç½®"><a href="#2-3-5-å®Œæ•´çš„è¯·æ±‚é…ç½®" class="headerlink" title="2.3.5. å®Œæ•´çš„è¯·æ±‚é…ç½®"></a>2.3.5. å®Œæ•´çš„è¯·æ±‚é…ç½®</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&#123;<br>   <span class="hljs-comment">// `url` æ˜¯ç”¨äºè¯·æ±‚çš„æœåŠ¡å™¨ URL</span><br>  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/user&#x27;</span>,<br>  <span class="hljs-comment">// `method` æ˜¯åˆ›å»ºè¯·æ±‚æ—¶ä½¿ç”¨çš„æ–¹æ³•</span><br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-comment">// default</span><br>  <span class="hljs-comment">// `baseURL` å°†è‡ªåŠ¨åŠ åœ¨ `url` å‰é¢ï¼Œé™¤é `url` æ˜¯ä¸€ä¸ªç»å¯¹ URLã€‚</span><br>  <span class="hljs-comment">// å®ƒå¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ª `baseURL` ä¾¿äºä¸º axios å®ä¾‹çš„æ–¹æ³•ä¼ é€’ç›¸å¯¹ URL</span><br>  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">&#x27;https://some-domain.com/api/&#x27;</span>,<br>  <span class="hljs-comment">// `transformRequest` å…è®¸åœ¨å‘æœåŠ¡å™¨å‘é€å‰ï¼Œä¿®æ”¹è¯·æ±‚æ•°æ®</span><br>  <span class="hljs-comment">// åªèƒ½ç”¨åœ¨ &#x27;PUT&#x27;, &#x27;POST&#x27; å’Œ &#x27;PATCH&#x27; è¿™å‡ ä¸ªè¯·æ±‚æ–¹æ³•</span><br>  <span class="hljs-comment">// åé¢æ•°ç»„ä¸­çš„å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ– ArrayBufferï¼Œæˆ– Stream</span><br>  <span class="hljs-attr">transformRequest</span>: [<span class="hljs-keyword">function</span> (<span class="hljs-params">data, headers</span>) &#123;<br>    <span class="hljs-comment">// å¯¹ data è¿›è¡Œä»»æ„è½¬æ¢å¤„ç†</span><br>    <span class="hljs-keyword">return</span> data;<br>  &#125;],<br>  <span class="hljs-comment">// `transformResponse` åœ¨ä¼ é€’ç»™ then/catch å‰ï¼Œå…è®¸ä¿®æ”¹å“åº”æ•°æ®</span><br>  <span class="hljs-attr">transformResponse</span>: [<span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123;<br>    <span class="hljs-comment">// å¯¹ data è¿›è¡Œä»»æ„è½¬æ¢å¤„ç†</span><br>    <span class="hljs-keyword">return</span> data;<br>  &#125;],<br>  <span class="hljs-comment">// `headers` æ˜¯å³å°†è¢«å‘é€çš„è‡ªå®šä¹‰è¯·æ±‚å¤´</span><br>  <span class="hljs-attr">headers</span>: &#123;<span class="hljs-string">&#x27;X-Requested-With&#x27;</span>: <span class="hljs-string">&#x27;XMLHttpRequest&#x27;</span>&#125;,<br>  <span class="hljs-comment">// `params` æ˜¯å³å°†ä¸è¯·æ±‚ä¸€èµ·å‘é€çš„ URL å‚æ•°</span><br>  <span class="hljs-comment">// å¿…é¡»æ˜¯ä¸€ä¸ªæ— æ ¼å¼å¯¹è±¡(plain object)æˆ– URLSearchParams å¯¹è±¡</span><br>  <span class="hljs-attr">params</span>: &#123;<br>    <span class="hljs-attr">ID</span>: <span class="hljs-number">12345</span><br>  &#125;,<br>   <span class="hljs-comment">// `paramsSerializer` æ˜¯ä¸€ä¸ªè´Ÿè´£ `params` åºåˆ—åŒ–çš„å‡½æ•°</span><br>  <span class="hljs-comment">// (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)</span><br>  <span class="hljs-attr">paramsSerializer</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">params</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Qs</span>.<span class="hljs-title function_">stringify</span>(params, &#123;<span class="hljs-attr">arrayFormat</span>: <span class="hljs-string">&#x27;brackets&#x27;</span>&#125;)<br>  &#125;,<br>  <span class="hljs-comment">// `data` æ˜¯ä½œä¸ºè¯·æ±‚ä¸»ä½“è¢«å‘é€çš„æ•°æ®</span><br>  <span class="hljs-comment">// åªé€‚ç”¨äºè¿™äº›è¯·æ±‚æ–¹æ³• &#x27;PUT&#x27;, &#x27;POST&#x27;, å’Œ &#x27;PATCH&#x27;</span><br>  <span class="hljs-comment">// åœ¨æ²¡æœ‰è®¾ç½® `transformRequest` æ—¶ï¼Œå¿…é¡»æ˜¯ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š</span><br>  <span class="hljs-comment">// - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams</span><br>  <span class="hljs-comment">// - æµè§ˆå™¨ä¸“å±ï¼šFormData, File, Blob</span><br>  <span class="hljs-comment">// - Node ä¸“å±ï¼š Stream</span><br>  <span class="hljs-attr">data</span>: &#123;<br>    <span class="hljs-attr">firstName</span>: <span class="hljs-string">&#x27;Fred&#x27;</span><br>  &#125;,<br>  <span class="hljs-comment">// `timeout` æŒ‡å®šè¯·æ±‚è¶…æ—¶çš„æ¯«ç§’æ•°(0 è¡¨ç¤ºæ— è¶…æ—¶æ—¶é—´)</span><br>  <span class="hljs-comment">// å¦‚æœè¯·æ±‚è¯è´¹äº†è¶…è¿‡ `timeout` çš„æ—¶é—´ï¼Œè¯·æ±‚å°†è¢«ä¸­æ–­</span><br>  <span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span>,<br>   <span class="hljs-comment">// `withCredentials` è¡¨ç¤ºè·¨åŸŸè¯·æ±‚æ—¶æ˜¯å¦éœ€è¦ä½¿ç”¨å‡­è¯</span><br>  <span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// default</span><br>  <span class="hljs-comment">// `adapter` å…è®¸è‡ªå®šä¹‰å¤„ç†è¯·æ±‚ï¼Œä»¥ä½¿æµ‹è¯•æ›´è½»æ¾</span><br>  <span class="hljs-comment">// è¿”å›ä¸€ä¸ª promise å¹¶åº”ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„å“åº” (æŸ¥é˜… [response docs](#response-api)).</span><br>  <span class="hljs-attr">adapter</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">config</span>) &#123;<br>    <span class="hljs-comment">/* ... */</span><br>  &#125;,<br> <span class="hljs-comment">// `auth` è¡¨ç¤ºåº”è¯¥ä½¿ç”¨ HTTP åŸºç¡€éªŒè¯ï¼Œå¹¶æä¾›å‡­æ®</span><br>  <span class="hljs-comment">// è¿™å°†è®¾ç½®ä¸€ä¸ª `Authorization` å¤´ï¼Œè¦†å†™æ‰ç°æœ‰çš„ä»»æ„ä½¿ç”¨ `headers` è®¾ç½®çš„è‡ªå®šä¹‰ `Authorization`å¤´</span><br>  <span class="hljs-attr">auth</span>: &#123;<br>    <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;janedoe&#x27;</span>,<br>    <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;s00pers3cret&#x27;</span><br>  &#125;,<br>   <span class="hljs-comment">// `responseType` è¡¨ç¤ºæœåŠ¡å™¨å“åº”çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ˜¯ &#x27;arraybuffer&#x27;, &#x27;blob&#x27;, &#x27;document&#x27;, &#x27;json&#x27;, &#x27;text&#x27;, &#x27;stream&#x27;</span><br>  <span class="hljs-attr">responseType</span>: <span class="hljs-string">&#x27;json&#x27;</span>, <span class="hljs-comment">// default</span><br>  <span class="hljs-comment">// `responseEncoding` indicates encoding to use for decoding responses</span><br>  <span class="hljs-comment">// Note: Ignored for `responseType` of &#x27;stream&#x27; or client-side requests</span><br>  <span class="hljs-attr">responseEncoding</span>: <span class="hljs-string">&#x27;utf8&#x27;</span>, <span class="hljs-comment">// default</span><br>   <span class="hljs-comment">// `xsrfCookieName` æ˜¯ç”¨ä½œ xsrf token çš„å€¼çš„cookieçš„åç§°</span><br>  <span class="hljs-attr">xsrfCookieName</span>: <span class="hljs-string">&#x27;XSRF-TOKEN&#x27;</span>, <span class="hljs-comment">// default</span><br>  <span class="hljs-comment">// `xsrfHeaderName` is the name of the http header that carries the xsrf token value</span><br>  <span class="hljs-attr">xsrfHeaderName</span>: <span class="hljs-string">&#x27;X-XSRF-TOKEN&#x27;</span>, <span class="hljs-comment">// default</span><br>   <span class="hljs-comment">// `onUploadProgress` å…è®¸ä¸ºä¸Šä¼ å¤„ç†è¿›åº¦äº‹ä»¶</span><br>  <span class="hljs-attr">onUploadProgress</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">progressEvent</span>) &#123;<br>    <span class="hljs-comment">// Do whatever you want with the native progress event</span><br>  &#125;,<br>  <span class="hljs-comment">// `onDownloadProgress` å…è®¸ä¸ºä¸‹è½½å¤„ç†è¿›åº¦äº‹ä»¶</span><br>  <span class="hljs-attr">onDownloadProgress</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">progressEvent</span>) &#123;<br>    <span class="hljs-comment">// å¯¹åŸç”Ÿè¿›åº¦äº‹ä»¶çš„å¤„ç†</span><br>  &#125;,<br>   <span class="hljs-comment">// `maxContentLength` å®šä¹‰å…è®¸çš„å“åº”å†…å®¹çš„æœ€å¤§å°ºå¯¸</span><br>  <span class="hljs-attr">maxContentLength</span>: <span class="hljs-number">2000</span>,<br>  <span class="hljs-comment">// `validateStatus` å®šä¹‰å¯¹äºç»™å®šçš„HTTP å“åº”çŠ¶æ€ç æ˜¯ resolve æˆ– reject  promise ã€‚å¦‚æœ `validateStatus` è¿”å› `true` (æˆ–è€…è®¾ç½®ä¸º `null` æˆ– `undefined`)ï¼Œpromise å°†è¢« resolve; å¦åˆ™ï¼Œpromise å°†è¢« rejecte</span><br>  <span class="hljs-attr">validateStatus</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">status</span>) &#123;<br>    <span class="hljs-keyword">return</span> status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span>; <span class="hljs-comment">// default</span><br>  &#125;,<br>  <span class="hljs-comment">// `maxRedirects` å®šä¹‰åœ¨ node.js ä¸­ follow çš„æœ€å¤§é‡å®šå‘æ•°ç›®</span><br>  <span class="hljs-comment">// å¦‚æœè®¾ç½®ä¸º0ï¼Œå°†ä¸ä¼š follow ä»»ä½•é‡å®šå‘</span><br>  <span class="hljs-attr">maxRedirects</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// default</span><br>  <span class="hljs-comment">// `socketPath` defines a UNIX Socket to be used in node.js.</span><br>  <span class="hljs-comment">// e.g. &#x27;/var/run/docker.sock&#x27; to send requests to the docker daemon.</span><br>  <span class="hljs-comment">// Only either `socketPath` or `proxy` can be specified.</span><br>  <span class="hljs-comment">// If both are specified, `socketPath` is used.</span><br>  <span class="hljs-attr">socketPath</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// default</span><br>  <span class="hljs-comment">// `httpAgent` å’Œ `httpsAgent` åˆ†åˆ«åœ¨ node.js ä¸­ç”¨äºå®šä¹‰åœ¨æ‰§è¡Œ http å’Œ https æ—¶ä½¿ç”¨çš„è‡ªå®šä¹‰ä»£ç†ã€‚å…è®¸åƒè¿™æ ·é…ç½®é€‰é¡¹ï¼š</span><br>  <span class="hljs-comment">// `keepAlive` é»˜è®¤æ²¡æœ‰å¯ç”¨</span><br>  <span class="hljs-attr">httpAgent</span>: <span class="hljs-keyword">new</span> http.<span class="hljs-title class_">Agent</span>(&#123; <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> &#125;),<br>  <span class="hljs-attr">httpsAgent</span>: <span class="hljs-keyword">new</span> https.<span class="hljs-title class_">Agent</span>(&#123; <span class="hljs-attr">keepAlive</span>: <span class="hljs-literal">true</span> &#125;),<br>  <span class="hljs-comment">// &#x27;proxy&#x27; å®šä¹‰ä»£ç†æœåŠ¡å™¨çš„ä¸»æœºåç§°å’Œç«¯å£</span><br>  <span class="hljs-comment">// `auth` è¡¨ç¤º HTTP åŸºç¡€éªŒè¯åº”å½“ç”¨äºè¿æ¥ä»£ç†ï¼Œå¹¶æä¾›å‡­æ®</span><br>  <span class="hljs-comment">// è¿™å°†ä¼šè®¾ç½®ä¸€ä¸ª `Proxy-Authorization` å¤´ï¼Œè¦†å†™æ‰å·²æœ‰çš„é€šè¿‡ä½¿ç”¨ `header` è®¾ç½®çš„è‡ªå®šä¹‰ `Proxy-Authorization` å¤´ã€‚</span><br>  <span class="hljs-attr">proxy</span>: &#123;<br>    <span class="hljs-attr">host</span>: <span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br>    <span class="hljs-attr">port</span>: <span class="hljs-number">9000</span>,<br>    <span class="hljs-attr">auth</span>: &#123;<br>      <span class="hljs-attr">username</span>: <span class="hljs-string">&#x27;mikeymike&#x27;</span>,<br>      <span class="hljs-attr">password</span>: <span class="hljs-string">&#x27;rapunz3l&#x27;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-comment">// `cancelToken` æŒ‡å®šç”¨äºå–æ¶ˆè¯·æ±‚çš„ cancel token</span><br>  <span class="hljs-comment">// ï¼ˆæŸ¥çœ‹åé¢çš„ Cancellation è¿™èŠ‚äº†è§£æ›´å¤šï¼‰</span><br>  <span class="hljs-attr">cancelToken</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">CancelToken</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">cancel</span>) &#123;<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-6-æµ‹è¯•"><a href="#2-3-6-æµ‹è¯•" class="headerlink" title="2.3.6. æµ‹è¯•"></a>2.3.6. æµ‹è¯•</h3><p>é’ˆå¯¹<code>json-server</code>æœåŠ¡ï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;axios&#x27;</span>);<br><br>axios<br>  .<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;http://localhost:3000/posts&#x27;</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) &#123;<br>    <span class="hljs-comment">// handle success</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response);<br>  &#125;)<br>  .<span class="hljs-title function_">catch</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) &#123;<br>    <span class="hljs-comment">// handle error</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br>  &#125;)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// always executed</span><br>  &#125;);<br><br></code></pre></td></tr></table></figure><h2 id="2-4-æ€»ç»“"><a href="#2-4-æ€»ç»“" class="headerlink" title="2.4. æ€»ç»“"></a>2.4. æ€»ç»“</h2><ol><li>Ajax æ˜¯<code>Async Javascript And Xml</code>çš„ç®€ç§°ï¼Œå®ƒæ˜¯åŸç”ŸJavaScriptçš„ä¸€ç§è¯·æ±‚æ–¹æ¡ˆï¼Œåˆ©ç”¨ XMLHttpRequest è¿›è¡Œå¼‚æ­¥è¯·æ±‚æ•°æ®ï¼Œå®ç°æ— æ„Ÿåˆ·æ–°æ•°æ®ï¼›</li><li>Fetch æ˜¯ ES6 æ–°æ¨å‡ºçš„ä¸€å¥—å¼‚æ­¥è¯·æ±‚æ–¹æ¡ˆï¼Œå®ƒå¤©ç”Ÿè‡ªå¸¦ Promiseï¼ŒåŒæ—¶ä¹Ÿæ˜¯åŸç”Ÿçš„ï¼Œå¦‚æœåœ¨è¾ƒå°é¡¹ç›®ä¸­ä¸ºäº†é¡¹ç›®å¤§å°ç€æƒ³å’Œå…¼å®¹æ€§ä¸æ˜¯é‚£ä¹ˆé«˜çš„å‰æä¸‹ä¸å¦¨å¯ä»¥ç”¨å®ƒæ¥è¿›è¡Œå¼‚æ­¥è¯·æ±‚ä¹Ÿæ˜¯ä¸é”™çš„ï¼›</li><li>Axios æ˜¯åŸºäº Ajax å’Œ Promise å°è£…çš„ä¸€ä¸ªåº“ï¼Œå¯ä»¥åˆ©ç”¨Promiseæ¥æ›´å¥½çš„ç®¡æ§è¯·æ±‚å›è°ƒåµŒå¥—é€ æˆçš„å›è°ƒåœ°ç‹±ï¼›</li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>typescript</title>
    <link href="/2023/07/17/typescript/"/>
    <url>/2023/07/17/typescript/</url>
    
    <content type="html"><![CDATA[<h2 id="ç±»å‹å®šä¹‰"><a href="#ç±»å‹å®šä¹‰" class="headerlink" title="ç±»å‹å®šä¹‰"></a>ç±»å‹å®šä¹‰</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">&#x27;å°æ˜&#x27;</span> <span class="hljs-comment">//å­—ç¬¦ä¸²</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">age</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">18</span>; <span class="hljs-comment">//æ•°å­—</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">isDone</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">//å¸ƒå°”å€¼</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">list</span>:<span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>] æˆ– <span class="hljs-keyword">const</span> <span class="hljs-attr">list1</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]; <span class="hljs-comment">//æ•°ç»„ </span><br><br><span class="hljs-keyword">const</span> x : [<span class="hljs-built_in">string</span>,<span class="hljs-built_in">number</span>] = [<span class="hljs-string">&#x27;1&#x27;</span>,<span class="hljs-number">2</span>]; <span class="hljs-comment">//å…ƒç»„, å…ƒç»„è¡¨ç¤ºå·²çŸ¥å…ƒç´ ç±»å‹å’Œæ•°é‡çš„æ•°ç»„</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">any1</span>: <span class="hljs-built_in">any</span> = <span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-comment">//anyå¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">warnUser</span>(<span class="hljs-params"></span>) :<span class="hljs-built_in">void</span> &#123;<br>  <br>&#125; <span class="hljs-comment">//voidè¡¨ç¤ºæ²¡æœ‰ä»»ä½•ç±»å‹ï¼Œå½“ä¸€ä¸ªå‡½æ•°æ²¡æœ‰è¿”å›å€¼æ—¶ï¼Œä½ é€šå¸¸ä¼šè§åˆ°å…¶è¿”å›å€¼ç±»å‹æ˜¯ void</span><br><br><span class="hljs-keyword">let</span> <span class="hljs-attr">u</span>: <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>; <br><span class="hljs-keyword">let</span> <span class="hljs-attr">n</span>: <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-literal">undefined</span>å’Œ<span class="hljs-literal">null</span>ä¸¤è€…å„è‡ªæœ‰è‡ªå·±çš„ç±»å‹åˆ†åˆ«å«åš<span class="hljs-literal">undefined</span>å’Œ<span class="hljs-literal">null</span>ã€‚ å’Œ <span class="hljs-built_in">void</span>ç›¸ä¼¼ï¼Œ<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">error</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">never</span> &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message);<br>&#125;  <span class="hljs-built_in">never</span>ç±»å‹è¡¨ç¤ºçš„æ˜¯é‚£äº›æ°¸ä¸å­˜åœ¨çš„å€¼çš„ç±»å‹<br><br><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">Color</span> &#123; <span class="hljs-title class_">Red</span>, <span class="hljs-title class_">Green</span>, <span class="hljs-title class_">Blue</span>, <span class="hljs-title class_">Alpha</span>&#125; <span class="hljs-comment">//æšä¸¾</span><br><br><span class="hljs-built_in">unknown</span><br>ç±»å‹å¦‚æœunkonwï¼Œåˆ™ä¸èƒ½ç›´æ¥ä½¿ç”¨<br></code></pre></td></tr></table></figure><h2 id="ç±»å‹æ–­è¨€"><a href="#ç±»å‹æ–­è¨€" class="headerlink" title="ç±»å‹æ–­è¨€"></a>ç±»å‹æ–­è¨€</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs typescript">â€œå°–æ‹¬å·â€è¯­æ³•ï¼š<br><span class="hljs-keyword">let</span> <span class="hljs-attr">someValue</span>: <span class="hljs-built_in">any</span> = <span class="hljs-string">&quot;this is a string&quot;</span>;<br><br><span class="hljs-keyword">let</span> <span class="hljs-attr">strLength</span>: <span class="hljs-built_in">number</span> = (&lt;<span class="hljs-built_in">string</span>&gt;someValue).<span class="hljs-property">length</span>;<br><br><span class="hljs-keyword">as</span>è¯­æ³•ï¼š<br><span class="hljs-keyword">let</span> <span class="hljs-attr">someValue</span>: <span class="hljs-built_in">any</span> = <span class="hljs-string">&quot;this is a string&quot;</span>;<br><br><span class="hljs-keyword">let</span> <span class="hljs-attr">strLength</span>: <span class="hljs-built_in">number</span> = (someValue <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>).<span class="hljs-property">length</span>;<br></code></pre></td></tr></table></figure><h2 id="ç±»å‹è”åˆå’Œäº¤å‰"><a href="#ç±»å‹è”åˆå’Œäº¤å‰" class="headerlink" title="ç±»å‹è”åˆå’Œäº¤å‰"></a>ç±»å‹è”åˆå’Œäº¤å‰</h2><p>ç±»å‹è”åˆç”¨äºæŒ‡å®šä¸€ä¸ªå€¼çš„ç±»å‹å¯ä»¥æ˜¯å¤šä¸ª</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">let</span> <span class="hljs-attr">p1</span>: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>;<br></code></pre></td></tr></table></figure><p>ç±»å‹äº¤å‰æŒ‡å¤šä¸ªç±»å‹åˆå¹¶ä¸ºä¸€ä¸ªç±»å‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">NameLikeProtocal</span> = &#123;<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>&#125;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">AgeLikeProtocal</span> = &#123;<span class="hljs-attr">age</span>:<span class="hljs-built_in">number</span>&#125;;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">SayLikeProtocal</span> = &#123;<span class="hljs-attr">say</span>: <span class="hljs-function">(<span class="hljs-params">msg:<span class="hljs-built_in">string</span></span>)=&gt;</span> <span class="hljs-built_in">string</span> &#125;<br><span class="hljs-keyword">type</span> <span class="hljs-title class_">PersonLikeProtocal</span> = <span class="hljs-title class_">NameLikeProtocal</span> &amp; <span class="hljs-title class_">AgeLikeProtocal</span> &amp; <span class="hljs-title class_">SayLikeProtocal</span>;<br><br><span class="hljs-comment">// å»æ‰ageå±æ€§</span><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">NoAgePerson</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">PersonLikeProtocal</span>,<span class="hljs-string">&#x27;age&#x27;</span>&gt;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">PersonLikeProtocal</span> = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;per&#x27;</span>,<br>  <span class="hljs-attr">age</span>:<span class="hljs-number">18</span>,<br>  <span class="hljs-title function_">say</span>(<span class="hljs-attr">str</span>:<span class="hljs-built_in">string</span>):<span class="hljs-built_in">string</span>&#123;<br>     <span class="hljs-keyword">return</span> str<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">person1</span>: <span class="hljs-title class_">NoAgePerson</span> = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;per&#x27;</span>,<br>    <span class="hljs-title function_">say</span>(<span class="hljs-attr">str</span>:<span class="hljs-built_in">string</span>):<span class="hljs-built_in">string</span>&#123;<br>     <span class="hljs-keyword">return</span> str<br>   &#125; <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ç±»å‹ä¿æŠ¤"><a href="#ç±»å‹ä¿æŠ¤" class="headerlink" title="ç±»å‹ä¿æŠ¤"></a>ç±»å‹ä¿æŠ¤</h2><h2 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-comment">//interface ä¸»è¦ç”¨äºå®šä¹‰å¯¹è±¡å’Œç±»çš„ç±»å‹</span><br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IPerons</span>  &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>,<br>    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>,<br>    <span class="hljs-title function_">say</span>(<span class="hljs-attr">msg</span>:<span class="hljs-built_in">string</span>):<span class="hljs-built_in">string</span><br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IPerons</span> &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name:<span class="hljs-built_in">string</span>,age:<span class="hljs-built_in">number</span></span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>    &#125;<br>    <span class="hljs-title function_">say</span>(<span class="hljs-params">msg:<span class="hljs-built_in">string</span></span>)&#123;<br>        <span class="hljs-keyword">return</span> msg<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ³›å‹: åœ¨ä¸€å®šåœ°æ–¹ç»™äºè‡ªç”±ï¼Œåˆç»™äº†ä¸€å®šçš„é™åˆ¶</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">interface</span> <span class="hljs-symbol">IPerons</span>&lt;<span class="hljs-symbol">T</span>,<span class="hljs-symbol">P</span>&gt;&#123;<br>    name: P,<br>    age: T,<br>    say(msg:P):P<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-symbol">Person</span>&lt;<span class="hljs-symbol">T,<span class="hljs-symbol">P</span></span>&gt; <span class="hljs-symbol">implements</span> <span class="hljs-symbol">IPerons</span>&lt;<span class="hljs-symbol">T,<span class="hljs-symbol">P</span></span>&gt; &#123;<br>    name: P;<br>    age: T;<br>    constructor(name:P,age:T)&#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br>    say(msg:P)&#123;<br>        <span class="hljs-keyword">return</span> msg<br>    &#125;<br><br>&#125;<br><span class="hljs-keyword">const</span> p1 = new Person(<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;1&#x27;</span>);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>é—­åŒ…</title>
    <link href="/2023/07/17/%E9%97%AD%E5%8C%85/"/>
    <url>/2023/07/17/%E9%97%AD%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h1 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h1><h3 id="é—­åŒ…çš„æ¦‚å¿µ"><a href="#é—­åŒ…çš„æ¦‚å¿µ" class="headerlink" title="é—­åŒ…çš„æ¦‚å¿µ"></a>é—­åŒ…çš„æ¦‚å¿µ</h3><p><strong>é—­åŒ…</strong>æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°èƒ½å¤Ÿè®¿é—®å¹¶æ“ä½œå…¶åˆ›å»ºæ—¶æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸä¸­çš„å˜é‡çš„èƒ½åŠ›ã€‚æ¢å¥è¯è¯´ï¼Œé—­åŒ…å°±æ˜¯èƒ½å¤Ÿå°†å˜é‡ä¿å­˜åˆ°å‡½æ•°å¤–éƒ¨çš„ä¸€ç§æœºåˆ¶ã€‚</p><p>é—­åŒ…æœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨å®ƒæ¥å®ç°<strong>ç§æœ‰å±æ€§</strong>ã€<strong>ç¼“å­˜è®¡ç®—ç»“æœ</strong>ã€<strong>æ¨¡æ‹Ÿäº‹ä»¶</strong>å¤„ç†ç¨‹åºç­‰ã€‚ä½†æ˜¯ï¼Œé—­åŒ…ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚å®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ã€éš¾ä»¥ç»´æŠ¤ç­‰ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨é—­åŒ…æ—¶éœ€è¦æ³¨æ„è¿™äº›ç¼ºç‚¹ï¼Œå¹¶é‡‡å–ç›¸åº”çš„æªæ–½æ¥é¿å…å®ƒä»¬çš„å‡ºç°ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arcade">let age = <span class="hljs-number">18</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">cat</span>(<span class="hljs-params"></span>)&#123;<br>    age++;<br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(age);<span class="hljs-comment">// catå‡½æ•°å†…è¾“å‡ºageï¼Œè¯¥ä½œç”¨åŸŸæ²¡æœ‰ï¼Œåˆ™å‘å¤–å±‚å¯»æ‰¾ï¼Œç»“æœæ‰¾åˆ°äº†ï¼Œè¾“å‡º[19];</span><br>&#125;<br>cat();<span class="hljs-comment">//19</span><br></code></pre></td></tr></table></figure><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">person</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span>;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">cat</span>(<span class="hljs-params"></span>)&#123;<br>        age++;<br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(age);<br>    &#125;<br>    <span class="hljs-keyword">return</span> cat;<br>&#125;<br>person();<span class="hljs-comment">// 19</span><br>person();<span class="hljs-comment">// 19</span><br></code></pre></td></tr></table></figure><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">person</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span>;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">cat</span>(<span class="hljs-params"></span>)&#123;<br>        age++;<br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(age);<br>    &#125;<br>    <span class="hljs-keyword">return</span> cat;<br>&#125;<br><br><span class="hljs-keyword">var</span> per = person();<span class="hljs-comment">//perç›¸å½“äºå‡½æ•°cat</span><br>per();<span class="hljs-comment">// 19 å³cat() è¿™æ ·æ¯æ¬¡è°ƒç”¨ä¸åœ¨ç»è¿‡ageçš„åˆå§‹å€¼ï¼Œè¿™æ ·å°±å¯ä»¥ä¸€ç›´å¢åŠ äº†</span><br>per();<span class="hljs-comment">// 20</span><br>per();<span class="hljs-comment">// 21</span><br></code></pre></td></tr></table></figure><h3 id="é—­åŒ…çš„ä½¿ç”¨åœºæ™¯"><a href="#é—­åŒ…çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="é—­åŒ…çš„ä½¿ç”¨åœºæ™¯"></a>é—­åŒ…çš„ä½¿ç”¨åœºæ™¯</h3><p>é—­åŒ…çš„ä½¿ç”¨åœºæ™¯å¾ˆå¹¿æ³›ï¼Œç‰¹åˆ«åœ¨å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ä¸­ï¼Œé—­åŒ…çš„ä½¿ç”¨åœºæ™¯æ›´å¤šï¼Œæˆ‘ä»¬åˆ—ä¸¾ä¸€äº›å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼ŒåŒ…å«ï¼š</p><ol><li>å‡½æ•°æŸ¯é‡ŒåŒ–</li><li>å•ä¾‹æ¨¡å¼å¤„ç†ã€å·¥å‚æ¨¡å¼å¤„ç†</li><li>react hooks</li></ol><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">curry</span><span class="hljs-params">(fn)</span> &#123;<br>  <span class="hljs-keyword">const</span> arity = fn.length;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">curried</span><span class="hljs-params">(<span class="hljs-rest_arg">...args</span>)</span> &#123;<br>    <span class="hljs-keyword">if</span> (args.length &gt;= arity) &#123;<br>      <span class="hljs-keyword">return</span> fn.apply(<span class="hljs-keyword">this</span>, args);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-params">(<span class="hljs-rest_arg">...moreArgs</span>)</span> &#123;<br>        <span class="hljs-keyword">return</span> curried.apply(<span class="hljs-keyword">this</span>, args.concat(moreArgs));<br>      &#125;;<br>    &#125;<br>  &#125;;<br>&#125;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span><span class="hljs-params">(a, b, c)</span> &#123;<br>  <span class="hljs-keyword">return</span> a + b + c;<br>&#125;<br><br><span class="hljs-keyword">const</span> curriedAdd = curry(add);<br>console.log(curriedAdd(<span class="hljs-number">1</span>)(<span class="hljs-number">2</span>)(<span class="hljs-number">3</span>)); <span class="hljs-comment">// è¾“å‡º 6</span><br></code></pre></td></tr></table></figure><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">person</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">var</span> age = <span class="hljs-number">18</span>;<br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">cat</span>(<span class="hljs-params"></span>)&#123;<br>        age++;<br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(age);<br>    &#125;<br>    <span class="hljs-keyword">return</span> cat;<br>&#125;<br><br><span class="hljs-keyword">var</span> per = person();<span class="hljs-comment">//perç›¸å½“äºå‡½æ•°cat</span><br>per();<span class="hljs-comment">// 19 å³cat() è¿™æ ·æ¯æ¬¡è°ƒç”¨ä¸åœ¨ç»è¿‡ageçš„åˆå§‹å€¼ï¼Œè¿™æ ·å°±å¯ä»¥ä¸€ç›´å¢åŠ äº†</span><br>per();<span class="hljs-comment">// 20</span><br>per();<span class="hljs-comment">// 21</span><br></code></pre></td></tr></table></figure><p>Compose å‡½æ•°</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">compose</span><span class="hljs-params">(<span class="hljs-rest_arg">...funcs</span>: Function[])</span> &#123;<br>  <span class="hljs-keyword">if</span> (funcs.length === <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-comment">// infer the argument type so it is usable in inference down the line</span><br>    <span class="hljs-keyword">return</span> &lt;T&gt;(arg: T) =&gt; arg<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (funcs.length === <span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-keyword">return</span> funcs[<span class="hljs-number">0</span>]<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> funcs.reduce(<br>    (a, b) =&gt;<br>      (...args: any) =&gt;<br>        a(b(...args))<br>  )<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é¿å…å†…å­˜æ³„æ¼"><a href="#é¿å…å†…å­˜æ³„æ¼" class="headerlink" title="é¿å…å†…å­˜æ³„æ¼"></a>é¿å…å†…å­˜æ³„æ¼</h3><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"></span>) &#123;<br>  let a = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(a);<br>    a = <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ‰‹åŠ¨æ¸…é™¤å¤–éƒ¨å˜é‡</span><br>    inner = <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ‰‹åŠ¨æ¸…é™¤å†…éƒ¨å‡½æ•°</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åœ¨ inner å‡½æ•°çš„æœ€åæ‰‹åŠ¨å°† a å˜é‡å’Œ inner å‡½æ•°ç½®ä¸º nullï¼Œä»¥é‡Šæ”¾å†…å­˜ã€‚</p><p>ä½¿ç”¨ IIFEï¼šå¯ä»¥ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆImmediately Invoked Function Expressionï¼ŒIIFEï¼‰æ¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œå¹¶åœ¨ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨æ¸…é™¤å˜é‡å’Œå‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">const</span> obj = &#123;<br>    <span class="hljs-attr">inner</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);<br>    &#125;,<br>    <span class="hljs-attr">clear</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>      a = <span class="hljs-literal">null</span>;<br>      obj.<span class="hljs-property">inner</span> = <span class="hljs-literal">null</span>;<br>    &#125;<br>  &#125;;<br>  <span class="hljs-keyword">return</span> obj;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>æ¨¡å—åŒ–</title>
    <link href="/2023/05/28/%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    <url>/2023/05/28/%E6%A8%A1%E5%9D%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¨¡å—åŒ–"><a href="#æ¨¡å—åŒ–" class="headerlink" title="æ¨¡å—åŒ–"></a>æ¨¡å—åŒ–</h1><p>æ¨¡å—åŒ–ç¼–ç¨‹çš„<strong>ç›®æ ‡</strong>æ˜¯å°†<strong>ä¸åŒä½œè€…å’Œæ¥æºçš„ä»£ç </strong>æ¨¡å—<strong>ç»„è£…</strong>æˆå¤§å‹ç¨‹åºã€‚</p><p>æ¨¡å—åŒ–çš„ä½œç”¨ä¸»è¦ä½“ç°åœ¨<strong>å°è£…</strong>å’Œ<strong>éšç§ç§æœ‰å®ç°ç»†èŠ‚</strong>ï¼Œä¿è¯å…¨å±€<strong>å‘½åç©ºé—´ä¸Šçš„æ¸…æ´</strong>ã€‚</p><p>æ¨¡å—ä¹‹é—´ä¸ä¼š<strong>æ„å¤–ä¿®æ”¹</strong>å„ç§è‡ªå®šä¹‰çš„<strong>å˜é‡</strong>ã€<strong>å‡½æ•°</strong>ã€å’Œ<strong>ç±»</strong>ã€‚</p><h2 id="äº†è§£æ¨¡å—æ¨¡å¼"><a href="#äº†è§£æ¨¡å—æ¨¡å¼" class="headerlink" title="äº†è§£æ¨¡å—æ¨¡å¼"></a>äº†è§£æ¨¡å—æ¨¡å¼</h2><p>æ¨¡å—æ˜¯å°†ä»£ç æ‹†åˆ†æˆç‹¬ç«‹çš„å—ï¼Œç„¶åå†æŠŠè¿™äº›å—è¿æ¥èµ·æ¥ã€‚</p><p>è¿™ç§æ¨¡å—çš„æ€æƒ³æ˜¯: <strong>é€»è¾‘åˆ†å—</strong>,<strong>å„è‡ªå°è£…</strong>,<strong>ç›¸äº’ç‹¬ç«‹</strong>,æ¯ä¸ªå—è‡ªé€‰å†³å®šæš´éœ²ä»€ä¹ˆï¼ŒåŒæ—¶è‡ªé€‰å†³å®šå¼•å…¥æ‰§è¡Œé‚£äº›å¤–éƒ¨çš„ä»£ç ã€‚</p><p>æµè¡Œçš„ JavaScript æ¨¡å—åŒ–è§„èŒƒæœ‰ <strong>CommonJS</strong>ã€<strong>AMD</strong>ã€<strong>CMD</strong> åŠ <strong>ESModule</strong> æ¨¡å—åŒ–è§„èŒƒã€‚</p><h2 id="æ¨¡å—åŒ–æ ‡å‡†åŠå‘å±•"><a href="#æ¨¡å—åŒ–æ ‡å‡†åŠå‘å±•" class="headerlink" title="æ¨¡å—åŒ–æ ‡å‡†åŠå‘å±•"></a>æ¨¡å—åŒ–æ ‡å‡†åŠå‘å±•</h2><p>1ã€å…¨å±€å½¢å¼çš„å®šä¹‰ï¼Œæ²¡æœ‰æ¨¡å—åŒ–çš„æ¦‚å¿µï¼Œè¿™æ ·å¾ˆéš¾å›¢é˜ŸååŒå’Œå®šä¹‰ã€‚</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//...</span><br>&#125;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-comment">//...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å‘½åç©ºé—´çš„æ–¹å¼ï¼Œå°†å†…å®¹å®šä¹‰åœ¨ä¸€ä¸ªå¯¹è±¡ä¸‹ï¼Œä»¥æ­¤å®ç°ä¸å¤–ç•Œä½œç”¨åŸŸçš„éš”ç¦»ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> util = &#123;<br>        <span class="hljs-attr">foo</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;hello&#x27;</span>); <br>    &#125;<br>&#125;<br>util.foo();<br></code></pre></td></tr></table></figure><p>é—­åŒ…å®ç°</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arcade"> <span class="hljs-keyword">var</span> util = (<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">var</span> person = <span class="hljs-string">&#x27;å°æ˜&#x27;</span><br>            <span class="hljs-keyword">var</span> personName = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>                <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(person);<br>            &#125;<br>            <span class="hljs-keyword">return</span> &#123;<br>                <span class="hljs-attr">personName</span>: personName<br>            &#125;<br><br>&#125;)();<br>util.personName();<br></code></pre></td></tr></table></figure><h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>æ¨¡å—åŒ–å¾—åˆ°å®è´¨æ€§æ¨åŠ¨å¾—åŠ›äº nodejs çš„å‘å±•ï¼Œæœ€æ—©æ¨¡å—åŒ–è§„èŒƒå–å¾—ä¸é”™å®è·µè¦è¿½æº¯åˆ°2009å¹´ï¼ŒCommonJS è¿™æ—¶è¿˜å« ServerJSï¼Œå…¶å¯¹åº”è§„èŒƒå®šä¹‰ä¸º Modules&#x2F;1.0ã€‚<a href="https://wiki.commonjs.org/wiki/Modules">https://wiki.commonjs.org/wiki/Modules</a></p><p>requireæ˜¯åŒæ­¥åŠ è½½çš„</p><ul><li>è¿è¡Œæ—¶åŠ è½½åªæœ‰è¿è¡Œæ—¶æ‰èƒ½å¾—åˆ°è¿™ä¸ªå¯¹è±¡(<a href="https://so.csdn.net/so/search?q=module&spm=1001.2101.3001.7020">module</a>.exportsçš„å¯¹è±¡)</li><li>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå±äº<strong>å¤åˆ¶</strong>ã€‚å³ä¼šè¢«æ¨¡å—ç¼“å­˜ã€‚åŒæ—¶ï¼Œ<strong>åœ¨å¦ä¸€ä¸ªæ¨¡å—å¯ä»¥å¯¹è¯¥æ¨¡å—è¾“å‡ºçš„å˜é‡é‡æ–°èµ‹å€¼</strong>ã€‚</li><li>åœ¨ç¬¬ä¸€æ¬¡åŠ è½½ä¹‹åä¼šè¢«ç¼“å­˜ï¼Œå¼•å…¥çš„æ˜¯<strong>ç¼“å­˜</strong>ä¸­çš„å€¼</li><li>å¯¹äºå¤æ‚æ•°æ®ç±»å‹ï¼Œå±äº<strong>æµ…æ‹·è´</strong>ã€‚ç”±äºä¸¤ä¸ªæ¨¡å—å¼•ç”¨çš„å¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œå› æ­¤<strong>å¯¹è¯¥æ¨¡å—çš„å€¼åšä¿®æ”¹æ—¶ä¼šå½±å“å¦ä¸€ä¸ªæ¨¡å—</strong>ã€‚</li></ul><h3 id="ä½¿ç”¨require-å¯¼å…¥å…¶ä»–æ¨¡å—"><a href="#ä½¿ç”¨require-å¯¼å…¥å…¶ä»–æ¨¡å—" class="headerlink" title="ä½¿ç”¨require()å¯¼å…¥å…¶ä»–æ¨¡å—"></a>ä½¿ç”¨require()å¯¼å…¥å…¶ä»–æ¨¡å—</h3><p>å¦‚æœå¯¼å…¥Nodeå†…ç½®çš„ç³»ç»Ÿæ¨¡å—æˆ–åŒ…ç®¡ç†å™¨å®‰è£…åœ¨ç³»ç»Ÿä¸Šçš„æ¨¡å—ï¼Œä½¿ç”¨æ¨¡å—çš„éé™å®šå</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//Nodeå†…ç½®çš„æ¨¡å—</span><br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><span class="hljs-keyword">const</span> http = = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-comment">//æœ¬åœ°å®‰è£…çš„æ¨¡å—</span><br><span class="hljs-keyword">const</span> koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;koa&quot;</span>);<br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>)<br><span class="hljs-comment">//å¯¼å…¥è‡ªå·±ä»£ç ä¸­çš„æ¨¡å—</span><br>é€šå¸¸ç”¨./ , ../ä»¥è¡¨ç¤ºå®ƒä»¬å½“å‰çš„ç›®å½•æˆ–çˆ¶ç›®å½•<br><span class="hljs-keyword">const</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./mysql.js&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-number">1.</span>å¦‚æœæ¨¡å—åªå¯¼å…¥ä¸€ä¸ªå‡½æ•°æˆ–ç±»ï¼Œåªéœ€è¦è°ƒç”¨<span class="hljs-built_in">require</span>()<br><span class="hljs-keyword">const</span> stats = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./stats.js&quot;</span>) <span class="hljs-comment">//å¯¼å‡ºstatså¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰å‡½æ•°</span><br><br><span class="hljs-number">2.</span>ä½¿ç”¨è§£æ„èµ‹å€¼ï¼Œå‘æœ¬åœ°å¯¼å…¥æƒ³è¦çš„å‡½æ•°<br><span class="hljs-keyword">const</span> &#123;stddv&#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./stats.js&quot;</span>)<br><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨module-exportså¯¹è±¡å¯¼å‡ºå…¬å…±çš„API"><a href="#ä½¿ç”¨module-exportså¯¹è±¡å¯¼å‡ºå…¬å…±çš„API" class="headerlink" title="ä½¿ç”¨module.exportså¯¹è±¡å¯¼å‡ºå…¬å…±çš„API"></a>ä½¿ç”¨module.exportså¯¹è±¡å¯¼å‡ºå…¬å…±çš„API</h3><p>å¦‚æœè¦å¯¼å‡ºå¤šä¸ªå€¼çš„nodeæ¨¡å—ä½¿ç”¨exportså¯¹è±¡,åªæƒ³å¯¼å‡ºä¸€ä¸ªå‡½æ•°æˆ–ç±»æ—¶ä½¿ç”¨module.exports</p><h2 id="AMDï¼ˆAsync-Module-Definitionï¼‰"><a href="#AMDï¼ˆAsync-Module-Definitionï¼‰" class="headerlink" title="AMDï¼ˆAsync Module Definitionï¼‰"></a>AMDï¼ˆAsync Module Definitionï¼‰</h2><p>é¦–å…ˆæ˜ç¡®ï¼Œè¿™ä¿©è§„èŒƒçš„ä»£è¡¨ä½œåˆ†åˆ«ä¸ºï¼š</p><p>AMD â€”â€” RequireJS</p><p>CMD â€”â€” SeaJS</p><p>è¿˜è®°å¾—æˆ‘ä»¬å‰é¢æåˆ°ï¼Œå¦‚æœæ¨¡å—åŒ–å¯¼å…¥æ˜¯åŒæ­¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯ä¸æ˜¯åªæœ‰ç­‰å¾…å†…å®¹å¯¼å…¥åŠ è½½å®Œåæ‰å¯ä»¥æ‰§è¡Œï¼Ÿå‡è®¾å¯¼å…¥æ˜¯å¼‚æ­¥çš„ï¼Œé‚£ä¹ˆä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>CommonJS Syntax<br>const Person = require(<span class="hljs-string">&quot;Person&quot;</span>);<br><br><span class="hljs-keyword">function</span> Programmer ()&#123;<br>    <span class="hljs-regexp">//</span><span class="hljs-keyword">do</span> something<br>&#125;<br><br>Programmer.prototype = new Person();<br><br><span class="hljs-regexp">//</span>å¦‚æœ require call æ˜¯å¼‚æ­¥çš„ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç è‚¯å®šæ˜¯æ— æ³•æ‰§è¡Œçš„ï¼Œå› ä¸ºåœ¨æ‰§è¡Œè¿™å¥å‰ Person æ¨¡å—è¿˜æœªåŠ è½½<br></code></pre></td></tr></table></figure><h2 id="ES-Module"><a href="#ES-Module" class="headerlink" title="ES Module"></a>ES Module</h2><p>2015 å¹´ï¼Œè¿™æ—¶ babel å¼€å§‹æµè¡Œï¼Œä¸å¾—ä¸è¯´ï¼ŒJavaScript çš„å‘å±•ç¦»ä¸å¼€ç¤¾åŒºçš„æ¨åŠ¨ã€‚</p><p>Use next generation JavaScript, today.</p><p>æˆ‘ä»¬å» ECMA è€ƒè€ƒå¤å§</p><p>å…³äº exportsï¼Œ<a href="https://262.ecma-international.org/6.0/#sec-exports">https://262.ecma-international.org/6.0/#sec-exports</a></p><p>å…³äº importsï¼Œ<a href="https://262.ecma-international.org/6.0/#sec-imports">https://262.ecma-international.org/6.0/#sec-imports</a></p><h3 id="å¯¼å‡º"><a href="#å¯¼å‡º" class="headerlink" title="å¯¼å‡º"></a>å¯¼å‡º</h3><p>è¦ä»ES6æ¨¡å—å¯¼å‡ºå¸¸é‡ã€å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œåªéœ€è¦åœ¨å£°æ˜å‰åŠ ä¸Šexportå…³é”®å­—å³å¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a1 = <span class="hljs-string">&#x27;aaaa&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">f1</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;bbbb&#x27;</span>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>    &#125;<br>    <span class="hljs-title function_">sayName</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>è¦å¯¼å‡ºå¤šä¸ªï¼Œå…ˆå®šä¹‰å¸¸é‡ï¼Œå˜é‡ï¼Œå‡½æ•°å’Œç±»ï¼Œä¸åŠ exportå…³é”®å­—ï¼Œç„¶åå†æœ«å°¾åªç”¨ä¸€ä¸ªexportå…³é”®å­—å¯¼å‡ºçœŸæ­£æƒ³è¦å¯¼å‡ºçš„å€¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> a1 = <span class="hljs-string">&#x27;aaaa&#x27;</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">f1</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;bbbb&#x27;</span>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;<br>    &#125;<br>    <span class="hljs-title function_">sayName</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">export</span> &#123;a1,f1,<span class="hljs-title class_">Person</span>&#125;;<br></code></pre></td></tr></table></figure><p>export defaulté»˜è®¤å¯¼å‡º</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;&#125;<br></code></pre></td></tr></table></figure><p>åªæœ‰ä¸€ä¸ªå€¼çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨export defaultå¯ä»¥ç®€åŒ–ä½¿ç”¨å¯¼å‡ºå€¼çš„æ¨¡å—ä»£ç ã€‚</p><p>ä½¿ç”¨exportçš„å¸¸è§„å¯¼å‡ºåªå¯¹æœ‰åå­—çš„å£°æ˜æœ‰æ•ˆï¼Œè€Œä½¿ç”¨export defaultçš„é»˜è®¤å¯¼å‡ºåˆ™å¯ä»¥å¯¼å‡ºä»»æ„è¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬<strong>åŒ¿åå‡½æ•°è¡¨è¾¾å¼</strong>å’Œ<strong>åŒ¿åç±»è¡¨è¾¾å¼</strong>ã€‚</p><p>è¿™æ„å‘³ç€export defaultå¯ä»¥å¯¼å‡ºå­—é¢é‡</p><h3 id="å¯¼å…¥"><a href="#å¯¼å…¥" class="headerlink" title="å¯¼å…¥"></a>å¯¼å…¥</h3><p>å¯¼å…¥ä½¿ç”¨importå…³é”®å­—</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs capnproto"><span class="hljs-keyword">import</span> a <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./a.js&quot;</span>;<br></code></pre></td></tr></table></figure><p>å¯¼å‡ºå¤šä¸ªå€¼</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs capnproto"><span class="hljs-keyword">import</span> &#123;mean, a&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./stats.js&quot;</span>;<br></code></pre></td></tr></table></figure><p>æ‰¹é‡å¯¼å…¥</p><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs capnproto"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span>  èµ·çš„åˆ«å  <span class="hljs-keyword">from</span> â€˜æ¨¡å—è·¯å¾„&#x27;<br></code></pre></td></tr></table></figure><h2 id="æ¨¡å—æ‰“åŒ…å·¥å…·ä¸å·¥ç¨‹åŒ–å®è·µ"><a href="#æ¨¡å—æ‰“åŒ…å·¥å…·ä¸å·¥ç¨‹åŒ–å®è·µ" class="headerlink" title="æ¨¡å—æ‰“åŒ…å·¥å…·ä¸å·¥ç¨‹åŒ–å®è·µ"></a>æ¨¡å—æ‰“åŒ…å·¥å…·ä¸å·¥ç¨‹åŒ–å®è·µ</h2><ol><li><strong>Modules&#x2F;1.x</strong>ã€‚è¿™ä¸ªè§‚ç‚¹è§‰å¾— 1.x è§„èŒƒå·²ç»å¤Ÿç”¨ï¼Œåªè¦ç§»æ¤åˆ°æµè§ˆå™¨ç«¯å°±å¥½ã€‚è¦åšçš„æ˜¯æ–°å¢ <a href="http://wiki.commonjs.org/wiki/Modules/Transport">Modules&#x2F;Transport</a> è§„èŒƒï¼Œå³åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œå‰ï¼Œå…ˆé€šè¿‡è½¬æ¢å·¥å…·å°†æ¨¡å—è½¬æ¢ä¸ºç¬¦åˆ Transport è§„èŒƒçš„ä»£ç ã€‚ä¸»æµä»£è¡¨æ˜¯æœåŠ¡ç«¯çš„å¼€å‘äººå‘˜ã€‚åæ¥è¡ç”Ÿå‡ºå€¼å¾—å…³æ³¨çš„ä¸¤ä¸ªå®ç°ï¼š <a href="https://github.com/component/component">component</a> å’Œ <a href="https://github.com/square/es6-module-transpiler">es6 module transpiler</a>ã€‚</li><li><strong>Modules&#x2F;Async</strong>ã€‚è¿™ä¸ªè§‚ç‚¹è§‰å¾—æµè§ˆå™¨æœ‰è‡ªèº«çš„ç‰¹å¾ï¼Œä¸åº”è¯¥ç›´æ¥ç”¨ Modules&#x2F;1.x è§„èŒƒã€‚è¿™ä¸ªè§‚ç‚¹ä¸‹çš„å…¸å‹ä»£è¡¨æ˜¯ <a href="http://wiki.commonjs.org/wiki/Modules/AsynchronousDefinition">AMD</a> è§„èŒƒåŠå…¶å®ç° <a href="http://requirejs.org/">RequireJS</a>ã€‚</li><li><strong>Modules&#x2F;2.0</strong>ã€‚è¿™ä¸ªè§‚ç‚¹è§‰å¾—æµè§ˆå™¨æœ‰è‡ªèº«çš„ç‰¹å¾ï¼Œä¸åº”è¯¥ç›´æ¥ç”¨ Modules&#x2F;1.x è§„èŒƒï¼Œä½†åº”è¯¥å°½å¯èƒ½ä¸ Modules&#x2F;1.x è§„èŒƒä¿æŒä¸€è‡´ã€‚è¿™ä¸ªè§‚ç‚¹ä¸‹çš„å…¸å‹ä»£è¡¨æ˜¯ <a href="https://code.google.com/p/bravojs/">BravoJS</a> å’Œ FlyScript çš„ä½œè€…ã€‚BravoJS ä½œè€…å¯¹ CommonJS çš„ç¤¾åŒºçš„è´¡çŒ®å¾ˆå¤§ï¼Œè¿™ä»½ <a href="http://www.page.ca/~wes/CommonJS/modules-2.0-7/">Modules&#x2F;2.0-draft</a> è§„èŒƒèŠ±äº†å¾ˆå¤šå¿ƒæ€ã€‚FlyScript çš„ä½œè€…æå‡ºäº†** <strong><strong>Modules&#x2F;Wrappings</strong></strong> <strong>è§„èŒƒï¼Œè¿™è§„èŒƒæ˜¯</strong> <strong><strong>CMD</strong></strong> **è§„èŒƒçš„å‰èº«ã€‚å¯æœ€ç»ˆ BravoJS å’Œ FlyScript è¿˜æ˜¯èµ°å‘äº†è¡°è½ã€‚</li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>thisçš„æŒ‡å‘</title>
    <link href="/2023/05/28/this%E7%9A%84%E6%8C%87%E5%90%91/"/>
    <url>/2023/05/28/this%E7%9A%84%E6%8C%87%E5%90%91/</url>
    
    <content type="html"><![CDATA[<h1 id="thisçš„æŒ‡å‘"><a href="#thisçš„æŒ‡å‘" class="headerlink" title="thisçš„æŒ‡å‘"></a>thisçš„æŒ‡å‘</h1><p>thisæ°¸è¿œæŒ‡å‘ä¸€ä¸ªå¯¹è±¡</p><p>thisçš„æŒ‡å‘å’Œä»–è°ƒç”¨çš„ç¯å¢ƒæœ‰å…³</p><h2 id="å…¨å±€ä½œç”¨åŸŸä¸‹thisçš„æŒ‡å‘"><a href="#å…¨å±€ä½œç”¨åŸŸä¸‹thisçš„æŒ‡å‘" class="headerlink" title="å…¨å±€ä½œç”¨åŸŸä¸‹thisçš„æŒ‡å‘"></a>å…¨å±€ä½œç”¨åŸŸä¸‹thisçš„æŒ‡å‘</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">å…¨å±€ä½œç”¨åŸŸä¸‹ <span class="hljs-keyword">this</span>çš„æŒ‡å‘<br>console.log(<span class="hljs-keyword">this</span>);<span class="hljs-comment">// æŒ‡å‘window</span><br><span class="hljs-comment">//è¿™æ—¶æ‰“å°å®¿ä¸»æ ¹å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­æ˜¯window,åœ¨nodeä¸­æ˜¯globalå¯¹è±¡</span><br></code></pre></td></tr></table></figure><h2 id="å¯¹è±¡ä¸­çš„thisæŒ‡å‘"><a href="#å¯¹è±¡ä¸­çš„thisæŒ‡å‘" class="headerlink" title="å¯¹è±¡ä¸­çš„thisæŒ‡å‘"></a>å¯¹è±¡ä¸­çš„thisæŒ‡å‘</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript">å…³äºå¯¹è±¡çš„<span class="hljs-variable language_">this</span>æŒ‡å‘<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">f1</span>(<span class="hljs-params"></span>)&#123;<br>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>);<br>&#125;<br><span class="hljs-comment">//å¯¹è±¡åˆå§‹åŒ–æ—¶ä¼šç»‘å®šthis,æ‰€ä»¥f1çš„æŒ‡å‘æ˜¯obj</span><br><span class="hljs-keyword">var</span> obj = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;o1&#x27;</span>,<br>  <span class="hljs-attr">f</span>: f1<br>&#125;<br>obj.<span class="hljs-title function_">f1</span>() <span class="hljs-comment">// obj</span><br></code></pre></td></tr></table></figure><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">f1</span>(<span class="hljs-params"></span>)&#123;<br>       <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(this.name);<br>&#125;<br><span class="hljs-keyword">var</span> obj = &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;o1&#x27;</span>,<br>  <span class="hljs-attr">f</span>: f1<br>&#125;<br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;o2&#x27;</span><br>obj.f1() <span class="hljs-comment">// o1</span><br>f1()<span class="hljs-comment">//o2</span><br><span class="hljs-comment">//è¿™ä¸ªä¾‹å­è¯æ˜äº†thisçš„æŒ‡å‘ä¸è°ƒç”¨æœ‰å…³å’Œå®šä¹‰æ— å…³</span><br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs javascript">å±€éƒ¨<span class="hljs-variable language_">this</span>çš„æŒ‡å‘<br><span class="hljs-keyword">var</span> obj1 = &#123;<br>      <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;o3&#x27;</span>,<br>      <span class="hljs-attr">fn</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">// æŒ‡å‘obj</span><br>      <span class="hljs-keyword">function</span> <span class="hljs-title function_">sayName</span>(<span class="hljs-params"></span>)&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>); <span class="hljs-comment">//æŒ‡å‘window</span><br>      &#125;<br>       <span class="hljs-title function_">sayName</span>(); <br>     &#125;<br> &#125;<br>obj1.<span class="hljs-title function_">fn</span>(); <span class="hljs-comment">//å¯¹è±¡çš„å‡½æ•°ä¼šå‘ç”Ÿthisçš„è‡ªåŠ¨ç»‘å®šï¼Œä½†ä¸ä»£è¡¨å‡½æ•°å†…éƒ¨çš„å‡½æ•°ä¼šè‡ªåŠ¨ç»‘å®šthis</span><br></code></pre></td></tr></table></figure><h2 id="æ„é€ å‡½æ•°ä¸­çš„thisæŒ‡å‘"><a href="#æ„é€ å‡½æ•°ä¸­çš„thisæŒ‡å‘" class="headerlink" title="æ„é€ å‡½æ•°ä¸­çš„thisæŒ‡å‘"></a>æ„é€ å‡½æ•°ä¸­çš„thisæŒ‡å‘</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//æ„é€ å‡½æ•°ä¸­çš„this</span><br><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;a2&#x27;</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>)&#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">sayName</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>) <span class="hljs-comment">//a1</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">f1</span>(<span class="hljs-params"></span>)&#123;<br>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>) <span class="hljs-comment">//a2</span><br>    &#125;<br>  &#125;<br>&#125;<br><span class="hljs-keyword">const</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;a1&#x27;</span>)<br>p1.<span class="hljs-title function_">sayName</span>()<br></code></pre></td></tr></table></figure><h1 id="thisç»‘å®šçš„è§„åˆ™"><a href="#thisç»‘å®šçš„è§„åˆ™" class="headerlink" title="thisç»‘å®šçš„è§„åˆ™"></a>thisç»‘å®šçš„è§„åˆ™</h1><h2 id="é»˜è®¤ç»‘å®š"><a href="#é»˜è®¤ç»‘å®š" class="headerlink" title="é»˜è®¤ç»‘å®š"></a>é»˜è®¤ç»‘å®š</h2><p>åœ¨å…¨å±€ç¯å¢ƒï¼ˆéä¸¥æ ¼æ¨¡å¼ï¼‰ä¸‹thisæŒ‡å‘window,ä¸¥æ ¼æ¨¡å¼æŒ‡å‘undefined</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">var</span> name = <span class="hljs-string">&#x27;a1&#x27;</span>;<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">person</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">return</span> this.name<br>&#125;<br><span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(person());<span class="hljs-comment">//a1</span><br></code></pre></td></tr></table></figure><h2 id="éšå¼ç»‘å®š"><a href="#éšå¼ç»‘å®š" class="headerlink" title="éšå¼ç»‘å®š"></a>éšå¼ç»‘å®š</h2><p>å‡½æ•°å¯ä»¥ä½œä¸ºå¯¹è±¡çš„å‚æ•°è°ƒç”¨ï¼Œè¿™æ—¶çš„thisæŒ‡å‘å°±æŒ‡å‘è¿™ä¸ªä¸Šçº§å¯¹è±¡</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function">function <span class="hljs-title">test</span>()</span>&#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.name<br>&#125;<br><span class="hljs-keyword">let</span> obj = &#123;<br>  name:<span class="hljs-string">&#x27;b1&#x27;</span><br>&#125;;<br>obj.m = test;<br>obj.m() <span class="hljs-comment">//b1</span><br></code></pre></td></tr></table></figure><p>å¦‚æœåµŒå¥—å¤šçº§å¯¹è±¡ï¼ŒthisæŒ‡å‘è¿˜æ˜¯æŒ‡å‘ä¸Šä¸€çº§çš„å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123;<br>         <span class="hljs-attr">c</span>: <span class="hljs-string">&#x27;c1&#x27;</span>,<br>         <span class="hljs-attr">d</span>: &#123;<br>            <span class="hljs-attr">fn</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>);<br>            &#125;<br>         &#125;<br>&#125;<br>obj.<span class="hljs-property">d</span>.<span class="hljs-title function_">fn</span>(); <span class="hljs-comment">//undefined</span><br></code></pre></td></tr></table></figure><h2 id="æ˜¾ç¤ºç»‘å®š"><a href="#æ˜¾ç¤ºç»‘å®š" class="headerlink" title="æ˜¾ç¤ºç»‘å®š"></a>æ˜¾ç¤ºç»‘å®š</h2><p>é€šè¿‡ callã€applyã€bind æ”¹å˜ this æŒ‡å‘ã€‚</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">Function.prototype.myCall = <span class="hljs-keyword">function</span><span class="hljs-params">(context, <span class="hljs-rest_arg">...args</span>)</span> &#123;<br> <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œåˆ™é»˜è®¤ä¸ºå…¨å±€å¯¹è±¡</span><br> context = context || window;<br> <span class="hljs-comment">// ç”¨ Symbol é˜²æ­¢å±æ€§åå†²çª</span><br> <span class="hljs-keyword">const</span> fn = Symbol();<br> <span class="hljs-comment">// å°†å‡½æ•°ä½œä¸ºä¸Šä¸‹æ–‡çš„å±æ€§</span><br> context[fn] = <span class="hljs-keyword">this</span>;<br> <span class="hljs-comment">// æ‰§è¡Œå‡½æ•°</span><br> <span class="hljs-keyword">const</span> result = context[fn](...args);<br> <span class="hljs-comment">// åˆ é™¤å‡½æ•°</span><br> <span class="hljs-keyword">delete</span> context[fn];<br> <span class="hljs-comment">// è¿”å›ç»“æœ</span><br> <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">myApply</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">context, args</span>) &#123;<br> <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œåˆ™é»˜è®¤ä¸ºå…¨å±€å¯¹è±¡</span><br> context = context || <span class="hljs-variable language_">window</span>;<br> <span class="hljs-comment">// ç”¨ Symbol é˜²æ­¢å±æ€§åå†²çª</span><br> <span class="hljs-keyword">const</span> fn = <span class="hljs-title class_">Symbol</span>();<br> <span class="hljs-comment">// å°†å‡½æ•°ä½œä¸ºä¸Šä¸‹æ–‡çš„å±æ€§</span><br> context[fn] = <span class="hljs-variable language_">this</span>;<br> <span class="hljs-comment">// æ‰§è¡Œå‡½æ•°</span><br> <span class="hljs-keyword">const</span> result = context[fn](...args);<br> <span class="hljs-comment">// åˆ é™¤å‡½æ•°</span><br> <span class="hljs-keyword">delete</span> context[fn];<br> <span class="hljs-comment">// è¿”å›ç»“æœ</span><br> <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">Function.prototype.myBind = <span class="hljs-keyword">function</span><span class="hljs-params">(context, <span class="hljs-rest_arg">...args1</span>)</span> &#123;<br> <span class="hljs-comment">// ä¿å­˜å½“å‰å‡½æ•°</span><br> <span class="hljs-keyword">const</span> fn = <span class="hljs-keyword">this</span>;<br> <span class="hljs-comment">// è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°</span><br> <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span><span class="hljs-params">(<span class="hljs-rest_arg">...args2</span>)</span> &#123;<br> <span class="hljs-comment">// å¦‚æœæ–°å‡½æ•°ä½¿ç”¨äº† new å…³é”®å­—åˆ›å»ºå®ä¾‹ï¼Œå°† this æŒ‡å‘æ–°å®ä¾‹</span><br> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> fn) &#123;<br> fn.apply(<span class="hljs-keyword">this</span>, [...args1, ...args2]);<br> &#125; <span class="hljs-keyword">else</span> &#123;<br> <span class="hljs-comment">// å°†æ–°å‡½æ•°ç»‘å®šåˆ°æŒ‡å®šä¸Šä¸‹æ–‡</span><br> fn.apply(context, [...args1, ...args2]);<br> &#125;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="newç»‘å®š"><a href="#newç»‘å®š" class="headerlink" title="newç»‘å®š"></a>newç»‘å®š</h2><p>é€šè¿‡æ„é€ å‡½æ•°å…³é”®è¯newå…³é”®å­—ç”Ÿæˆä¸€ä¸ªå¯¹è±¡,æ­¤æ—¶thisæŒ‡å‘è¿™ä¸ªå¯¹è±¡</p><p>newåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„è¿‡ç¨‹: </p><p>åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å• JavaScript å¯¹è±¡ï¼ˆå³ {}ï¼‰;ä¸ºæ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ å±æ€§ __proto__ï¼Œå°†è¯¥å±æ€§é“¾æ¥è‡³æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼›å°†æ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º this çš„ä¸Šä¸‹æ–‡ï¼›å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å› this</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> <span class="hljs-constructor">Person(<span class="hljs-params">name</span>,<span class="hljs-params">age</span>)</span>&#123;<br>  this.name = name;<br>  this.age = age<br>&#125;<br><span class="hljs-keyword">let</span> p1 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Person(&#x27;<span class="hljs-params">p1</span>&#x27;,18)</span><br></code></pre></td></tr></table></figure><h1 id="ç®­å¤´å‡½æ•°ä¸­çš„this"><a href="#ç®­å¤´å‡½æ•°ä¸­çš„this" class="headerlink" title="ç®­å¤´å‡½æ•°ä¸­çš„this"></a>ç®­å¤´å‡½æ•°ä¸­çš„this</h1><p>ç®­å¤´å‡½æ•°ä¸­çš„ this æŒ‡å‘è°ƒç”¨è¯¥å‡½æ•°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆå³å½“å‰ä½œç”¨åŸŸæ‰€å±çš„å¯¹è±¡ï¼‰ã€‚</p><p>ç®­å¤´å‡½æ•°ä¸èƒ½å±äºcall,apply,bindæ”¹å˜thisçš„æŒ‡å‘</p><p>ç®­å¤´å‡½æ•°çš„ç‰¹æ€§:</p><p>1ã€æ²¡æœ‰å•ç‹¬çš„thisï¼›2ã€ä¸ç»‘å®šargumentsï¼›å’Œ newä¸€èµ·ç”¨ä¼šæŠ›å‡ºé”™è¯¯ï¼›3ã€æ²¡æœ‰prototypeå±æ€§ï¼›4ã€yield å…³é”®å­—é€šå¸¸ä¸èƒ½åœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ï¼Œç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œå‡½æ•°ç”Ÿæˆå™¨</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> obj = &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;a1&#x27;</span>,<br>    <span class="hljs-attr">func1</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>), <span class="hljs-number">1000</span>);<br>    &#125;<br>&#125;<br><br>obj.<span class="hljs-title function_">func1</span>(); <span class="hljs-comment">// a1</span><br></code></pre></td></tr></table></figure><h1 id="äº‹ä»¶ç»‘å®šä¸­çš„this"><a href="#äº‹ä»¶ç»‘å®šä¸­çš„this" class="headerlink" title="äº‹ä»¶ç»‘å®šä¸­çš„this"></a>äº‹ä»¶ç»‘å®šä¸­çš„this</h1><p>å‡½æ•°ä¸­çš„thisé€šå¸¸æ˜¯ç»‘å®šäº‹ä»¶çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ä»£ç æ®µä¸­ï¼Œthis æŒ‡å‘ button å…ƒç´ ã€‚</p><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs hsp">&lt;<span class="hljs-keyword">button</span> id=<span class="hljs-string">&quot;btn&quot;</span> <span class="hljs-keyword">onclick</span>=<span class="hljs-string">&quot;console.log(this);&quot;</span>&gt;Click me&lt;/<span class="hljs-keyword">button</span>&gt;<br></code></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
